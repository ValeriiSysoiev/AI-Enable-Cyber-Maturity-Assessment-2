"use strict";exports.id=349,exports.ids=[349],exports.modules={24349:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(10326),a=r(17577),n=r(89249);function o({engagementId:e,className:t="",isAdminView:o=!1,defaultPageSize:i=20}){let[l,c]=(0,a.useState)([]),[d,u]=(0,a.useState)(1),[g,m]=(0,a.useState)(i),[h,p]=(0,a.useState)(0),[x,y]=(0,a.useState)(!1),[f,b]=(0,a.useState)(!1),[j,w]=(0,a.useState)(!0),[v,N]=(0,a.useState)(""),[_,S]=(0,a.useState)(""),[E,C]=(0,a.useState)(""),[I,P]=(0,a.useState)(null),R=async()=>{w(!0),N("");try{let t;if(o){let{getGlobalAuditLogs:e}=await Promise.resolve().then(r.bind(r,89249));t=await e(d,g,_||void 0,E||void 0)}else t=await (0,n.FA)(e,d,g,_||void 0);c(t.entries),p(t.total_count),y(t.has_next),b(t.has_prev)}catch(e){N(e.message)}finally{w(!1)}},k=e=>{u(e)},A=e=>{m(e),u(1)},T=e=>{S(e),u(1)},D=e=>{C(e),u(1)},O=e=>{P(I===e?null:e)},L=e=>{switch(e){case"data_export_requested":case"data_export_completed":return"bg-blue-100 text-blue-800";case"data_purge_requested":case"data_purge_completed":return"bg-red-100 text-red-800";case"consent_given":return"bg-green-100 text-green-800";case"consent_withdrawn":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},$=e=>e&&0!==Object.keys(e).length?Object.entries(e).map(([e,t])=>(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsxs)("span",{className:"text-gray-500",children:[e,":"]}),s.jsx("span",{className:"ml-1 font-mono",children:"object"==typeof t?JSON.stringify(t,null,2):String(t)})]},e)):null;return j?s.jsx("div",{className:`space-y-4 ${t}`,children:s.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3,4,5].map(e=>s.jsx("div",{className:"h-16 bg-gray-200 rounded"},e))})}):(0,s.jsxs)("div",{className:`space-y-6 ${t}`,children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action Type"}),(0,s.jsxs)("select",{value:_,onChange:e=>T(e.target.value),className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"",children:"All Actions"}),["data_export_requested","data_export_completed","data_purge_requested","data_purge_completed","data_accessed","consent_given","consent_withdrawn"].map(e=>s.jsx("option",{value:e,children:(0,n.EQ)(e)},e))]})]}),o&&(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Engagement ID"}),s.jsx("input",{type:"text",value:E,onChange:e=>D(e.target.value),placeholder:"Filter by engagement",className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Per Page"}),(0,s.jsxs)("select",{value:g,onChange:e=>A(Number(e.target.value)),className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:10,children:"10"}),s.jsx("option",{value:20,children:"20"}),s.jsx("option",{value:50,children:"50"}),s.jsx("option",{value:100,children:"100"})]})]})]}),s.jsx("button",{onClick:R,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border",children:"Refresh"})]}),v&&s.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:s.jsx("p",{className:"text-sm text-red-600",children:v})}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",l.length," of ",h.toLocaleString()," audit log entries",(_||E)&&(0,s.jsxs)("span",{className:"ml-2",children:["(filtered)",s.jsx("button",{onClick:()=>{S(""),C(""),u(1)},className:"ml-1 text-blue-600 hover:text-blue-800 underline",children:"Clear filters"})]})]}),0===l.length?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No audit log entries found."}):s.jsx("div",{className:"space-y-2",children:l.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${L(e.action)}`,children:(0,n.EQ)(e.action)}),s.jsx("span",{className:"text-sm font-medium",children:e.user_email}),s.jsx("span",{className:"text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString()})]}),o&&(0,s.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[s.jsx("span",{className:"font-medium",children:"Engagement:"}),s.jsx("span",{className:"ml-1 font-mono text-xs",children:e.engagement_id})]}),e.ip_address&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["IP: ",e.ip_address]})]}),(Object.keys(e.details).length>0||e.user_agent)&&s.jsx("button",{onClick:()=>O(e.id),className:"ml-4 p-1 text-gray-400 hover:text-gray-600",children:s.jsx("svg",{className:`w-4 h-4 transition-transform ${I===e.id?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),I===e.id&&(0,s.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:[e.user_agent&&(0,s.jsxs)("div",{className:"text-xs",children:[s.jsx("span",{className:"text-gray-500",children:"User Agent:"}),s.jsx("div",{className:"mt-1 font-mono text-xs break-all bg-gray-50 p-2 rounded",children:e.user_agent})]}),Object.keys(e.details).length>0&&(0,s.jsxs)("div",{className:"text-xs",children:[s.jsx("span",{className:"text-gray-500",children:"Details:"}),s.jsx("div",{className:"mt-1 bg-gray-50 p-2 rounded space-y-1",children:$(e.details)})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["Log ID: ",e.id]})]})]},e.id))}),(x||f)&&(0,s.jsxs)("div",{className:"flex items-center justify-between border-t pt-4",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Page ",d," of ",Math.ceil(h/g)]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>k(d-1),disabled:!f,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),s.jsx("button",{onClick:()=>k(d+1),disabled:!x,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})}},6824:(e,t,r)=>{r.d(t,{$V:()=>c,SC:()=>o,Sg:()=>l,tQ:()=>i});var s=r(2991);let a=process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function n(){let e=(0,s.OD)(),t=(0,s.K3)(),r={};return e&&(r["X-User-Email"]=e),t&&(r["X-Engagement-ID"]=t),r}async function o(e,t={}){let r=n(),s=new AbortController,o=setTimeout(()=>s.abort(),t.timeout||3e4);try{let n=await fetch(`${a}${e}`,{...t,signal:s.signal,headers:{...r,...t.headers}});if(clearTimeout(o),!n.ok){let e=await n.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||`Request failed: ${n.status}`)}return n.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function i(e){let t=new AbortController,r=setTimeout(()=>t.abort(),3e4);try{let s=await fetch(`${a}/presets/${e}`,{cache:"no-store",signal:t.signal});if(clearTimeout(r),!s.ok)throw Error(`Preset ${e} not found`);return s.json()}catch(t){if(clearTimeout(r),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let l=a;function c(e=!1){let t=n();return e||(t["Content-Type"]="application/json"),t}},2991:(e,t,r)=>{function s(){return""}function a(){return""}function n(e){}function o(){return(process.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes("")}r.d(t,{GJ:()=>o,K3:()=>a,OD:()=>s,d8:()=>n})},89249:(e,t,r)=>{r.d(t,{AV:()=>o,Cs:()=>d,E0:()=>f,EQ:()=>b,FA:()=>c,Is:()=>g,M_:()=>l,XB:()=>x,Yj:()=>n,getGlobalAuditLogs:()=>h,hF:()=>a,jQ:()=>m,kF:()=>u,sS:()=>y,sk:()=>p,zc:()=>w});var s=r(6824);async function a(e){try{return await (0,s.SC)("/gdpr/export",{method:"POST",body:JSON.stringify(e)})}catch(e){throw j(e)}}async function n(e){try{let t=await fetch(`/api/proxy/gdpr/export/${e}/download`,{headers:{"Content-Type":"application/octet-stream"}});if(!t.ok)throw Error(`Download failed: ${t.status}`);return await t.blob()}catch(e){throw j(e)}}async function o(e){try{return await (0,s.SC)("/gdpr/purge",{method:"POST",body:JSON.stringify(e)})}catch(e){throw j(e)}}async function i(e){try{return await (0,s.SC)(`/gdpr/jobs/${e}`)}catch(e){throw j(e)}}async function l(e,t){try{let r=new URLSearchParams;t&&r.set("type",t);let a=`/gdpr/jobs?engagement_id=${e}${r.toString()?"&"+r.toString():""}`;return await (0,s.SC)(a)}catch(e){throw j(e)}}async function c(e,t=1,r=50,a){try{let n=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:r.toString()});return a&&n.set("action",a),await (0,s.SC)(`/gdpr/audit-logs?${n.toString()}`)}catch(e){throw j(e)}}async function d(e){try{return await (0,s.SC)(`/gdpr/compliance/${e}`)}catch(e){throw j(e)}}async function u(){try{return await (0,s.SC)("/gdpr/admin/dashboard")}catch(e){throw j(e)}}async function g(){try{return await (0,s.SC)("/gdpr/admin/ttl-policy")}catch(e){throw j(e)}}async function m(e){try{return await (0,s.SC)("/gdpr/admin/ttl-policy",{method:"PUT",body:JSON.stringify(e)})}catch(e){throw j(e)}}async function h(e=1,t=50,r,a){try{let n=new URLSearchParams({page:e.toString(),page_size:t.toString()});return r&&n.set("action",r),a&&n.set("engagement_id",a),await (0,s.SC)(`/gdpr/admin/audit-logs?${n.toString()}`)}catch(e){throw j(e)}}function p(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function x(e,t){return e.trim().toLowerCase()===t.trim().toLowerCase()}function y(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}function f(e){switch(e){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function b(e){switch(e){case"data_export_requested":return"Data Export Requested";case"data_export_completed":return"Data Export Completed";case"data_purge_requested":return"Data Purge Requested";case"data_purge_completed":return"Data Purge Completed";case"data_accessed":return"Data Accessed";case"consent_given":return"Consent Given";case"consent_withdrawn":return"Consent Withdrawn";default:return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}function j(e){if(e instanceof Error){if(e.message.includes("insufficient permissions"))return{code:"INSUFFICIENT_PERMISSIONS",message:"You do not have permission to perform this GDPR operation.",details:{originalError:e.message}};if(e.message.includes("invalid engagement"))return{code:"INVALID_ENGAGEMENT",message:"The specified engagement does not exist or is not accessible.",details:{originalError:e.message}};if(e.message.includes("export limit exceeded"))return{code:"EXPORT_LIMIT_EXCEEDED",message:"You have exceeded the maximum number of export requests. Please wait before requesting another export.",details:{originalError:e.message}};if(e.message.includes("purge in progress"))return{code:"PURGE_IN_PROGRESS",message:"A data purge operation is already in progress for this engagement.",details:{originalError:e.message}};if(e.message.includes("invalid format"))return{code:"INVALID_FORMAT",message:"The requested export format is not supported.",details:{originalError:e.message}};if(e.message.includes("timeout")||e.message.includes("network"))return{code:"NETWORK_ERROR",message:"Network error occurred. Please check your connection and try again.",details:{originalError:e.message}}}return{code:"UNKNOWN_ERROR",message:"An unexpected error occurred during the GDPR operation.",details:{originalError:e?.message||String(e)}}}class w{constructor(e,t){this.jobId=e,this.onUpdate=t.onUpdate,this.onComplete=t.onComplete,this.onError=t.onError}start(e=2e3){this.stop(),this.intervalId=setInterval(async()=>{try{let e=await i(this.jobId);this.onUpdate?.(e),("completed"===e.status||"failed"===e.status)&&(this.stop(),this.onComplete?.(e))}catch(e){this.stop(),this.onError?.(j(e))}},e)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}}}};