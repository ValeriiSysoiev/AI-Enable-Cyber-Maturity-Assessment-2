(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[612],{18811:function(e,s,t){Promise.resolve().then(t.bind(t,71189))},71189:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var i=t(57437),a=t(2265),n=t(99376),r=t(65001),l=t(4062);function d(e){let{onEvidenceSelect:s,refreshTrigger:t=0,className:r="",showLinkActions:d=!1}=e,{engagementId:c}=(0,n.useParams)(),[o,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(!0),[u,p]=(0,a.useState)(null),[g,v]=(0,a.useState)(1),[j,b]=(0,a.useState)(20),[y,f]=(0,a.useState)(null),[N,w]=(0,a.useState)(null),[k,C]=(0,a.useState)({itemType:"assessment",itemId:""}),D=(0,a.useCallback)(async()=>{if(c){h(!0),p(null);try{let e=await (0,l.q8)(c,g,j);m(e)}catch(e){p(e instanceof Error?e.message:"Failed to load evidence")}finally{h(!1)}}},[c,g,j]);(0,a.useEffect)(()=>{D()},[D,t]);let S=(0,a.useCallback)(e=>{v(e)},[]),_=(0,a.useCallback)(e=>{b(e),v(1)},[]),T=(0,a.useCallback)(async(e,s,t)=>{if(confirm("Remove this link?")){f(e);try{await (0,l.fG)(e,"".concat(s,":").concat(t)),await D()}catch(e){alert(e instanceof Error?e.message:"Failed to unlink evidence")}finally{f(null)}}},[D]),P=(0,a.useCallback)(async e=>{if(!k.itemType.trim()||!k.itemId.trim()){alert("Please enter both item type and item ID");return}f(e);try{await (0,l.tc)(e,{item_type:k.itemType.trim(),item_id:k.itemId.trim()}),w(null),C({itemType:"assessment",itemId:""}),await D()}catch(e){alert(e instanceof Error?e.message:"Failed to create link")}finally{f(null)}},[k,D]),E=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return x?(0,i.jsx)("div",{className:"".concat(r),role:"status","aria-live":"polite",children:(0,i.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),(0,i.jsx)("div",{className:"text-gray-600",children:"Loading evidence..."})]})})}):u?(0,i.jsx)("div",{className:"".concat(r),role:"alert","aria-live":"assertive",children:(0,i.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,i.jsxs)("div",{className:"text-red-600 flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-xl",children:"⚠️"}),(0,i.jsxs)("span",{children:["Error: ",u]})]})})}):o&&0!==o.data.length?(0,i.jsxs)("div",{className:"space-y-4 ".concat(r),children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Evidence Files"}),(()=>{if(!o)return null;let{total:e,page:s,page_size:t}=o,a=Math.min(s*t,e);return(0,i.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",(s-1)*t+1,"-",a," of ",e," evidence files"]})})()]}),(0,i.jsx)("div",{className:"overflow-hidden rounded-lg border",children:(0,i.jsxs)("table",{className:"w-full",role:"table","aria-label":"Evidence files list",children:[(0,i.jsx)("thead",{className:"bg-gray-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"File"}),(0,i.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),(0,i.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uploaded"}),(0,i.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Links"}),(0,i.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,i.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,i.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o.data.map(e=>(0,i.jsxs)("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>null==s?void 0:s(e),role:"row",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),null==s||s(e))},"aria-label":"Evidence file ".concat(e.filename),children:[(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("span",{className:"text-lg mr-3",children:(0,l.LP)(e.mime_type)}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate max-w-xs",children:e.filename}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:e.mime_type})]})]})}),(0,i.jsx)("td",{className:"px-4 py-4 text-sm text-gray-600",children:(0,l.sS)(e.size)}),(0,i.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-600",children:[(0,i.jsx)("div",{children:E(e.uploaded_at)}),(0,i.jsxs)("div",{className:"text-xs text-gray-500",children:["by ",e.uploaded_by]})]}),(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsx)("div",{className:"flex flex-wrap gap-1",children:0===e.linked_items.length?(0,i.jsx)("span",{className:"text-xs text-gray-500",children:"No links"}):e.linked_items.map((s,t)=>(0,i.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded",children:[s.item_type,":",s.item_id.substring(0,8),"...",(0,i.jsx)("button",{onClick:t=>{t.stopPropagation(),T(e.id,s.item_type,s.item_id)},disabled:y===e.id,className:"ml-1 text-red-500 hover:text-red-700 disabled:opacity-50",title:"Remove link",children:"\xd7"})]},t))})}),(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-700 rounded",children:"✓ Uploaded"}),e.pii_flag&&(0,i.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium bg-orange-100 text-orange-700 rounded",children:"⚠️ PII"})]})}),(0,i.jsx)("td",{className:"px-4 py-4",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:t=>{t.stopPropagation(),null==s||s(e)},className:"text-blue-600 hover:text-blue-800 text-sm","aria-label":"View evidence details",children:"View"}),d&&(0,i.jsx)("button",{onClick:s=>{s.stopPropagation(),w(e.id)},className:"text-green-600 hover:text-green-800 text-sm","aria-label":"Link to item",disabled:y===e.id,children:"\uD83D\uDD17 Link"}),(0,i.jsx)("button",{onClick:s=>{s.stopPropagation(),navigator.clipboard.writeText(e.checksum_sha256),alert("Checksum copied to clipboard")},className:"text-gray-600 hover:text-gray-800 text-sm",title:"Copy checksum","aria-label":"Copy checksum",children:"\uD83D\uDCCB"})]})})]},e.id))})]})}),(0,i.jsx)("div",{className:"flex justify-between items-center",children:(()=>{if(!o)return null;let{page:e,total_pages:s,has_previous:t,has_next:a}=o;return(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"Items per page:"}),(0,i.jsxs)("select",{value:j,onChange:e=>_(Number(e.target.value)),className:"border rounded px-2 py-1 text-sm",children:[(0,i.jsx)("option",{value:10,children:"10"}),(0,i.jsx)("option",{value:20,children:"20"}),(0,i.jsx)("option",{value:50,children:"50"}),(0,i.jsx)("option",{value:100,children:"100"})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>S(1),disabled:!t,className:"px-2 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"\xab\xab"}),(0,i.jsx)("button",{onClick:()=>S(e-1),disabled:!t,className:"px-2 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"‹"}),(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",e," of ",s]}),(0,i.jsx)("button",{onClick:()=>S(e+1),disabled:!a,className:"px-2 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"›"}),(0,i.jsx)("button",{onClick:()=>S(s),disabled:!a,className:"px-2 py-1 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"\xbb\xbb"})]})]})})()}),N&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Link Evidence to Item"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item Type"}),(0,i.jsxs)("select",{value:k.itemType,onChange:e=>C(s=>({...s,itemType:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y===N,children:[(0,i.jsx)("option",{value:"assessment",children:"Assessment"}),(0,i.jsx)("option",{value:"question",children:"Question"}),(0,i.jsx)("option",{value:"framework",children:"Framework"}),(0,i.jsx)("option",{value:"control",children:"Control"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item ID"}),(0,i.jsx)("input",{type:"text",value:k.itemId,onChange:e=>C(s=>({...s,itemId:e.target.value})),placeholder:"Enter the ID of the item to link to",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:y===N})]})]}),(0,i.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,i.jsx)("button",{onClick:()=>P(N),disabled:y===N,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:y===N?"Creating Link...":"Create Link"}),(0,i.jsx)("button",{onClick:()=>{w(null),C({itemType:"assessment",itemId:""})},disabled:y===N,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 disabled:opacity-50",children:"Cancel"})]})]})})]}):(0,i.jsx)("div",{className:"".concat(r),role:"status",children:(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,i.jsx)("div",{className:"text-4xl mb-4","aria-hidden":"true",children:"\uD83D\uDCC2"}),(0,i.jsx)("div",{className:"text-gray-600 mb-2",children:"No evidence files found"}),(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"Upload files to see them here"})]})})}function c(e){let{evidence:s,onClose:t,onLinked:n,className:r=""}=e,[d,c]=(0,a.useState)({itemType:"",itemId:""}),[o,m]=(0,a.useState)(!1),[x,h]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{if(s&&d.itemType.trim()&&d.itemId.trim()){m(!0),h(null);try{await (0,l.tc)(s.id,{item_type:d.itemType.trim(),item_id:d.itemId.trim()}),c({itemType:"",itemId:""}),null==n||n()}catch(e){h(e instanceof Error?e.message:"Failed to create link")}finally{m(!1)}}},[s,d,n]);return s?(0,i.jsxs)("div",{className:"space-y-4 ".concat(r),children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Evidence Preview"}),t&&(0,i.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,i.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,i.jsxs)("div",{className:"flex items-start gap-4",children:[(0,i.jsx)("div",{className:"text-3xl",children:(0,l.LP)(s.mime_type)}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("h4",{className:"text-lg font-medium text-gray-900 truncate",children:s.filename}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-2 text-sm text-gray-600",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Size:"})," ",(0,l.sS)(s.size)]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Type:"})," ",s.mime_type]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"Uploaded:"})," ",new Date(s.uploaded_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"font-medium",children:"By:"})," ",s.uploaded_by]})]}),s.pii_flag&&(0,i.jsx)("div",{className:"mt-2 inline-flex items-center px-2 py-1 text-xs bg-orange-100 text-orange-700 rounded",children:"⚠️ Potential PII detected"})]})]})}),(0,i.jsxs)("div",{className:"bg-white border rounded-lg",children:[(0,i.jsxs)("div",{className:"border-b px-4 py-3",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900",children:"File Preview"}),(0,i.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Preview capabilities are being enhanced. Current view shows file structure and planned features."})]}),(0,i.jsx)("div",{className:"p-4",children:(()=>{if(!s)return null;let e=s.mime_type.startsWith("image/"),t=s.mime_type.includes("pdf"),a=s.mime_type.startsWith("text/"),n=s.mime_type.includes("document")||s.mime_type.includes("word"),r=s.mime_type.includes("sheet")||s.mime_type.includes("excel"),d=s.mime_type.includes("presentation")||s.mime_type.includes("powerpoint");return e?(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDBC️"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Image File"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Visual content preview - Enhanced viewer coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Type:"})," ",s.mime_type]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Resolution:"})," Preview will show actual dimensions"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Color Space:"})," Will display color profile information"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Usage:"})," Can be linked to assessment questions for evidence"]})]})})]}):t?(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCC4"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"PDF Document"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Document viewer with text search - Enhanced PDF viewer coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border space-y-3",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600",children:[(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:"Features Coming:"})}),(0,i.jsxs)("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[(0,i.jsx)("li",{children:"Page-by-page navigation"}),(0,i.jsx)("li",{children:"Text search and highlighting"}),(0,i.jsx)("li",{children:"Zoom and pan controls"}),(0,i.jsx)("li",{children:"Annotation and markup tools"}),(0,i.jsx)("li",{children:"Direct citation linking"})]})]})})]}):n?(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCDD"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Word Document"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Rich document viewer with formatting - Enhanced viewer coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Content Preview:"})," Will show formatted text, tables, and images"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Search:"})," Full-text search with context highlighting"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Navigation:"})," Section and heading-based navigation"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Linking:"})," Link specific paragraphs to assessment items"]})]})})]}):r?(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCA"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Spreadsheet"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Interactive data viewer - Enhanced spreadsheet viewer coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Data View:"})," Will display worksheets with filtering and sorting"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Charts:"})," Embedded charts and graphs will be rendered"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Export:"})," Extract specific data ranges for evidence"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Analysis:"})," Quick statistics and data validation"]})]})})]}):d?(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDFAF"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Presentation"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Slide viewer with thumbnails - Enhanced presentation viewer coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Slides:"})," Will show thumbnail grid and slide-by-slide view"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Content:"})," Text extraction and image preview"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Navigation:"})," Quick jump to specific slides"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Evidence:"})," Link individual slides to assessment questions"]})]})})]}):a?(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCC4"}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Text Document"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Syntax-highlighted text viewer - Enhanced text viewer coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Display:"})," Will show formatted text with line numbers"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Search:"})," Pattern matching and regex support"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Highlighting:"})," Syntax highlighting for code files"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Selection:"})," Quote specific lines for evidence"]})]})})]}):(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6",children:[(0,i.jsxs)("div",{className:"text-center mb-4",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:(0,l.LP)(s.mime_type)}),(0,i.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"File Preview"}),(0,i.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Specialized viewer for this file type - Enhanced preview coming soon"})]}),(0,i.jsx)("div",{className:"bg-white rounded p-4 border",children:(0,i.jsxs)("div",{className:"text-xs text-gray-600 space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Type:"})," ",s.mime_type]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Preview:"})," Custom viewer will be developed for this file type"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Download:"})," Full file access available through secure download"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("strong",{children:"Metadata:"})," File properties and embedded information will be extracted"]})]})})]})})()})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900",children:"Linked Items"}),0===s.linked_items.length?(0,i.jsx)("div",{className:"text-sm text-gray-500 italic",children:"No linked items"}):(0,i.jsx)("div",{className:"space-y-2",children:s.linked_items.map((e,s)=>(0,i.jsx)("div",{className:"flex items-center justify-between bg-blue-50 rounded px-3 py-2",children:(0,i.jsxs)("div",{className:"text-sm",children:[(0,i.jsxs)("span",{className:"font-medium",children:[e.item_type,":"]})," ",e.item_id]})},s))}),(0,i.jsxs)("div",{className:"border-t pt-3",children:[(0,i.jsx)("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Add New Link"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,i.jsx)("input",{type:"text",placeholder:"Item type (e.g., assessment)",value:d.itemType,onChange:e=>c(s=>({...s,itemType:e.target.value})),disabled:o,className:"px-3 py-2 border rounded text-sm"}),(0,i.jsx)("input",{type:"text",placeholder:"Item ID",value:d.itemId,onChange:e=>c(s=>({...s,itemId:e.target.value})),disabled:o,className:"px-3 py-2 border rounded text-sm"})]}),x&&(0,i.jsx)("div",{className:"text-sm text-red-600",children:x}),(0,i.jsx)("button",{onClick:u,disabled:o||!d.itemType.trim()||!d.itemId.trim(),className:"w-full px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Creating Link...":"Add Link"})]})]})]}),(0,i.jsxs)("div",{className:"border-t pt-4",children:[(0,i.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"File Metadata"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Evidence ID:"}),(0,i.jsx)("span",{className:"font-mono text-xs",children:s.id})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Checksum (SHA-256):"}),(0,i.jsxs)("span",{className:"font-mono text-xs cursor-pointer hover:bg-gray-100 px-1 rounded",onClick:()=>{navigator.clipboard.writeText(s.checksum_sha256),alert("Checksum copied to clipboard")},title:"Click to copy",children:[s.checksum_sha256.substring(0,16),"..."]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-gray-600",children:"Blob Path:"}),(0,i.jsx)("span",{className:"font-mono text-xs text-gray-500 truncate max-w-xs",children:s.blob_path})]})]})]})]}):(0,i.jsx)("div",{className:"".concat(r),children:(0,i.jsx)("div",{className:"flex items-center justify-center h-96 bg-gray-50 rounded border-2 border-dashed border-gray-300",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCC2"}),(0,i.jsx)("div",{className:"text-gray-600",children:"Select an evidence file to preview"})]})})})}var o=t(11265);function m(){let{engagementId:e}=(0,n.useParams)(),[s,t]=(0,a.useState)(null),[l,m]=(0,a.useState)(0),[x,h]=(0,a.useState)("table"),u=(0,o.QL)(),p=(0,a.useCallback)(e=>{m(e=>e+1),t(e),h("table"),setTimeout(()=>{let s=document.createElement("div");s.className="fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50",s.innerHTML="<strong>Success!</strong> ".concat(e.filename," uploaded successfully"),document.body.appendChild(s),setTimeout(()=>{s.remove()},5e3)},100)},[]),g=(0,a.useCallback)(e=>{t(e),h("preview")},[]),v=(0,a.useCallback)(()=>{m(e=>e+1)},[]),j=(0,a.useCallback)(()=>{t(null),h("table")},[]);return u.isLoading?(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)("div",{className:"text-center",children:"Loading..."})}):e?(0,i.jsxs)("div",{className:"p-6 space-y-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold",children:"Evidence Management"}),(0,i.jsx)("p",{className:"text-gray-600 mt-1",children:"Upload, organize, and link evidence files for this engagement"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 border rounded-lg p-1",children:[(0,i.jsx)("button",{onClick:()=>h("upload"),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat("upload"===x?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:"Upload"}),(0,i.jsx)("button",{onClick:()=>h("table"),className:"px-3 py-1 rounded text-sm font-medium transition-colors ".concat("table"===x?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:"Browse"}),(0,i.jsx)("button",{onClick:()=>h("preview"),disabled:!s,className:"px-3 py-1 rounded text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed ".concat("preview"===x?"bg-blue-600 text-white":"text-gray-600 hover:text-gray-900"),children:"Preview"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,i.jsxs)("div",{className:"lg:col-span-2",children:["upload"===x&&(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-medium mb-4",children:"Upload Evidence"}),(0,i.jsx)(r.Z,{onUploadComplete:p,className:"max-w-2xl"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-md font-medium mb-4",children:"Recent Uploads"}),(0,i.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Files appear here instantly after upload"}),(0,i.jsx)(d,{onEvidenceSelect:g,refreshTrigger:l,className:"max-h-96 overflow-y-auto",showLinkActions:!0})]})]}),"table"===x&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,i.jsx)("h2",{className:"text-lg font-medium",children:"Evidence Files"}),(0,i.jsx)("button",{onClick:()=>h("upload"),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Upload New File"})]}),(0,i.jsx)(d,{onEvidenceSelect:g,refreshTrigger:l,showLinkActions:!0})]}),"preview"===x&&(0,i.jsx)("div",{children:(0,i.jsx)(c,{evidence:s,onClose:j,onLinked:v})})]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,i.jsx)("h3",{className:"font-medium mb-3",children:"Quick Actions"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("button",{onClick:()=>h("upload"),className:"w-full px-3 py-2 text-left text-sm bg-white border rounded hover:bg-gray-50",children:"\uD83D\uDCE4 Upload Evidence"}),(0,i.jsx)("button",{onClick:()=>h("table"),className:"w-full px-3 py-2 text-left text-sm bg-white border rounded hover:bg-gray-50",children:"\uD83D\uDCCB Browse All Files"}),(0,i.jsx)("button",{onClick:()=>{s&&(navigator.clipboard.writeText(s.checksum_sha256),alert("Checksum copied to clipboard"))},disabled:!s,className:"w-full px-3 py-2 text-left text-sm bg-white border rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"\uD83D\uDCCB Copy Checksum"})]})]}),s&&(0,i.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,i.jsx)("h3",{className:"font-medium mb-2 text-blue-900",children:"Selected File"}),(0,i.jsxs)("div",{className:"text-sm space-y-1 text-blue-800",children:[(0,i.jsx)("div",{className:"font-medium truncate",children:s.filename}),(0,i.jsxs)("div",{children:["Size: ",(s.size/1024/1024).toFixed(1)," MB"]}),(0,i.jsxs)("div",{children:["Links: ",s.linked_items.length]}),s.pii_flag&&(0,i.jsx)("div",{className:"text-orange-700",children:"⚠️ Contains PII"})]}),(0,i.jsx)("button",{onClick:()=>h("preview"),className:"mt-3 w-full px-3 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"View Details"})]}),(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,i.jsx)("h3",{className:"font-medium mb-3",children:"Guidelines"}),(0,i.jsxs)("div",{className:"text-sm text-gray-600 space-y-2",children:[(0,i.jsx)("div",{children:"• Maximum file size: 25 MB"}),(0,i.jsx)("div",{children:"• Supported formats: PDF, DOCX, XLSX, PPTX, TXT, CSV, Images, ZIP"}),(0,i.jsx)("div",{children:"• Files are automatically scanned for PII"}),(0,i.jsx)("div",{children:"• Use links to connect evidence to assessments"}),(0,i.jsx)("div",{children:"• All uploads are audit logged"})]})]}),(0,i.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,i.jsx)("h3",{className:"font-medium mb-3",children:"Summary"}),(0,i.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,i.jsx)("div",{children:"\uD83D\uDCC1 Files: Loading..."}),(0,i.jsx)("div",{children:"\uD83D\uDD17 Links: Loading..."}),(0,i.jsx)("div",{children:"⚠️ PII Files: Loading..."})]})]})]})]})]}):(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)("div",{className:"text-center text-red-600",children:"No engagement selected."})})}},11265:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return l},QL:function(){return c},aC:function(){return d}});var i=t(57437),a=t(2265),n=t(99376);let r=(0,a.createContext)(null);function l(e){let{children:s}=e,[t,l]=(0,a.useState)(null),[d,c]=(0,a.useState)({mode:"demo",enabled:!0}),[o,m]=(0,a.useState)(!0),[x,h]=(0,a.useState)();async function u(){try{m(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let s=await e.json();if(c(s),"aad"===s.mode&&s.enabled){let e=await fetch("/api/auth/session");if(e.ok){let s=await e.json();s.user&&l({id:s.user.id,email:s.user.email,name:s.user.name,roles:s.user.roles,tenant_id:s.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&l({id:e,email:e,name:e.split("@")[0]})}}}catch(s){console.error("Auth initialization failed:",s),h(s instanceof Error?s.message:"Authentication failed"),c({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&l({id:e,email:e,name:e.split("@")[0]})}finally{m(!1)}}return(0,n.useRouter)(),(0,a.useEffect)(()=>{u()},[]),(0,i.jsx)(r.Provider,{value:{user:t,mode:d,isAuthenticated:!!t,isLoading:o,error:x},children:s})}function d(){let e=(0,a.useContext)(r);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let e=d(),s=(0,n.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":s.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,s]),e}},99376:function(e,s,t){"use strict";var i=t(35475);t.o(i,"useParams")&&t.d(s,{useParams:function(){return i.useParams}}),t.o(i,"usePathname")&&t.d(s,{usePathname:function(){return i.usePathname}}),t.o(i,"useRouter")&&t.d(s,{useRouter:function(){return i.useRouter}}),t.o(i,"useSearchParams")&&t.d(s,{useSearchParams:function(){return i.useSearchParams}})},40257:function(e,s,t){"use strict";var i,a;e.exports=(null==(i=t.g.process)?void 0:i.env)&&"object"==typeof(null==(a=t.g.process)?void 0:a.env)?t.g.process:t(44227)},44227:function(e){!function(){var s={229:function(e){var s,t,i,a=e.exports={};function n(){throw Error("setTimeout has not been defined")}function r(){throw Error("clearTimeout has not been defined")}function l(e){if(s===setTimeout)return setTimeout(e,0);if((s===n||!s)&&setTimeout)return s=setTimeout,setTimeout(e,0);try{return s(e,0)}catch(t){try{return s.call(null,e,0)}catch(t){return s.call(this,e,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:n}catch(e){s=n}try{t="function"==typeof clearTimeout?clearTimeout:r}catch(e){t=r}}();var d=[],c=!1,o=-1;function m(){c&&i&&(c=!1,i.length?d=i.concat(d):o=-1,d.length&&x())}function x(){if(!c){var e=l(m);c=!0;for(var s=d.length;s;){for(i=d,d=[];++o<s;)i&&i[o].run();o=-1,s=d.length}i=null,c=!1,function(e){if(t===clearTimeout)return clearTimeout(e);if((t===r||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(e);try{t(e)}catch(s){try{return t.call(null,e)}catch(s){return t.call(this,e)}}}(e)}}function h(e,s){this.fun=e,this.array=s}function u(){}a.nextTick=function(e){var s=Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)s[t-1]=arguments[t];d.push(new h(e,s)),1!==d.length||c||l(x)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=u,a.addListener=u,a.once=u,a.off=u,a.removeListener=u,a.removeAllListeners=u,a.emit=u,a.prependListener=u,a.prependOnceListener=u,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},t={};function i(e){var a=t[e];if(void 0!==a)return a.exports;var n=t[e]={exports:{}},r=!0;try{s[e](n,n.exports,i),r=!1}finally{r&&delete t[e]}return n.exports}i.ab="//";var a=i(229);e.exports=a}()}},function(e){e.O(0,[1,971,117,744],function(){return e(e.s=18811)}),_N_E=e.O()}]);