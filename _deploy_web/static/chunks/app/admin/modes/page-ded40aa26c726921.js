(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{86159:function(e,s,t){Promise.resolve().then(t.bind(t,95786))},95786:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a=t(57437),n=t(2265),r=t(11265),i=t(27648);function d(){var e;let s=(0,r.aC)(),[t,d]=(0,n.useState)(null),[l,c]=(0,n.useState)(!1),[o,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),[x,g]=(0,n.useState)(!0);async function f(){try{let e=await fetch("/api/admin/auth-diagnostics");c(e.ok)}catch(e){c(!1)}}async function b(){try{let e=await fetch("/api/admin/status");if(e.ok){let s=await e.json();d(s)}}catch(e){console.error("Failed to fetch system status:",e)}finally{g(!1)}}async function y(){var e;if(null===(e=s.user)||void 0===e?void 0:e.email){m(!0),h(null);try{let e=await fetch("/api/admin/demo-admins/self",{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok){let s=await e.json();h(s.message),s.was_added&&await f()}else{let s=await e.json();h("Failed to grant admin access: ".concat(s.detail||"Unknown error"))}}catch(e){h("Error: ".concat(e instanceof Error?e.message:"Network error"))}finally{m(!1)}}}return((0,n.useEffect)(()=>{var e;s.isAuthenticated&&(null===(e=s.user)||void 0===e?void 0:e.email)&&(f(),b())},[s.isAuthenticated,null===(e=s.user)||void 0===e?void 0:e.email]),s.isAuthenticated)?x?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto py-8 px-4",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"System Modes"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Current system configuration and administrative controls"})]}),t&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow mb-8",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Current Configuration"})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Authentication Mode"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 ".concat("aad"===t.auth_mode?"bg-green-500":"bg-blue-500")}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:t.auth_mode})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Data Backend"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:t.data_backend})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Storage Mode"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:t.storage_mode})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"RAG Mode"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 ".concat("on"===t.rag_mode?"bg-green-500":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:t.rag_mode})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Orchestrator Mode"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:t.orchestrator_mode})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500 mb-1",children:"Environment"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:t.environment}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["v",t.version]})]})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Administrative Access"})}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Current Status"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"inline-block w-3 h-3 rounded-full mr-2 ".concat(l?"bg-green-500":"bg-gray-400")}),(0,a.jsx)("span",{className:"text-gray-900",children:l?"Admin Access Granted":"No Admin Access"})]})]}),!l&&(null==t?void 0:t.auth_mode)==="demo"&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Demo Mode Admin Access"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"In demo mode, you can grant yourself administrative privileges to test admin features. This is only available in demo environments and is safe for testing purposes."}),(0,a.jsx)("button",{onClick:y,disabled:o,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Granting Access...":"Grant Me Admin Access"})]}),!l&&(null==t?void 0:t.auth_mode)!=="demo"&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Production Mode"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Administrative access is controlled by the ADMIN_EMAILS environment variable and Azure AD group membership. Contact your administrator to request access."})]}),l&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Admin Features"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"You have administrative access. You can manage system settings, view diagnostics, and access all administrative features."}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(i.default,{href:"/admin/presets",className:"bg-gray-100 text-gray-800 px-3 py-1 rounded text-sm hover:bg-gray-200",children:"Presets"}),(0,a.jsx)(i.default,{href:"/admin/ops",className:"bg-gray-100 text-gray-800 px-3 py-1 rounded text-sm hover:bg-gray-200",children:"Operations"}),(0,a.jsx)(i.default,{href:"/admin/auth-diagnostics",className:"bg-gray-100 text-gray-800 px-3 py-1 rounded text-sm hover:bg-gray-200",children:"Auth Diagnostics"}),(0,a.jsx)(i.default,{href:"/admin/gdpr",className:"bg-gray-100 text-gray-800 px-3 py-1 rounded text-sm hover:bg-gray-200",children:"GDPR"})]})]}),u&&(0,a.jsx)("div",{className:"mt-4 p-3 rounded-md ".concat(u.includes("Success")||u.includes("already has")?"bg-green-50 text-green-800 border border-green-200":"bg-red-50 text-red-800 border border-red-200"),children:u})]})})})]}),(0,a.jsx)("div",{className:"mt-8 text-center",children:(0,a.jsx)(i.default,{href:"/engagements",className:"text-blue-600 hover:text-blue-800",children:"← Back to Engagements"})})]})}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"You must be signed in to access this page."}),(0,a.jsx)(i.default,{href:"/signin",className:"text-blue-600 hover:text-blue-800",children:"Sign In"})]})})}},11265:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return d},QL:function(){return c},aC:function(){return l}});var a=t(57437),n=t(2265),r=t(99376);let i=(0,n.createContext)(null);function d(e){let{children:s}=e,[t,d]=(0,n.useState)(null),[l,c]=(0,n.useState)({mode:"demo",enabled:!0}),[o,m]=(0,n.useState)(!0),[u,h]=(0,n.useState)();async function x(){try{m(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let s=await e.json();if(c(s),"aad"===s.mode&&s.enabled){let e=await fetch("/api/auth/session");if(e.ok){let s=await e.json();s.user&&d({id:s.user.id,email:s.user.email,name:s.user.name,roles:s.user.roles,tenant_id:s.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&d({id:e,email:e,name:e.split("@")[0]})}}}catch(s){console.error("Auth initialization failed:",s),h(s instanceof Error?s.message:"Authentication failed"),c({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&d({id:e,email:e,name:e.split("@")[0]})}finally{m(!1)}}return(0,r.useRouter)(),(0,n.useEffect)(()=>{x()},[]),(0,a.jsx)(i.Provider,{value:{user:t,mode:l,isAuthenticated:!!t,isLoading:o,error:u},children:s})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let e=l(),s=(0,r.useRouter)();return(0,n.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":s.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,s]),e}},27648:function(e,s,t){"use strict";t.d(s,{default:function(){return n.a}});var a=t(72972),n=t.n(a)},99376:function(e,s,t){"use strict";var a=t(35475);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=86159)}),_N_E=e.O()}]);