(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[275],{74772:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var a=n(57437),s=n(2265),r=n(99376),i=n(4062);function c(e){let{enabled:t,onToggle:n,disabled:r=!1,className:i="",showStatus:c=!0,size:o="md"}=e,[l,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!0);async function x(){try{let e=await fetch("/api/proxy/system/rag-config");if(e.ok){let t=await e.json();d(t)}else d({mode:"none",enabled:!1,status:"offline"})}catch(e){console.warn("Failed to load RAG configuration:",e),d({mode:"none",enabled:!1,status:"offline"})}finally{m(!1)}}function h(){if(!l)return"Unknown";switch(l.status){case"healthy":return"Healthy";case"degraded":return"Degraded";case"offline":return"Offline";default:return"Unknown"}}(0,s.useEffect)(()=>{x()},[]);let g=function(){switch(o){case"sm":return{container:"text-sm",toggle:"w-9 h-5",thumb:"w-4 h-4",thumbTranslate:"translate-x-4",label:"text-xs",status:"text-xs"};case"lg":return{container:"text-lg",toggle:"w-14 h-8",thumb:"w-7 h-7",thumbTranslate:"translate-x-6",label:"text-base",status:"text-sm"};default:return{container:"text-base",toggle:"w-11 h-6",thumb:"w-5 h-5",thumbTranslate:"translate-x-5",label:"text-sm",status:"text-xs"}}}(),f=(null==l?void 0:l.enabled)&&(null==l?void 0:l.mode)!=="none",p=r||u||!f;return u?(0,a.jsxs)("div",{className:"flex items-center gap-2 ".concat(g.container," ").concat(i),children:[(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsx)("div",{className:"".concat(g.toggle," bg-gray-200 rounded-full")})}),(0,a.jsx)("span",{className:"text-gray-500",children:"Loading RAG status..."})]}):(0,a.jsxs)("div",{className:"flex items-center gap-2 ".concat(g.container," ").concat(i),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>!p&&n(!t),disabled:p,className:"\n            relative inline-flex ".concat(g.toggle," rounded-full border-2 border-transparent \n            transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 \n            focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed\n            ").concat(t&&f?"bg-blue-600":"bg-gray-200","\n          "),role:"switch","aria-checked":t&&f,"aria-label":"Toggle Grounded Analysis (RAG)",children:(0,a.jsx)("span",{className:"\n              ".concat(g.thumb," inline-block transform rounded-full bg-white shadow-lg \n              ring-0 transition duration-200 ease-in-out\n              ").concat(t&&f?g.thumbTranslate:"translate-x-0","\n            ")})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("label",{className:"".concat(g.label," font-medium text-gray-900 cursor-pointer"),onClick:()=>!p&&n(!t),children:"Grounded Analysis (RAG)"}),c&&(0,a.jsxs)("div",{className:"".concat(g.status," text-gray-500 flex items-center gap-1"),children:[(0,a.jsx)("span",{children:function(){if(!l)return"❓";switch(l.status){case"healthy":return"\uD83D\uDFE2";case"degraded":return"\uD83D\uDFE1";case"offline":return"\uD83D\uDD34";default:return"❓"}}()}),(0,a.jsx)("span",{children:h()}),(null==l?void 0:l.mode)&&"none"!==l.mode&&(0,a.jsxs)("span",{className:"text-blue-600",children:["• ",l.mode]})]})]})]}),!f&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-amber-600 bg-amber-50 px-2 py-1 rounded text-xs",children:[(0,a.jsx)("span",{children:"⚠️"}),(0,a.jsx)("span",{children:"RAG Unavailable"})]}),t&&l&&(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-600 text-xs",title:"RAG Configuration Details",children:"ℹ️"}),(0,a.jsx)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-10",children:(0,a.jsxs)("div",{className:"bg-gray-900 text-white text-xs rounded py-2 px-3 whitespace-nowrap",children:[(0,a.jsxs)("div",{children:["Mode: ",l.mode]}),(0,a.jsxs)("div",{children:["Status: ",h()]}),l.model&&(0,a.jsxs)("div",{children:["Model: ",l.model]}),l.last_check&&(0,a.jsxs)("div",{children:["Last Check: ",new Date(l.last_check).toLocaleTimeString()]}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})})]})]})}var o=n(34838);function l(e){var t,n;let{citation:r,engagementId:i,index:c,showScore:l=!0,isExpanded:d=!1,onToggleExpand:u}=e,[m,x]=(0,s.useState)(!1);async function h(){let e=(0,o.GR)(i,r.document_id);try{await navigator.clipboard.writeText(e)}catch(e){console.warn("Failed to copy link:",e)}}return(0,a.jsx)("div",{className:"border rounded-lg transition-all duration-200 ".concat(d?"ring-2 ring-blue-200 bg-blue-50/30":"bg-gray-50 hover:bg-gray-100"),children:(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-lg",children:function(e){var t;switch(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase()){case"pdf":return"\uD83D\uDCC4";case"doc":case"docx":return"\uD83D\uDCDD";case"txt":return"\uD83D\uDCC3";case"jpg":case"jpeg":case"png":case"gif":return"\uD83D\uDDBC️";default:return"\uD83D\uDCCE"}}(r.document_name)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium text-sm text-blue-700 truncate",children:r.document_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[l&&(0,a.jsxs)("span",{className:"px-2 py-0.5 rounded text-xs font-medium border ".concat((t=r.relevance_score)>=.8?"text-green-600 bg-green-50 border-green-200":t>=.6?"text-blue-600 bg-blue-50 border-blue-200":t>=.4?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-gray-600 bg-gray-50 border-gray-200"),children:[(n=r.relevance_score,"".concat((100*n).toFixed(1),"%"))," relevant"]}),r.page_number&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCD6 Page ",r.page_number]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCCD Section ",r.chunk_index+1]}),(0,a.jsxs)("span",{className:"text-blue-600",children:["#",c+1]})]})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("a",{href:(0,o.GR)(i,r.document_id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:"Open document",children:"\uD83D\uDCC4 View"}),(0,a.jsx)("button",{onClick:h,className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:"Copy document link",children:"\uD83D\uDD17 Copy"}),u&&(0,a.jsx)("button",{onClick:u,className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:d?"Collapse details":"Expand details",children:d?"▲":"▼"})]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"text-sm text-gray-700 italic border-l-3 border-blue-200 pl-3",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-blue-400 text-lg leading-none",children:'"'}),(0,a.jsx)("span",{className:"flex-1",children:r.excerpt}),(0,a.jsx)("span",{className:"text-blue-400 text-lg leading-none",children:'"'})]})})}),d&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[r.metadata&&Object.keys(r.metadata).length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Document Metadata"}),(0,a.jsx)("div",{className:"text-xs space-y-1",children:Object.entries(r.metadata).map(e=>{let[t,n]=e;return(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("span",{className:"w-20 text-gray-500 capitalize",children:[t,":"]}),(0,a.jsx)("span",{className:"text-gray-700 flex-1",children:String(n)})]},t)})})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsx)("div",{children:"• This excerpt was automatically extracted and ranked for relevance"}),(0,a.jsx)("div",{children:"• Citation accuracy depends on document quality and content structure"}),r.url&&(0,a.jsxs)("div",{children:["• Source URL: ",(0,a.jsx)("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:r.url})]})]})]})]})})}function d(e){let{citations:t,engagementId:n,className:r="",maxVisible:i=5,showScore:c=!0,allowExpansion:d=!0}=e,[u,m]=(0,s.useState)(!1),[x,h]=(0,s.useState)(new Set),g=u?t:t.slice(0,i),f=t.length>i;async function p(){let e=new Blob([JSON.stringify({timestamp:new Date().toISOString(),engagement_id:n,total_citations:t.length,citations:t.map((e,t)=>({citation_number:t+1,document_name:e.document_name,relevance_score:e.relevance_score,page_number:e.page_number,section:e.chunk_index+1,excerpt:e.excerpt,document_url:(0,o.GR)(n,e.document_id),metadata:e.metadata}))},null,2)],{type:"application/json"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="citations-".concat(n,"-").concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}return 0===t.length?null:(0,a.jsxs)("div",{className:"space-y-3 ".concat(r),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"font-medium text-sm text-gray-900",children:"Supporting Evidence"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[t.length," source",1!==t.length?"s":""]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[t.length>0&&(0,a.jsx)("button",{onClick:p,className:"text-xs text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-2 py-1 rounded transition-colors",children:"\uD83D\uDCCA Export"}),d&&x.size>0&&(0,a.jsx)("button",{onClick:()=>h(new Set),className:"text-xs text-gray-600 hover:text-gray-700",children:"Collapse All"})]})]}),(0,a.jsx)("div",{className:"space-y-2",children:g.map((e,t)=>(0,a.jsx)(l,{citation:e,engagementId:n,index:t,showScore:c,isExpanded:d&&x.has(t),onToggleExpand:d?()=>(function(e){let t=new Set(x);t.has(e)?t.delete(e):t.add(e),h(t)})(t):void 0},"".concat(e.document_id,"-").concat(e.chunk_index)))}),f&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("button",{onClick:()=>m(!u),className:"text-sm text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-3 py-1 rounded transition-colors",children:u?(0,a.jsxs)(a.Fragment,{children:["Show Less (",i," of ",t.length,")"]}):(0,a.jsxs)(a.Fragment,{children:["Show All Citations (",t.length,")"]})})}),(0,a.jsx)("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{children:["Average relevance: ",(t.reduce((e,t)=>e+t.relevance_score,0)/t.length*100).toFixed(1),"%"]}),(0,a.jsxs)("span",{children:["Quality: ",t.filter(e=>e.relevance_score>=.7).length,"/",t.length," high-confidence"]})]})})]})}function u(e){let{initialContent:t="",onAnalysisComplete:n,className:o=""}=e,{engagementId:l}=(0,r.useParams)(),[u,m]=(0,s.useState)(t),[x,h]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),[p,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),[v,w]=(0,s.useState)([]),[N,D]=(0,s.useState)(null),{isAvailable:_}=function(){let[e,t]=(0,s.useState)(null),[n,a]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async function(){try{let e=await fetch("/api/proxy/system/rag-config");if(e.ok){let n=await e.json();t(n)}}catch(e){console.warn("Failed to load RAG config:",e)}finally{a(!1)}})()},[]),{isAvailable:(null==e?void 0:e.enabled)&&(null==e?void 0:e.mode)!=="none",config:e,loading:n,status:(null==e?void 0:e.status)||"offline"}}();async function S(){if(u.trim()&&l)try{let e;if(y(!0),D(null),j(null),w([]),g&&_){let t=await fetch("/api/proxy/orchestrations/rag-analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:l,content:u.trim(),use_evidence:x,use_rag:!0,analysis_type:"analyze"})});if(!t.ok)throw Error("RAG analysis failed: ".concat(t.status));e=await t.json()}else e=await (0,i.$r)(l,u.trim(),x);if(j(e),e.citations&&e.citations.length>0)w(e.citations);else if((x||g)&&e.id)try{let t=await (0,i.LT)(e.id);w(t)}catch(e){console.warn("Failed to load citations:",e)}n&&n(e)}catch(e){D(e instanceof Error?e.message:"Analysis failed")}finally{y(!1)}}function k(e){return"string"==typeof e?e:e.content?e.content:e.analysis?e.analysis:JSON.stringify(e,null,2)}async function E(){if(!b)return;let e=new Blob([JSON.stringify({timestamp:new Date().toISOString(),engagement_id:l,analysis_mode:{use_evidence:x,use_rag:g,rag_available:_},input_content:u,analysis_result:{content:k(b),confidence_score:b.confidence_score,evidence_used:b.evidence_used,rag_grounding:b.rag_grounding,grounded_insights:b.grounded_insights,processing_time_ms:b.processing_time_ms},citations:v.map((e,t)=>({citation_number:t+1,document_name:e.document_name,relevance_score:e.relevance_score,page_number:e.page_number,section:e.chunk_index+1,excerpt:e.excerpt}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="analysis-".concat(g?"rag-":"").concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}return(0,a.jsxs)("div",{className:"space-y-4 ".concat(o),children:[(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"font-medium",children:g&&_?"\uD83E\uDD16 RAG-Enhanced Analysis":x?"\uD83D\uDCDA Evidence-Based Analysis":"\uD83D\uDD0D Standard Analysis"}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:b&&(0,a.jsx)("button",{onClick:E,className:"text-xs text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-2 py-1 rounded",children:"\uD83D\uDCCA Export"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),placeholder:g&&_?"Ask a question or describe what you want to analyze...":"Enter content to analyze...",className:"w-full h-32 px-3 py-2 border rounded-md text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:x,onChange:e=>h(e.target.checked),disabled:p,className:"rounded"}),(0,a.jsx)("span",{children:"Use Evidence from Documents"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"(Search uploaded documents for relevant content)"})]}),(0,a.jsx)(c,{enabled:g,onToggle:f,disabled:p,size:"sm",className:"ml-6"})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:S,disabled:p||!u.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed min-w-[120px]",children:p?"Analyzing...":g&&_?"Analyze with AI":"Analyze"})})]})]}),N&&(0,a.jsx)("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:N})]}),b&&(0,a.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"font-medium",children:"Analysis Result"}),b.confidence_score&&(0,a.jsxs)("span",{className:"text-xs px-2 py-0.5 rounded ".concat(b.confidence_score>=.8?"bg-green-100 text-green-800":b.confidence_score>=.6?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:[(100*b.confidence_score).toFixed(0),"% confidence"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[b.evidence_used&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-700 bg-green-50 px-2 py-1 rounded",children:[(0,a.jsx)("span",{children:"\uD83D\uDCDA"}),(0,a.jsx)("span",{children:"Evidence Used"})]}),b.use_rag&&_&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-700 bg-blue-50 px-2 py-1 rounded",children:[(0,a.jsx)("span",{children:"\uD83E\uDD16"}),(0,a.jsx)("span",{children:"RAG Enhanced"})]})]})]}),b.rag_grounding&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"font-medium text-sm text-blue-900 mb-2",children:"\uD83E\uDD16 AI Grounding Summary"}),(0,a.jsx)("div",{className:"text-sm text-blue-800",children:b.rag_grounding})]}),(0,a.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,a.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",children:k(b)})}),b.grounded_insights&&b.grounded_insights.length>0&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[(0,a.jsx)("div",{className:"font-medium text-sm text-green-900 mb-2",children:"\uD83D\uDCA1 Key Insights from Evidence"}),(0,a.jsx)("ul",{className:"text-sm text-green-800 space-y-1",children:b.grounded_insights.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-green-600 mt-0.5",children:"•"}),(0,a.jsx)("span",{children:e})]},t))})]}),v.length>0&&(0,a.jsx)(d,{citations:v,engagementId:l,showScore:!0,allowExpansion:!0}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Analysis completed at ",new Date().toLocaleString()]}),b.processing_time_ms&&(0,a.jsxs)("span",{children:["Processing time: ",b.processing_time_ms,"ms"]})]}),(b.evidence_used||b.use_rag)&&(0,a.jsxs)("div",{className:"flex justify-between",children:[v.length>0&&(0,a.jsxs)("span",{children:["Evidence sources: ",v.length]}),b.evidence_quality_score&&(0,a.jsxs)("span",{children:["Evidence quality: ",(100*b.evidence_quality_score).toFixed(1),"%"]})]}),b.recommendations_count&&(0,a.jsxs)("div",{children:["Recommendations generated: ",b.recommendations_count]})]})]})]})}},44621:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(57437),s=n(2265),r=n(99376),i=n(4062),c=n(34838),o=n(16023);function l(){let{engagementId:e}=(0,r.useParams)(),[t,n]=(0,s.useState)([]),[l,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[x,h]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),[p,y]=(0,s.useState)({});async function b(){if(e)try{d(!0);let t=await (0,i.EK)(e);n(t);let a={};t.forEach(e=>{e.ingestion_status&&(a[e.id]=e.ingestion_status)}),y(a),m(null)}catch(e){m(e instanceof Error?e.message:"Failed to load documents")}finally{d(!1)}}async function j(){if(e&&0!==t.length)try{let t=await (0,i.te)(e),n={};t.forEach(e=>{n[e.document_id]=e}),y(n)}catch(e){console.warn("Failed to poll ingestion statuses:",e)}}async function v(t){let n=t.target.files;if(n&&e)try{h(!0),await (0,c.$6)(e,Array.from(n)),await b(),t.target.value=""}catch(e){m(e instanceof Error?e.message:"Upload failed")}finally{h(!1)}}async function w(t){if(e)try{await (0,i.Hj)(e,t),y(e=>({...e,[t]:{document_id:t,status:"processing"}}))}catch(e){m(e instanceof Error?e.message:"Ingestion failed")}}async function N(){if(e)try{f(!0);let n=await (0,i.kR)({engagement_id:e}),a={};t.forEach(e=>{a[e.id]={document_id:e.id,status:"processing"}}),y(a),m(null),m("✓ ".concat(n.message)),setTimeout(()=>m(u),3e3)}catch(e){m(e instanceof Error?e.message:"Bulk reindex failed")}finally{f(!1)}}async function D(t){if(e)try{await (0,c.oe)(e,t),await b()}catch(e){m(e instanceof Error?e.message:"Delete failed")}}return((0,s.useEffect)(()=>{if(!e)return;b();let t=setInterval(j,5e3);return()=>clearInterval(t)},[e]),l)?(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsx)("div",{className:"font-medium mb-2",children:"Documents"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Loading documents..."})]}):(0,a.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"font-medium",children:"Documents & Evidence"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,o.GJ)()&&(0,a.jsx)("button",{onClick:N,disabled:g||0===t.length,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Reindexing...":"Reindex All"}),(0,a.jsxs)("label",{className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 cursor-pointer",children:[x?"Uploading...":"Upload Files",(0,a.jsx)("input",{type:"file",multiple:!0,onChange:v,disabled:x,className:"hidden",accept:".pdf,.docx,.xlsx,.csv,.md,.txt,.png,.jpg,.jpeg"})]})]})]}),u&&(0,a.jsx)("div",{className:"text-sm px-3 py-2 rounded ".concat(u.startsWith("✓")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:u}),0===t.length?(0,a.jsx)("div",{className:"text-sm text-gray-500 text-center py-4",children:"No documents uploaded yet."}):(0,a.jsx)("div",{className:"space-y-2",children:t.map(t=>{let n=p[t.id]||t.ingestion_status;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"text-lg",children:function(e){if(!e)return"⚪";switch(e.status){case"completed":return"✅";case"processing":return"\uD83D\uDD04";case"pending":return"⏳";case"failed":return"❌";default:return"⚪"}}(n)}),(0,a.jsx)("span",{className:"font-medium text-sm truncate",children:t.filename})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsxs)("div",{children:["Size: ",(t.size/1024).toFixed(1)," KB • Uploaded: ",new Date(t.uploaded_at).toLocaleDateString()]}),(0,a.jsxs)("div",{children:["Status: ",function(e){if(!e)return"Not indexed";switch(e.status){case"completed":return"Indexed (".concat(e.chunks_created||0," chunks)");case"processing":return"Processing...";case"pending":return"Pending";case"failed":return"Failed: ".concat(e.error_message||"Unknown error");default:return"Unknown"}}(n)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(!n||"failed"===n.status)&&(0,a.jsx)("button",{onClick:()=>w(t.id),className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:"Ingest"}),(0,a.jsx)("a",{href:(0,c.GR)(e,t.id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-gray-50 text-gray-700 rounded hover:bg-gray-100",children:"Download"}),(0,a.jsx)("button",{onClick:()=>D(t.id),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100",children:"Delete"})]})]},t.id)})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[t.length," document",1!==t.length?"s":""," •",Object.values(p).filter(e=>"completed"===e.status).length," indexed for evidence search"]})]})}},39344:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var a=n(57437),s=n(2265),r=n(99376),i=n(4062),c=n(34838);function o(e){let{className:t="",onResultSelect:n,maxResults:o=10}=e,{engagementId:l}=(0,r.useParams)(),[d,u]=(0,s.useState)(""),[m,x]=(0,s.useState)([]),[h,g]=(0,s.useState)(!1),[f,p]=(0,s.useState)(null),[y,b]=(0,s.useState)(null);async function j(e){if(e.preventDefault(),d.trim()&&l)try{g(!0),p(null);let e=await (0,i.Zg)({query:d.trim(),top_k:o,score_threshold:.1,engagement_id:l});x(e.results),b(e)}catch(e){p(e instanceof Error?e.message:"Search failed"),x([]),b(null)}finally{g(!1)}}async function v(){if(!m.length)return;let e=new Blob([JSON.stringify({query:d,timestamp:new Date().toISOString(),engagement_id:l,results:m.map(e=>({content:e.content,score:e.score,document_name:e.document_name,page_number:e.page_number}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="evidence-search-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}return(0,a.jsxs)("div",{className:"space-y-4 ".concat(t),children:[(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsx)("div",{className:"font-medium mb-3",children:"Evidence Search"}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Search for evidence in uploaded documents...",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:h}),(0,a.jsx)("button",{type:"submit",disabled:h||!d.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Searching...":"Search"})]}),y&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["Found ",y.total_results," results in ",y.processing_time_ms,"ms"]}),m.length>0&&(0,a.jsx)("button",{type:"button",onClick:v,className:"text-blue-600 hover:text-blue-700",children:"Export Results"})]})]}),f&&(0,a.jsx)("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:f})]}),m.length>0&&(0,a.jsx)("div",{className:"space-y-3",children:m.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{n&&n(e)},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,a.jsxs)("span",{children:["Score: ",(100*e.score).toFixed(1),"%"]}),e.page_number&&(0,a.jsxs)("span",{children:["• Page ",e.page_number]}),(0,a.jsxs)("span",{children:["• Chunk ",e.chunk_index+1]})]})]}),(0,a.jsx)("div",{className:"flex gap-1",children:(0,a.jsx)("a",{href:(0,c.GR)(l,e.document_id),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"View"})})]}),(0,a.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:function(e,t){if(!t.trim())return e;let n=t.toLowerCase().split(/\s+/),a=e;return n.forEach(e=>{if(e.length>2){let t=RegExp("(".concat(e,")"),"gi");a=a.replace(t,'<mark class="bg-yellow-200">$1</mark>')}}),a}(e.content,d)}})]},t))}),d&&!h&&0===m.length&&y&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsxs)("div",{className:"text-sm",children:['No evidence found for "',d,'"']}),(0,a.jsx)("div",{className:"text-xs mt-1",children:"Try different keywords or check if documents are indexed"})]})]})}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return i},Sg:function(){return o},tQ:function(){return c}});var a=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){let e=(0,a.OD)(),t=(0,a.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r(),a=new AbortController,i=setTimeout(()=>a.abort(),t.timeout||3e4);try{let r=await fetch("".concat(s).concat(e),{...t,signal:a.signal,headers:{...n,...t.headers}});if(clearTimeout(i),!r.ok){let e=await r.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(r.status))}return r.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function c(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let a=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!a.ok)throw Error("Preset ".concat(e," not found"));return a.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let o=s;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return o},K3:function(){return r},OD:function(){return s},Pk:function(){return c},d8:function(){return i}});var a=n(40257);function s(){return localStorage.getItem("email")||""}function r(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function c(e){return s()||(await e.push("/signin"),"")}function o(){let e=s();return(a.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},34838:function(e,t,n){"use strict";n.d(t,{$6:function(){return r},CZ:function(){return s},GR:function(){return i},Xj:function(){return o},oe:function(){return c}});var a=n(29116);async function s(e){let t=await fetch("".concat(a.Sg,"/engagements/").concat(e,"/docs"),{headers:(0,a.$V)()});if(!t.ok)throw Error("listDocs ".concat(t.status));return t.json()}async function r(e,t){let n=new FormData;t.forEach(e=>n.append("files",e));let s={method:"POST",headers:(0,a.$V)(!0),body:n},r=await fetch("".concat(a.Sg,"/engagements/").concat(e,"/docs"),s);if(!r.ok){let e="uploadDocs failed with status ".concat(r.status);try{let t=await r.text();t&&(e+=": ".concat(t))}catch(t){e+=" (unable to read error details)"}throw Error(e)}return r.json()}function i(e,t){return"".concat(a.Sg,"/engagements/").concat(e,"/docs/").concat(t)}async function c(e,t){let n=await fetch("".concat(a.Sg,"/engagements/").concat(e,"/docs/").concat(t),{method:"DELETE",headers:(0,a.$V)()});if(!n.ok)throw Error("deleteDoc ".concat(n.status));return n.json()}async function o(e,t){let n=await fetch("".concat(a.Sg,"/orchestrations/analyze-doc"),{method:"POST",headers:(0,a.$V)(),body:JSON.stringify({doc_id:t})});if(!n.ok)throw Error("analyzeDoc ".concat(n.status));return n.json()}},4062:function(e,t,n){"use strict";n.d(t,{$r:function(){return l},EK:function(){return o},Hi:function(){return m},Hj:function(){return i},LB:function(){return f},LP:function(){return b},LT:function(){return d},W2:function(){return p},Zg:function(){return s},fG:function(){return g},fj:function(){return u},kR:function(){return c},q8:function(){return x},sS:function(){return y},tc:function(){return h},te:function(){return r}});var a=n(29116);async function s(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function r(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function i(e,t){let n=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function c(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function o(e){let[t,n]=await Promise.all([(0,a.SC)("/engagements/".concat(e,"/docs")),r(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:n.find(t=>t.document_id===e.id)}))}async function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:n})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(a.status));return a.json()}async function d(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function u(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||"SAS generation failed: ".concat(t.status));return t.json()}async function m(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||"Upload completion failed: ".concat(t.status));return t.json()}async function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:n.toString()}),s=await fetch("/api/proxy/evidence?".concat(a));if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Failed to list evidence"}))).detail||"Failed to list evidence: ".concat(s.status));let r=await s.json(),i=parseInt(s.headers.get("X-Total-Count")||"0"),c=parseInt(s.headers.get("X-Page")||"1"),o=parseInt(s.headers.get("X-Page-Size")||"50");return{data:r,total:i,page:c,page_size:o,total_pages:parseInt(s.headers.get("X-Total-Pages")||"1"),has_next:"true"===s.headers.get("X-Has-Next"),has_previous:"true"===s.headers.get("X-Has-Previous")}}async function h(e,t){let n=await fetch("/api/proxy/evidence/".concat(e,"/links"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Evidence linking failed"}))).detail||"Evidence linking failed: ".concat(n.status));return n.json()}async function g(e,t){let n=await fetch("/api/proxy/evidence/".concat(e,"/links/").concat(t),{method:"DELETE"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||"Evidence unlinking failed: ".concat(n.status));return n.json()}async function f(e,t){let n=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!n.ok)throw Error("Azure upload failed: ".concat(n.statusText))}async function p(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function y(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function b(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}},99376:function(e,t,n){"use strict";var a=n(35475);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},40257:function(e,t,n){"use strict";var a,s;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,a,s=e.exports={};function r(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var o=[],l=!1,d=-1;function u(){l&&a&&(l=!1,a.length?o=a.concat(o):d=-1,o.length&&m())}function m(){if(!l){var e=c(u);l=!0;for(var t=o.length;t;){for(a=o,o=[];++d<t;)a&&a[d].run();d=-1,t=o.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function x(e,t){this.fun=e,this.array=t}function h(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new x(e,t)),1!==o.length||l||c(m)},x.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=h,s.addListener=h,s.once=h,s.off=h,s.removeListener=h,s.removeAllListeners=h,s.emit=h,s.prependListener=h,s.prependOnceListener=h,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}},i=!0;try{t[e](r,r.exports,a),i=!1}finally{i&&delete n[e]}return r.exports}a.ab="//";var s=a(229);e.exports=s}()}}]);