# Staging Environment Configuration
# Copy to .env.staging and update with actual values

# =============================================================================
# INFRASTRUCTURE CONFIGURATION
# =============================================================================

# Azure Subscription and Resource Configuration
AZURE_SUBSCRIPTION_ID=00000000-0000-0000-0000-000000000000
AZURE_TENANT_ID=00000000-0000-0000-0000-000000000000
AZURE_CLIENT_ID=00000000-0000-0000-0000-000000000000

# Resource Group and Naming
AZURE_RESOURCE_GROUP=rg-aecma-staging
AZURE_LOCATION=eastus

# Container Apps Environment
ACA_ENV=cae-aecma-staging
ACA_RG=rg-aecma-staging
ACA_APP_API=api-staging
ACA_APP_WEB=web-staging
ACA_APP_MCP=mcp-staging

# =============================================================================
# APPLICATION URLS (Auto-generated by Azure Container Apps)
# =============================================================================

# Primary application endpoints
STAGING_URL=https://web-staging.region.azurecontainerapps.io
API_BASE_URL=https://api-staging.region.azurecontainerapps.io
MCP_GATEWAY_URL=https://mcp-staging.region.azurecontainerapps.io

# Health check endpoints
WEB_HEALTH_URL=${STAGING_URL}/api/health
API_HEALTH_URL=${API_BASE_URL}/health
MCP_HEALTH_URL=${MCP_GATEWAY_URL}/health

# =============================================================================
# MANAGED IDENTITY (No secrets required)
# =============================================================================

# Use Azure Managed Identity for service authentication
USE_MANAGED_IDENTITY=true
STAGING_IDENTITY_NAME=staging-identity

# =============================================================================
# AZURE SERVICES CONFIGURATION
# =============================================================================

# Cosmos DB (Document storage with engagement isolation)
AZURE_COSMOS_ACCOUNT_NAME=cosmos-aecma-staging
AZURE_COSMOS_DATABASE_NAME=ai_maturity
COSMOS_ENDPOINT=https://cosmos-aecma-staging.documents.azure.com:443/

# AI Search (RAG and document indexing)
AZURE_SEARCH_SERVICE_NAME=search-aecma-staging
AZURE_SEARCH_INDEX_NAME=eng-docs
SEARCH_ENDPOINT=https://search-aecma-staging.search.windows.net

# OpenAI (LLM and embedding services)
AZURE_OPENAI_SERVICE_NAME=openai-aecma-staging
AZURE_OPENAI_ENDPOINT=https://openai-aecma-staging.openai.azure.com/
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-large

# Storage Account (File storage and static assets)
AZURE_STORAGE_ACCOUNT_NAME=staaemcastaging
AZURE_STORAGE_CONTAINER_NAME=documents
STORAGE_ENDPOINT=https://staaemcastaging.blob.core.windows.net/

# Key Vault (Secrets management)
AZURE_KEY_VAULT_NAME=kv-aecma-staging
KEY_VAULT_ENDPOINT=https://kv-aecma-staging.vault.azure.net/

# =============================================================================
# AUTHENTICATION & AUTHORIZATION
# =============================================================================

# ABAC Configuration (Engagement-scoped access control)
ABAC_ENABLED=true
ENGAGEMENT_ISOLATION=true
JWT_ALGORITHM=RS256
JWT_AUDIENCE=https://aecma-staging.azurecontainerapps.io

# Session and Security
SESSION_SECRET=generate-secure-random-key-for-staging
CORS_ORIGINS=https://web-staging.region.azurecontainerapps.io
ALLOWED_HOSTS=*.azurecontainerapps.io,localhost

# =============================================================================
# RAG CONFIGURATION
# =============================================================================

# RAG Service Settings
RAG_MODE=enabled
RAG_CHUNK_SIZE=1000
RAG_CHUNK_OVERLAP=100
RAG_TOP_K=5
RAG_SIMILARITY_THRESHOLD=0.7

# Embedding Configuration  
EMBEDDING_MODEL=text-embedding-3-large
EMBEDDING_DIMENSION=3072
EMBEDDING_BATCH_SIZE=16

# Search Configuration
SEARCH_SEMANTIC_CONFIG=default
SEARCH_QUERY_TYPE=semantic
SEARCH_SELECT_FIELDS=content,metadata,title

# =============================================================================
# MCP TOOLS CONFIGURATION
# =============================================================================

# Model Context Protocol Gateway
MCP_ENABLED=true
MCP_GATEWAY_PORT=8200
MCP_TOOLS_ENABLED=pdf.parse,transcribe,pptx.render

# External Connectors (Optional in staging)
MCP_CONNECTORS_SP=false      # SharePoint connector
MCP_CONNECTORS_JIRA=false    # Jira connector
MCP_CONNECTORS_AUDIO=true    # Audio transcription

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Environment Settings
STAGING_ENV=true
UAT_MODE=true
DEBUG_MODE=true

# S4 Features (All enabled for staging testing)
S4_CSF_TAXONOMY=true
S4_WORKSHOP_CONSENT=true
S4_MINUTES_IMMUTABLE=true
S4_GOVERNANCE_CHECKS=true

# Security Features
SECURITY_GATES_ENABLED=true
AUDIT_VERBOSE=true
PII_SCRUB_ENABLED=true

# Performance Monitoring
PERFORMANCE_MONITORING=true
ENABLE_METRICS=true
TELEMETRY_ENABLED=true

# =============================================================================
# LOGGING & MONITORING
# =============================================================================

# Log Configuration
LOG_LEVEL=DEBUG
LOG_FORMAT=json
LOG_CORRELATION_ID=true

# Application Insights (Optional)
APPINSIGHTS_INSTRUMENTATIONKEY=00000000-0000-0000-0000-000000000000
APPINSIGHTS_CONNECTION_STRING=InstrumentationKey=00000000-0000-0000-0000-000000000000

# Performance Thresholds (in milliseconds)
API_RESPONSE_THRESHOLD=5000
SEARCH_RESPONSE_THRESHOLD=3000
RAG_RESPONSE_THRESHOLD=10000

# =============================================================================
# CONTAINER APPS CONFIGURATION
# =============================================================================

# Scaling Settings
MIN_REPLICAS=1
MAX_REPLICAS=3
TARGET_HTTP_CONCURRENCY=10

# Resource Limits (Staging optimized)
CPU_LIMIT=1.0
MEMORY_LIMIT=2Gi
CPU_REQUEST=0.5
MEMORY_REQUEST=1Gi

# Health Check Configuration
HEALTH_CHECK_PATH=/health
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_RETRIES=3

# =============================================================================
# CI/CD CONFIGURATION
# =============================================================================

# GitHub Container Registry
GHCR_ENABLED=1
CONTAINER_REGISTRY=ghcr.io
IMAGE_TAG=staging

# Deployment Configuration
DEPLOYMENT_ENVIRONMENT=staging
DEPLOYMENT_VERIFICATION=true
ROLLBACK_ENABLED=true

# =============================================================================
# SECURITY NOTES
# =============================================================================

# IMPORTANT: 
# 1. Never commit actual secrets - use Azure Key Vault references
# 2. Use Managed Identity where possible to avoid credential management
# 3. Rotate staging secrets regularly (every 90 days)
# 4. Enable audit logging for all administrative actions
# 5. Use Private Endpoints for database connections in production
# 6. Ensure ABAC policies are tested with engagement-scoped data
# 7. Validate PII scrubbing in all UAT scenarios
# 8. Monitor for unusual access patterns and potential security issues

# Key Vault References (Use these patterns for secrets):
# SECRET_NAME="@Microsoft.KeyVault(SecretUri=https://kv-aecma-staging.vault.azure.net/secrets/secret-name/)"

# =============================================================================
# TESTING & VALIDATION
# =============================================================================

# Test Data Configuration
TEST_DATA_ENABLED=true
SAMPLE_ENGAGEMENTS=eng-test-001,eng-test-002
SAMPLE_USERS=test.user@staging.local

# UAT Configuration
UAT_CHECKLIST_ENABLED=true
UAT_VALIDATION_MODE=strict
UAT_CONSENT_REQUIRED=true

# Verification Scripts
VERIFY_HEALTH_CHECKS=true
VERIFY_ABAC_ENFORCEMENT=true
VERIFY_AUDIT_TRAILS=true