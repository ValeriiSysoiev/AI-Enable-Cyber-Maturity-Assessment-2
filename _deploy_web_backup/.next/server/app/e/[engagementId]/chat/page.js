(()=>{var e={};e.id=379,e.ids=[379],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84359:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o}),s(84619),s(56698),s(35866);var r=s(23191),a=s(88716),n=s(37922),l=s.n(n),i=s(95231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let o=["",{children:["e",{children:["[engagementId]",{children:["chat",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,84619)),"/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/chat/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,56698)),"/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/chat/page.tsx"],m="/e/[engagementId]/chat/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/e/[engagementId]/chat/page",pathname:"/e/[engagementId]/chat",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},60176:(e,t,s)=>{Promise.resolve().then(s.bind(s,20647))},20647:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(10326),a=s(17577),n=s(35047),l=s(6824);async function i(e,t,s){return(0,l.SC)("/chat/message",{method:"POST",headers:{"Content-Type":"application/json","X-Engagement-ID":e},body:JSON.stringify({message:t,correlation_id:s})})}var d=s(79682);function o({message:e,className:t=""}){let s="user"===e.sender;return r.jsx("div",{className:`flex ${s?"justify-end":"justify-start"} mb-4 ${t}`,children:(0,r.jsxs)("div",{className:`max-w-[70%] px-4 py-2 rounded-lg ${s?"bg-blue-500 text-white rounded-br-sm":"bg-gray-100 text-gray-900 rounded-bl-sm"}`,children:[r.jsx("div",{className:"whitespace-pre-wrap break-words",children:e.message}),r.jsx("div",{className:`text-xs mt-1 ${s?"text-blue-100":"text-gray-500"}`,children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})}function c({runCard:e,className:t=""}){let s={queued:"bg-yellow-50 border-yellow-200 text-yellow-800",running:"bg-blue-50 border-blue-200 text-blue-800",done:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800"};return(0,r.jsxs)("div",{className:`border rounded-lg p-4 ${s[e.status]} ${t}`,children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-lg",children:{queued:"⏳",running:"⚡",done:"✅",error:"❌"}[e.status]}),r.jsx("code",{className:"font-mono text-sm bg-black/10 px-2 py-1 rounded",children:e.command})]}),r.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full uppercase tracking-wide ${s[e.status]}`,children:e.status})]}),(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[r.jsx("span",{children:"Created:"}),r.jsx("span",{children:new Date(e.created_at).toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[r.jsx("span",{children:"By:"}),r.jsx("span",{children:e.created_by})]})]}),Object.keys(e.inputs).length>0&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20",children:[r.jsx("div",{className:"text-xs font-medium mb-1",children:"Inputs:"}),r.jsx("div",{className:"text-xs bg-black/10 rounded p-2 font-mono",children:JSON.stringify(e.inputs,null,2)})]}),e.outputs&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20",children:[r.jsx("div",{className:"text-xs font-medium mb-1",children:"Results:"}),r.jsx("div",{className:"text-xs bg-black/10 rounded p-2 font-mono",children:JSON.stringify(e.outputs,null,2)})]}),e.citations&&e.citations.length>0&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20",children:[r.jsx("div",{className:"text-xs font-medium mb-1",children:"Citations:"}),r.jsx("div",{className:"text-xs space-y-1",children:e.citations.map((e,t)=>r.jsx("div",{className:"bg-black/10 rounded px-2 py-1 font-mono",children:e},t))})]})]})}function m({onSend:e,disabled:t=!1,placeholder:s="Type a message or use /command...",className:n=""}){let[l,i]=(0,a.useState)(""),[d,o]=(0,a.useState)(!1),[c,m]=(0,a.useState)(-1),u=(0,a.useRef)(null),x=l.startsWith("/")?[{command:"/ingest",description:"Ingest and process documents",example:"/ingest docs"},{command:"/minutes",description:"Generate meeting minutes from audio",example:"/minutes recording.mp3"},{command:"/score",description:"Calculate assessment scores",example:"/score assessment-id"}].filter(e=>e.command.startsWith(l.split(" ")[0])):[],g=()=>{let s=l.trim();s&&!t&&(e(s),i(""),o(!1))},p=e=>{i(e.example),o(!1),u.current?.focus()},h=null!==function(e){let t=e.trim();if(!t.startsWith("/"))return null;let s=t.indexOf(" ");return -1===s?{command:t,args:""}:{command:t.substring(0,s),args:t.substring(s+1).trim()}}(l);return(0,r.jsxs)("div",{className:`relative ${n}`,children:[d&&x.length>0&&r.jsx("div",{className:"absolute bottom-full mb-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:x.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>p(e),className:`w-full text-left px-4 py-3 hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg ${t===c?"bg-blue-50 border-r-2 border-blue-500":""}`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("div",{className:"font-mono font-medium text-blue-600",children:e.command}),r.jsx("div",{className:"text-sm text-gray-600",children:e.description})]}),r.jsx("div",{className:"text-xs text-gray-400 ml-2",children:"Tab to use"})]}),r.jsx("div",{className:"text-xs text-gray-500 font-mono mt-1",children:e.example})]},e.command))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[r.jsx("textarea",{ref:u,value:l,onChange:e=>i(e.target.value),onKeyDown:e=>{d&&x.length>0&&("ArrowDown"===e.key?(e.preventDefault(),m(e=>e<x.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),m(e=>e>0?e-1:x.length-1)):"Tab"===e.key&&(e.preventDefault(),c>=0&&(i(x[c].example),o(!1)))),"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())},disabled:t,placeholder:s,rows:1,className:`w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ${h?"border-blue-300 bg-blue-50":""} ${t?"opacity-50":""}`,style:{minHeight:"48px",maxHeight:"120px"}}),h&&r.jsx("div",{className:"absolute top-1 right-1 px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded font-medium",children:"COMMAND"})]}),r.jsx("button",{onClick:g,disabled:t||!l.trim(),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Send"})]}),l.startsWith("/")&&!d&&r.jsx("div",{className:"mt-1 text-sm text-gray-500",children:"Available commands: /ingest, /minutes, /score"})]})}function u(){let{engagementId:e}=(0,n.useParams)(),t=(0,d.QL)(),[s,l]=(0,a.useState)([]),[u,x]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0),[h,b]=(0,a.useState)(!1),[f,y]=(0,a.useState)(""),j=(0,a.useRef)(null);(0,a.useRef)(null);let v=async t=>{if(e&&!h)try{b(!0),y("");let s=await i(e,t);l(e=>[...e,s])}catch(e){y(e.message||"Failed to send message")}finally{b(!1)}};if(t.isLoading||g)return r.jsx("div",{className:"p-6",children:r.jsx("div",{className:"text-center",children:"Loading chat..."})});if(!e)return r.jsx("div",{className:"p-6",children:"No engagement selected."});let N=u.filter(e=>["queued","running"].includes(e.status)),w=u.filter(e=>["done","error"].includes(e.status));return(0,r.jsxs)("div",{className:"flex flex-col h-screen max-h-screen",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b bg-white",children:[r.jsx("h1",{className:"text-2xl font-semibold",children:"Chat Shell"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Send messages or use commands like ",r.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"/ingest docs"})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex gap-6 p-6 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 border rounded-lg bg-gray-50 p-4",children:[f&&r.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:f}),0===s.length&&!f&&(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[r.jsx("p",{children:"No messages yet. Start a conversation!"}),(0,r.jsxs)("p",{className:"text-sm mt-2",children:["Try: ",r.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"/ingest docs"})]})]}),s.map(e=>r.jsx(o,{message:e},e.id)),r.jsx("div",{ref:j})]}),r.jsx(m,{onSend:v,disabled:h,placeholder:h?"Sending...":"Type a message or use /command..."})]}),(0,r.jsxs)("div",{className:"w-80 flex flex-col gap-4",children:[N.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Active Commands"}),r.jsx("div",{className:"space-y-2",children:N.map(e=>r.jsx(c,{runCard:e},e.id))})]}),w.length>0&&(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Recent Results"}),r.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:w.slice(0,5).map(e=>r.jsx(c,{runCard:e},e.id))})]}),0===u.length&&r.jsx("div",{className:"text-center text-gray-500 py-8",children:r.jsx("p",{className:"text-sm",children:"No commands executed yet."})})]})]})]})}},6824:(e,t,s)=>{"use strict";s.d(t,{$V:()=>o,SC:()=>l,Sg:()=>d,tQ:()=>i});var r=s(2991);let a=process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function n(){let e=(0,r.OD)(),t=(0,r.K3)(),s={};return e&&(s["X-User-Email"]=e),t&&(s["X-Engagement-ID"]=t),s}async function l(e,t={}){let s=n(),r=new AbortController,l=setTimeout(()=>r.abort(),t.timeout||3e4);try{let n=await fetch(`${a}${e}`,{...t,signal:r.signal,headers:{...s,...t.headers}});if(clearTimeout(l),!n.ok){let e=await n.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||`Request failed: ${n.status}`)}return n.json()}catch(e){if(clearTimeout(l),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function i(e){let t=new AbortController,s=setTimeout(()=>t.abort(),3e4);try{let r=await fetch(`${a}/presets/${e}`,{cache:"no-store",signal:t.signal});if(clearTimeout(s),!r.ok)throw Error(`Preset ${e} not found`);return r.json()}catch(t){if(clearTimeout(s),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let d=a;function o(e=!1){let t=n();return e||(t["Content-Type"]="application/json"),t}},2991:(e,t,s)=>{"use strict";function r(){return""}function a(){return""}function n(e){}function l(){return(process.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes("")}s.d(t,{GJ:()=>l,K3:()=>a,OD:()=>r,d8:()=>n})},84619:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/chat/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,878,183],()=>s(84359));module.exports=r})();