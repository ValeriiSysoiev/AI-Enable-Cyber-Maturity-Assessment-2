"use strict";exports.id=284,exports.ids=[284],exports.modules={41046:(e,t,s)=>{s.d(t,{Z:()=>u});var a=s(10326),n=s(17577),r=s(35047),i=s(23820);function l({enabled:e,onToggle:t,disabled:s=!1,className:r="",showStatus:i=!0,size:l="md"}){let[c,d]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0);function x(){if(!c)return"Unknown";switch(c.status){case"healthy":return"Healthy";case"degraded":return"Degraded";case"offline":return"Offline";default:return"Unknown"}}let m=function(){switch(l){case"sm":return{container:"text-sm",toggle:"w-9 h-5",thumb:"w-4 h-4",thumbTranslate:"translate-x-4",label:"text-xs",status:"text-xs"};case"lg":return{container:"text-lg",toggle:"w-14 h-8",thumb:"w-7 h-7",thumbTranslate:"translate-x-6",label:"text-base",status:"text-sm"};default:return{container:"text-base",toggle:"w-11 h-6",thumb:"w-5 h-5",thumbTranslate:"translate-x-5",label:"text-sm",status:"text-xs"}}}(),h=c?.enabled&&c?.mode!=="none",g=s||o||!h;return o?(0,a.jsxs)("div",{className:`flex items-center gap-2 ${m.container} ${r}`,children:[a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:`${m.toggle} bg-gray-200 rounded-full`})}),a.jsx("span",{className:"text-gray-500",children:"Loading RAG status..."})]}):(0,a.jsxs)("div",{className:`flex items-center gap-2 ${m.container} ${r}`,children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{type:"button",onClick:()=>!g&&t(!e),disabled:g,className:`
            relative inline-flex ${m.toggle} rounded-full border-2 border-transparent 
            transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 
            focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed
            ${e&&h?"bg-blue-600":"bg-gray-200"}
          `,role:"switch","aria-checked":e&&h,"aria-label":"Toggle Grounded Analysis (RAG)",children:a.jsx("span",{className:`
              ${m.thumb} inline-block transform rounded-full bg-white shadow-lg 
              ring-0 transition duration-200 ease-in-out
              ${e&&h?m.thumbTranslate:"translate-x-0"}
            `})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[a.jsx("label",{className:`${m.label} font-medium text-gray-900 cursor-pointer`,onClick:()=>!g&&t(!e),children:"Grounded Analysis (RAG)"}),i&&(0,a.jsxs)("div",{className:`${m.status} text-gray-500 flex items-center gap-1`,children:[a.jsx("span",{children:function(){if(!c)return"❓";switch(c.status){case"healthy":return"\uD83D\uDFE2";case"degraded":return"\uD83D\uDFE1";case"offline":return"\uD83D\uDD34";default:return"❓"}}()}),a.jsx("span",{children:x()}),c?.mode&&"none"!==c.mode&&(0,a.jsxs)("span",{className:"text-blue-600",children:["• ",c.mode]})]})]})]}),!h&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-amber-600 bg-amber-50 px-2 py-1 rounded text-xs",children:[a.jsx("span",{children:"⚠️"}),a.jsx("span",{children:"RAG Unavailable"})]}),e&&c&&(0,a.jsxs)("div",{className:"relative group",children:[a.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 text-xs",title:"RAG Configuration Details",children:"ℹ️"}),a.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-10",children:(0,a.jsxs)("div",{className:"bg-gray-900 text-white text-xs rounded py-2 px-3 whitespace-nowrap",children:[(0,a.jsxs)("div",{children:["Mode: ",c.mode]}),(0,a.jsxs)("div",{children:["Status: ",x()]}),c.model&&(0,a.jsxs)("div",{children:["Model: ",c.model]}),c.last_check&&(0,a.jsxs)("div",{children:["Last Check: ",new Date(c.last_check).toLocaleTimeString()]}),a.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})})]})]})}var c=s(13488);function d({citation:e,engagementId:t,index:s,showScore:r=!0,isExpanded:i=!1,onToggleExpand:l}){var d,o;let[u,x]=(0,n.useState)(!1);async function m(){let s=(0,c.GR)(t,e.document_id);try{await navigator.clipboard.writeText(s)}catch(e){console.warn("Failed to copy link:",e)}}return a.jsx("div",{className:`border rounded-lg transition-all duration-200 ${i?"ring-2 ring-blue-200 bg-blue-50/30":"bg-gray-50 hover:bg-gray-100"}`,children:(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[a.jsx("div",{className:"flex-1 min-w-0",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-lg",children:function(e){switch(e.split(".").pop()?.toLowerCase()){case"pdf":return"\uD83D\uDCC4";case"doc":case"docx":return"\uD83D\uDCDD";case"txt":return"\uD83D\uDCC3";case"jpg":case"jpeg":case"png":case"gif":return"\uD83D\uDDBC️";default:return"\uD83D\uDCCE"}}(e.document_name)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[r&&(0,a.jsxs)("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${(d=e.relevance_score)>=.8?"text-green-600 bg-green-50 border-green-200":d>=.6?"text-blue-600 bg-blue-50 border-blue-200":d>=.4?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-gray-600 bg-gray-50 border-gray-200"}`,children:[(o=e.relevance_score,`${(100*o).toFixed(1)}%`)," relevant"]}),e.page_number&&(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCD6 Page ",e.page_number]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCCD Section ",e.chunk_index+1]}),(0,a.jsxs)("span",{className:"text-blue-600",children:["#",s+1]})]})]})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx("a",{href:(0,c.GR)(t,e.document_id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:"Open document",children:"\uD83D\uDCC4 View"}),a.jsx("button",{onClick:m,className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:"Copy document link",children:"\uD83D\uDD17 Copy"}),l&&a.jsx("button",{onClick:l,className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:i?"Collapse details":"Expand details",children:i?"▲":"▼"})]})]}),a.jsx("div",{className:"relative",children:a.jsx("div",{className:"text-sm text-gray-700 italic border-l-3 border-blue-200 pl-3",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-blue-400 text-lg leading-none",children:'"'}),a.jsx("span",{className:"flex-1",children:e.excerpt}),a.jsx("span",{className:"text-blue-400 text-lg leading-none",children:'"'})]})})}),i&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[e.metadata&&Object.keys(e.metadata).length>0&&(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Document Metadata"}),a.jsx("div",{className:"text-xs space-y-1",children:Object.entries(e.metadata).map(([e,t])=>(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsxs)("span",{className:"w-20 text-gray-500 capitalize",children:[e,":"]}),a.jsx("span",{className:"text-gray-700 flex-1",children:String(t)})]},e))})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[a.jsx("div",{children:"• This excerpt was automatically extracted and ranked for relevance"}),a.jsx("div",{children:"• Citation accuracy depends on document quality and content structure"}),e.url&&(0,a.jsxs)("div",{children:["• Source URL: ",a.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:e.url})]})]})]})]})})}function o({citations:e,engagementId:t,className:s="",maxVisible:r=5,showScore:i=!0,allowExpansion:l=!0}){let[o,u]=(0,n.useState)(!1),[x,m]=(0,n.useState)(new Set),h=o?e:e.slice(0,r),g=e.length>r;async function p(){let s=new Blob([JSON.stringify({timestamp:new Date().toISOString(),engagement_id:t,total_citations:e.length,citations:e.map((e,s)=>({citation_number:s+1,document_name:e.document_name,relevance_score:e.relevance_score,page_number:e.page_number,section:e.chunk_index+1,excerpt:e.excerpt,document_url:(0,c.GR)(t,e.document_id),metadata:e.metadata}))},null,2)],{type:"application/json"}),a=URL.createObjectURL(s),n=document.createElement("a");n.href=a,n.download=`citations-${t}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}return 0===e.length?null:(0,a.jsxs)("div",{className:`space-y-3 ${s}`,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Supporting Evidence"}),(0,a.jsxs)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[e.length," source",1!==e.length?"s":""]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.length>0&&a.jsx("button",{onClick:p,className:"text-xs text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-2 py-1 rounded transition-colors",children:"\uD83D\uDCCA Export"}),l&&x.size>0&&a.jsx("button",{onClick:()=>m(new Set),className:"text-xs text-gray-600 hover:text-gray-700",children:"Collapse All"})]})]}),a.jsx("div",{className:"space-y-2",children:h.map((e,s)=>a.jsx(d,{citation:e,engagementId:t,index:s,showScore:i,isExpanded:l&&x.has(s),onToggleExpand:l?()=>(function(e){let t=new Set(x);t.has(e)?t.delete(e):t.add(e),m(t)})(s):void 0},`${e.document_id}-${e.chunk_index}`))}),g&&a.jsx("div",{className:"text-center",children:a.jsx("button",{onClick:()=>u(!o),className:"text-sm text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-3 py-1 rounded transition-colors",children:o?(0,a.jsxs)(a.Fragment,{children:["Show Less (",r," of ",e.length,")"]}):(0,a.jsxs)(a.Fragment,{children:["Show All Citations (",e.length,")"]})})}),a.jsx("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{children:["Average relevance: ",(e.reduce((e,t)=>e+t.relevance_score,0)/e.length*100).toFixed(1),"%"]}),(0,a.jsxs)("span",{children:["Quality: ",e.filter(e=>e.relevance_score>=.7).length,"/",e.length," high-confidence"]})]})})]})}function u({initialContent:e="",onAnalysisComplete:t,className:s=""}){let{engagementId:c}=(0,r.useParams)(),[d,u]=(0,n.useState)(e),[x,m]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),[b,y]=(0,n.useState)(null),[j,v]=(0,n.useState)([]),[w,N]=(0,n.useState)(null),{isAvailable:D}=function(){let[e,t]=(0,n.useState)(null),[s,a]=(0,n.useState)(!0);return{isAvailable:e?.enabled&&e?.mode!=="none",config:e,loading:s,status:e?.status||"offline"}}();async function _(){if(d.trim()&&c)try{let e;if(f(!0),N(null),y(null),v([]),h&&D){let t=await fetch("/api/proxy/orchestrations/rag-analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:c,content:d.trim(),use_evidence:x,use_rag:!0,analysis_type:"analyze"})});if(!t.ok)throw Error(`RAG analysis failed: ${t.status}`);e=await t.json()}else e=await (0,i.$r)(c,d.trim(),x);if(y(e),e.citations&&e.citations.length>0)v(e.citations);else if((x||h)&&e.id)try{let t=await (0,i.LT)(e.id);v(t)}catch(e){console.warn("Failed to load citations:",e)}t&&t(e)}catch(e){N(e instanceof Error?e.message:"Analysis failed")}finally{f(!1)}}function S(e){return"string"==typeof e?e:e.content?e.content:e.analysis?e.analysis:JSON.stringify(e,null,2)}async function k(){if(!b)return;let e=new Blob([JSON.stringify({timestamp:new Date().toISOString(),engagement_id:c,analysis_mode:{use_evidence:x,use_rag:h,rag_available:D},input_content:d,analysis_result:{content:S(b),confidence_score:b.confidence_score,evidence_used:b.evidence_used,rag_grounding:b.rag_grounding,grounded_insights:b.grounded_insights,processing_time_ms:b.processing_time_ms},citations:j.map((e,t)=>({citation_number:t+1,document_name:e.document_name,relevance_score:e.relevance_score,page_number:e.page_number,section:e.chunk_index+1,excerpt:e.excerpt}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`analysis-${h?"rag-":""}${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}return(0,a.jsxs)("div",{className:`space-y-4 ${s}`,children:[(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("div",{className:"font-medium",children:h&&D?"\uD83E\uDD16 RAG-Enhanced Analysis":x?"\uD83D\uDCDA Evidence-Based Analysis":"\uD83D\uDD0D Standard Analysis"}),a.jsx("div",{className:"flex items-center gap-2",children:b&&a.jsx("button",{onClick:k,className:"text-xs text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-2 py-1 rounded",children:"\uD83D\uDCCA Export"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("textarea",{value:d,onChange:e=>u(e.target.value),placeholder:h&&D?"Ask a question or describe what you want to analyze...":"Enter content to analyze...",className:"w-full h-32 px-3 py-2 border rounded-md text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),disabled:p,className:"rounded"}),a.jsx("span",{children:"Use Evidence from Documents"}),a.jsx("span",{className:"text-xs text-gray-500",children:"(Search uploaded documents for relevant content)"})]}),a.jsx(l,{enabled:h,onToggle:g,disabled:p,size:"sm",className:"ml-6"})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{onClick:_,disabled:p||!d.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed min-w-[120px]",children:p?"Analyzing...":h&&D?"Analyze with AI":"Analyze"})})]})]}),w&&a.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:w})]}),b&&(0,a.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"font-medium",children:"Analysis Result"}),b.confidence_score&&(0,a.jsxs)("span",{className:`text-xs px-2 py-0.5 rounded ${b.confidence_score>=.8?"bg-green-100 text-green-800":b.confidence_score>=.6?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[(100*b.confidence_score).toFixed(0),"% confidence"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[b.evidence_used&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-700 bg-green-50 px-2 py-1 rounded",children:[a.jsx("span",{children:"\uD83D\uDCDA"}),a.jsx("span",{children:"Evidence Used"})]}),b.use_rag&&D&&(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-700 bg-blue-50 px-2 py-1 rounded",children:[a.jsx("span",{children:"\uD83E\uDD16"}),a.jsx("span",{children:"RAG Enhanced"})]})]})]}),b.rag_grounding&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[a.jsx("div",{className:"font-medium text-sm text-blue-900 mb-2",children:"\uD83E\uDD16 AI Grounding Summary"}),a.jsx("div",{className:"text-sm text-blue-800",children:b.rag_grounding})]}),a.jsx("div",{className:"prose prose-sm max-w-none",children:a.jsx("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",children:S(b)})}),b.grounded_insights&&b.grounded_insights.length>0&&(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsx("div",{className:"font-medium text-sm text-green-900 mb-2",children:"\uD83D\uDCA1 Key Insights from Evidence"}),a.jsx("ul",{className:"text-sm text-green-800 space-y-1",children:b.grounded_insights.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-green-600 mt-0.5",children:"•"}),a.jsx("span",{children:e})]},t))})]}),j.length>0&&a.jsx(o,{citations:j,engagementId:c,showScore:!0,allowExpansion:!0}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t space-y-1",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Analysis completed at ",new Date().toLocaleString()]}),b.processing_time_ms&&(0,a.jsxs)("span",{children:["Processing time: ",b.processing_time_ms,"ms"]})]}),(b.evidence_used||b.use_rag)&&(0,a.jsxs)("div",{className:"flex justify-between",children:[j.length>0&&(0,a.jsxs)("span",{children:["Evidence sources: ",j.length]}),b.evidence_quality_score&&(0,a.jsxs)("span",{children:["Evidence quality: ",(100*b.evidence_quality_score).toFixed(1),"%"]})]}),b.recommendations_count&&(0,a.jsxs)("div",{children:["Recommendations generated: ",b.recommendations_count]})]})]})]})}},31827:(e,t,s)=>{s.d(t,{Z:()=>d});var a=s(10326),n=s(17577),r=s(35047),i=s(23820),l=s(13488),c=s(2991);function d(){let{engagementId:e}=(0,r.useParams)(),[t,s]=(0,n.useState)([]),[d,o]=(0,n.useState)(!0),[u,x]=(0,n.useState)(null),[m,h]=(0,n.useState)(!1),[g,p]=(0,n.useState)(!1),[f,b]=(0,n.useState)({});async function y(){if(e)try{o(!0);let t=await (0,i.EK)(e);s(t);let a={};t.forEach(e=>{e.ingestion_status&&(a[e.id]=e.ingestion_status)}),b(a),x(null)}catch(e){x(e instanceof Error?e.message:"Failed to load documents")}finally{o(!1)}}async function j(t){let s=t.target.files;if(s&&e)try{h(!0),await (0,l.$6)(e,Array.from(s)),await y(),t.target.value=""}catch(e){x(e instanceof Error?e.message:"Upload failed")}finally{h(!1)}}async function v(t){if(e)try{await (0,i.Hj)(e,t),b(e=>({...e,[t]:{document_id:t,status:"processing"}}))}catch(e){x(e instanceof Error?e.message:"Ingestion failed")}}async function w(){if(e)try{p(!0);let s=await (0,i.kR)({engagement_id:e}),a={};t.forEach(e=>{a[e.id]={document_id:e.id,status:"processing"}}),b(a),x(null),x(`✓ ${s.message}`),setTimeout(()=>x(u),3e3)}catch(e){x(e instanceof Error?e.message:"Bulk reindex failed")}finally{p(!1)}}async function N(t){if(e)try{await (0,l.oe)(e,t),await y()}catch(e){x(e instanceof Error?e.message:"Delete failed")}}return d?(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-2",children:"Documents"}),a.jsx("div",{className:"text-sm text-gray-500",children:"Loading documents..."})]}):(0,a.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"font-medium",children:"Documents & Evidence"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,c.GJ)()&&a.jsx("button",{onClick:w,disabled:g||0===t.length,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Reindexing...":"Reindex All"}),(0,a.jsxs)("label",{className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 cursor-pointer",children:[m?"Uploading...":"Upload Files",a.jsx("input",{type:"file",multiple:!0,onChange:j,disabled:m,className:"hidden",accept:".pdf,.docx,.xlsx,.csv,.md,.txt,.png,.jpg,.jpeg"})]})]})]}),u&&a.jsx("div",{className:`text-sm px-3 py-2 rounded ${u.startsWith("✓")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:u}),0===t.length?a.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:"No documents uploaded yet."}):a.jsx("div",{className:"space-y-2",children:t.map(t=>{let s=f[t.id]||t.ingestion_status;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-lg",children:function(e){if(!e)return"⚪";switch(e.status){case"completed":return"✅";case"processing":return"\uD83D\uDD04";case"pending":return"⏳";case"failed":return"❌";default:return"⚪"}}(s)}),a.jsx("span",{className:"font-medium text-sm truncate",children:t.filename})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsxs)("div",{children:["Size: ",(t.size/1024).toFixed(1)," KB • Uploaded: ",new Date(t.uploaded_at).toLocaleDateString()]}),(0,a.jsxs)("div",{children:["Status: ",function(e){if(!e)return"Not indexed";switch(e.status){case"completed":return`Indexed (${e.chunks_created||0} chunks)`;case"processing":return"Processing...";case"pending":return"Pending";case"failed":return`Failed: ${e.error_message||"Unknown error"}`;default:return"Unknown"}}(s)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(!s||"failed"===s.status)&&a.jsx("button",{onClick:()=>v(t.id),className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:"Ingest"}),a.jsx("a",{href:(0,l.GR)(e,t.id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-gray-50 text-gray-700 rounded hover:bg-gray-100",children:"Download"}),a.jsx("button",{onClick:()=>N(t.id),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100",children:"Delete"})]})]},t.id)})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[t.length," document",1!==t.length?"s":""," •",Object.values(f).filter(e=>"completed"===e.status).length," indexed for evidence search"]})]})}},34783:(e,t,s)=>{s.d(t,{Z:()=>c});var a=s(10326),n=s(17577),r=s(35047),i=s(23820),l=s(13488);function c({className:e="",onResultSelect:t,maxResults:s=10}){let{engagementId:c}=(0,r.useParams)(),[d,o]=(0,n.useState)(""),[u,x]=(0,n.useState)([]),[m,h]=(0,n.useState)(!1),[g,p]=(0,n.useState)(null),[f,b]=(0,n.useState)(null);async function y(e){if(e.preventDefault(),d.trim()&&c)try{h(!0),p(null);let e=await (0,i.Zg)({query:d.trim(),top_k:s,score_threshold:.1,engagement_id:c});x(e.results),b(e)}catch(e){p(e instanceof Error?e.message:"Search failed"),x([]),b(null)}finally{h(!1)}}async function j(){if(!u.length)return;let e=new Blob([JSON.stringify({query:d,timestamp:new Date().toISOString(),engagement_id:c,results:u.map(e=>({content:e.content,score:e.score,document_name:e.document_name,page_number:e.page_number}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`evidence-search-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}return(0,a.jsxs)("div",{className:`space-y-4 ${e}`,children:[(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-3",children:"Evidence Search"}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"Search for evidence in uploaded documents...",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m}),a.jsx("button",{type:"submit",disabled:m||!d.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Searching...":"Search"})]}),f&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["Found ",f.total_results," results in ",f.processing_time_ms,"ms"]}),u.length>0&&a.jsx("button",{type:"button",onClick:j,className:"text-blue-600 hover:text-blue-700",children:"Export Results"})]})]}),g&&a.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:g})]}),u.length>0&&a.jsx("div",{className:"space-y-3",children:u.map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{t&&t(e)},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,a.jsxs)("span",{children:["Score: ",(100*e.score).toFixed(1),"%"]}),e.page_number&&(0,a.jsxs)("span",{children:["• Page ",e.page_number]}),(0,a.jsxs)("span",{children:["• Chunk ",e.chunk_index+1]})]})]}),a.jsx("div",{className:"flex gap-1",children:a.jsx("a",{href:(0,l.GR)(c,e.document_id),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"View"})})]}),a.jsx("div",{className:"text-sm text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:function(e,t){if(!t.trim())return e;let s=t.toLowerCase().split(/\s+/),a=e;return s.forEach(e=>{if(e.length>2){let t=RegExp(`(${e})`,"gi");a=a.replace(t,'<mark class="bg-yellow-200">$1</mark>')}}),a}(e.content,d)}})]},s))}),d&&!m&&0===u.length&&f&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsxs)("div",{className:"text-sm",children:['No evidence found for "',d,'"']}),a.jsx("div",{className:"text-xs mt-1",children:"Try different keywords or check if documents are indexed"})]})]})}},6824:(e,t,s)=>{s.d(t,{$V:()=>d,SC:()=>i,Sg:()=>c,tQ:()=>l});var a=s(2991);let n=process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){let e=(0,a.OD)(),t=(0,a.K3)(),s={};return e&&(s["X-User-Email"]=e),t&&(s["X-Engagement-ID"]=t),s}async function i(e,t={}){let s=r(),a=new AbortController,i=setTimeout(()=>a.abort(),t.timeout||3e4);try{let r=await fetch(`${n}${e}`,{...t,signal:a.signal,headers:{...s,...t.headers}});if(clearTimeout(i),!r.ok){let e=await r.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||`Request failed: ${r.status}`)}return r.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function l(e){let t=new AbortController,s=setTimeout(()=>t.abort(),3e4);try{let a=await fetch(`${n}/presets/${e}`,{cache:"no-store",signal:t.signal});if(clearTimeout(s),!a.ok)throw Error(`Preset ${e} not found`);return a.json()}catch(t){if(clearTimeout(s),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=n;function d(e=!1){let t=r();return e||(t["Content-Type"]="application/json"),t}},2991:(e,t,s)=>{function a(){return""}function n(){return""}function r(e){}function i(){return(process.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes("")}s.d(t,{GJ:()=>i,K3:()=>n,OD:()=>a,d8:()=>r})},13488:(e,t,s)=>{s.d(t,{$6:()=>r,CZ:()=>n,GR:()=>i,Xj:()=>c,oe:()=>l});var a=s(6824);async function n(e){let t=await fetch(`${a.Sg}/engagements/${e}/docs`,{headers:(0,a.$V)()});if(!t.ok)throw Error(`listDocs ${t.status}`);return t.json()}async function r(e,t){let s=new FormData;t.forEach(e=>s.append("files",e));let n={method:"POST",headers:(0,a.$V)(!0),body:s},r=await fetch(`${a.Sg}/engagements/${e}/docs`,n);if(!r.ok){let e=`uploadDocs failed with status ${r.status}`;try{let t=await r.text();t&&(e+=`: ${t}`)}catch(t){e+=" (unable to read error details)"}throw Error(e)}return r.json()}function i(e,t){return`${a.Sg}/engagements/${e}/docs/${t}`}async function l(e,t){let s=await fetch(`${a.Sg}/engagements/${e}/docs/${t}`,{method:"DELETE",headers:(0,a.$V)()});if(!s.ok)throw Error(`deleteDoc ${s.status}`);return s.json()}async function c(e,t){let s=await fetch(`${a.Sg}/orchestrations/analyze-doc`,{method:"POST",headers:(0,a.$V)(),body:JSON.stringify({doc_id:t})});if(!s.ok)throw Error(`analyzeDoc ${s.status}`);return s.json()}},23820:(e,t,s)=>{s.d(t,{$r:()=>d,EK:()=>c,Hi:()=>x,Hj:()=>i,LB:()=>p,LP:()=>y,LT:()=>o,W2:()=>f,Zg:()=>n,fG:()=>g,fj:()=>u,kR:()=>l,q8:()=>m,sS:()=>b,tc:()=>h,te:()=>r});var a=s(6824);async function n(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||`Search failed: ${t.status}`);return t.json()}async function r(e){let t=await fetch(`/api/proxy/engagements/${e}/docs/ingestion-status`);if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||`Request failed: ${t.status}`);return t.json()}async function i(e,t){let s=await fetch(`/api/proxy/engagements/${e}/docs/${t}/ingest`,{method:"POST"});if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Ingestion failed"}))).detail||`Request failed: ${s.status}`);return s.json()}async function l(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||`Request failed: ${t.status}`);return t.json()}async function c(e){let[t,s]=await Promise.all([(0,a.SC)(`/engagements/${e}/docs`),r(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:s.find(t=>t.document_id===e.id)}))}async function d(e,t,s=!1){let a=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:s})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Analysis failed"}))).detail||`Request failed: ${a.status}`);return a.json()}async function o(e){let t=await fetch(`/api/proxy/analysis/${e}/citations`);if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||`Request failed: ${t.status}`);return t.json()}async function u(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||`SAS generation failed: ${t.status}`);return t.json()}async function x(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||`Upload completion failed: ${t.status}`);return t.json()}async function m(e,t=1,s=50){let a=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:s.toString()}),n=await fetch(`/api/proxy/evidence?${a}`);if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Failed to list evidence"}))).detail||`Failed to list evidence: ${n.status}`);let r=await n.json(),i=parseInt(n.headers.get("X-Total-Count")||"0"),l=parseInt(n.headers.get("X-Page")||"1"),c=parseInt(n.headers.get("X-Page-Size")||"50");return{data:r,total:i,page:l,page_size:c,total_pages:parseInt(n.headers.get("X-Total-Pages")||"1"),has_next:"true"===n.headers.get("X-Has-Next"),has_previous:"true"===n.headers.get("X-Has-Previous")}}async function h(e,t){let s=await fetch(`/api/proxy/evidence/${e}/links`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Evidence linking failed"}))).detail||`Evidence linking failed: ${s.status}`);return s.json()}async function g(e,t){let s=await fetch(`/api/proxy/evidence/${e}/links/${t}`,{method:"DELETE"});if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||`Evidence unlinking failed: ${s.status}`);return s.json()}async function p(e,t){let s=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!s.ok)throw Error(`Azure upload failed: ${s.statusText}`)}async function f(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function b(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function y(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}}};