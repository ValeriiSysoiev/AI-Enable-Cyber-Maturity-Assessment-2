From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Valentyn Sysoiev <svvval@Valentyns-MacBook-Air.local>
Date: Tue, 19 Aug 2025 13:00:37 -0600
Subject: [PATCH 89/90] Add GHCR build workflow and fix Dockerfile CMD
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

ðŸ¤– Generated with Claude Code

diff --git a/.github/workflows/build_api_ghcr.yml b/.github/workflows/build_api_ghcr.yml
new file mode 100644
index 0000000000000000000000000000000000000000..971465da60f4022c3ee24b4cfc329927f313fa20
--- /dev/null
+++ b/.github/workflows/build_api_ghcr.yml
@@ -0,0 +1,39 @@
+name: Build API to GHCR
+
+on:
+  workflow_dispatch:
+  push:
+    branches: [ main ]
+    paths: [ 'app/**' ]
+
+permissions:
+  contents: read
+  packages: write
+
+jobs:
+  build-push:
+    runs-on: ubuntu-latest
+    steps:
+      - name: Checkout
+        uses: actions/checkout@v4
+
+      - name: Set up Docker Buildx
+        uses: docker/setup-buildx-action@v3
+
+      - name: Login to GHCR
+        uses: docker/login-action@v3
+        with:
+          registry: ghcr.io
+          username: ${{ github.repository_owner }}
+          password: ${{ github.token }}
+
+      - name: Build and push
+        uses: docker/build-push-action@v5
+        with:
+          context: ./app
+          file: ./app/Dockerfile
+          platforms: linux/amd64
+          push: true
+          tags: |
+            ghcr.io/${{ github.repository_owner }}/ai-cybermat-api:prod-${{ github.sha }}
+            ghcr.io/${{ github.repository_owner }}/ai-cybermat-api:latest
\ No newline at end of file
diff --git a/app/Dockerfile b/app/Dockerfile
index cb54a552e9149a58d99c1fd45a599436ff12f122..98cd5f75055ce979fe772e6ce46fde9ab1a5041b 100644
--- a/app/Dockerfile
+++ b/app/Dockerfile
@@ -29,4 +29,4 @@ COPY __init__.py .
 COPY test_api.py .
 
 EXPOSE 8000
-CMD ["uvicorn", "test_api:app", "--host", "0.0.0.0", "--port", "8000"]
\ No newline at end of file
+CMD ["uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000"]
\ No newline at end of file
