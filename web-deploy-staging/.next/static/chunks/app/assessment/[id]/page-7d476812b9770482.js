(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{91976:function(e,s,t){Promise.resolve().then(t.bind(t,9234))},9234:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j}});var l=t(57437),a=t(2265),n=t(99376),i=t(29116),r=t(58813),c=t(47625),d=t(75940),o=t(39366),m=t(93019),h=t(8646),u=t(24230);function x(e){let{scores:s}=e,t=s.map(e=>({pillar:e.pillar_name,score:e.score||0,fullMark:5}));return(0,l.jsx)("div",{className:"w-full h-[400px]",children:(0,l.jsx)(c.h,{width:"100%",height:"100%",children:(0,l.jsxs)(d.H,{data:t,children:[(0,l.jsx)(o.n,{stroke:"#e5e7eb"}),(0,l.jsx)(m.I,{dataKey:"pillar",tick:{fontSize:12},className:"text-gray-600"}),(0,l.jsx)(h.S,{angle:90,domain:[0,5],tickCount:6,tick:{fontSize:10}}),(0,l.jsx)(u.F,{name:"Current Score",dataKey:"score",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.4,strokeWidth:2})]})})})}var p=t(65001);function j(){let e=(0,n.useParams)().id,[s,t]=(0,a.useState)(null),[c,d]=(0,a.useState)(null),[o,m]=(0,a.useState)(null),[h,u]=(0,a.useState)(!0),[j,f]=(0,a.useState)(null),[v,N]=(0,a.useState)(null),[b,y]=(0,a.useState)({}),[g,_]=(0,a.useState)(null),[w,S]=(0,a.useState)(!1),[k,E]=(0,a.useState)(!1),[C,A]=(0,a.useState)({});async function F(){try{var s,l;let a=await (0,r.AZ)(e);d(a);let n=await (0,i.tQ)(a.preset_id);t(n),m(null!==(l=null===(s=n.pillars[0])||void 0===s?void 0:s.id)&&void 0!==l?l:null)}catch(e){f(e instanceof Error?e.message:"Failed to load data")}finally{u(!1)}}async function P(s,t,l,a){let n="".concat(s,"-").concat(t);N(n),y({...b,[n]:!1});try{await (0,r.ee)(e,{pillar_id:s,question_id:t,level:l,notes:a}),y({...b,[n]:!0}),setTimeout(()=>{y(e=>({...e,[n]:!1}))},2e3);let i=await (0,r.AZ)(e);d(i)}catch(e){f(e instanceof Error?e.message:"Failed to save answer")}finally{N(null)}}async function O(){S(!0);try{let s=await (0,r.AE)(e);_(s),E(!0)}catch(e){f(e instanceof Error?e.message:"Failed to compute scores")}finally{S(!1)}}if((0,a.useEffect)(()=>{F()},[e]),h)return(0,l.jsx)("main",{className:"p-8",children:"Loading…"});if(j)return(0,l.jsx)("main",{className:"p-8",children:(0,l.jsxs)("div",{className:"p-4 bg-red-50 text-red-700 rounded",children:["Error: ",j]})});if(!s||!c)return(0,l.jsx)("main",{className:"p-8",children:"No data loaded"});let L=o?s.questions[o]:[],I=c.answers.reduce((e,s)=>(e["".concat(s.pillar_id,"-").concat(s.question_id)]=s,e),{});return(0,l.jsxs)("div",{className:"grid grid-cols-12 min-h-screen",children:[(0,l.jsxs)("aside",{className:"col-span-3 bg-gray-100 p-4 space-y-2",children:[(0,l.jsxs)("h2",{className:"font-semibold mb-2",children:["Assessment: ",c.name]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["ID: ",e.slice(0,8),"..."]}),(0,l.jsx)("h3",{className:"font-semibold",children:"Pillars"}),s.pillars.map(e=>(0,l.jsx)("button",{onClick:()=>m(e.id),className:"block w-full text-left px-3 py-2 rounded ".concat(o===e.id?"bg-white":"hover:bg-white"),children:e.name},e.id))]}),(0,l.jsxs)("main",{className:"col-span-9 p-6 space-y-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("h1",{className:"text-xl font-semibold",children:s.name}),(0,l.jsx)("button",{onClick:O,disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",children:w?"Computing...":"Compute Scores"})]}),k&&g&&(0,l.jsxs)("div",{className:"bg-white border rounded p-6 space-y-6",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold",children:"Assessment Scores"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-medium mb-2",children:"Pillar Scores"}),(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("th",{className:"text-left py-2",children:"Pillar"}),(0,l.jsx)("th",{className:"text-center py-2",children:"Score"}),(0,l.jsx)("th",{className:"text-center py-2",children:"Weight"}),(0,l.jsx)("th",{className:"text-center py-2",children:"Questions"})]})}),(0,l.jsx)("tbody",{children:g.pillar_scores.map(e=>{let t=s.pillars.find(s=>s.id===e.pillar_id);return(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"py-2",children:(null==t?void 0:t.name)||e.pillar_id}),(0,l.jsx)("td",{className:"text-center py-2",children:null!==e.score?e.score.toFixed(1):"N/A"}),(0,l.jsxs)("td",{className:"text-center py-2",children:[(100*e.weight).toFixed(0),"%"]}),(0,l.jsxs)("td",{className:"text-center py-2",children:[e.questions_answered," / ",e.total_questions]})]},e.pillar_id)})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-medium mb-2",children:"Radar Visualization"}),(0,l.jsx)(x,{scores:g.pillar_scores.map(e=>{let t=s.pillars.find(s=>s.id===e.pillar_id);return{pillar_id:e.pillar_id,pillar_name:(null==t?void 0:t.name)||e.pillar_id,score:e.score}})})]}),(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,l.jsx)("h3",{className:"font-medium",children:"Overall Score"}),(0,l.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[null!==g.overall_score?g.overall_score.toFixed(2):"N/A"," / 5.0"]}),g.gates_applied.length>0&&(0,l.jsx)("div",{className:"mt-2 text-sm text-orange-600",children:g.gates_applied.map((e,s)=>(0,l.jsxs)("div",{children:["⚠️ ",e]},s))})]})]}),null==L?void 0:L.map(e=>{var s;let t="".concat(o,"-").concat(e.id),a=I[t],n=v===t,i=b[t];return(0,l.jsxs)("div",{className:"bg-white border rounded p-4 space-y-3",children:[(0,l.jsx)("div",{className:"font-medium",children:e.text}),e.level_hints&&(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[e.level_hints["3"]&&(0,l.jsxs)("span",{children:["L3: ",e.level_hints["3"]]}),e.level_hints["3"]&&e.level_hints["4"]&&(0,l.jsx)("span",{className:"mx-2",children:"•"}),e.level_hints["4"]&&(0,l.jsxs)("span",{children:["L4: ",e.level_hints["4"]]})]}),(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("span",{className:"font-medium",children:"Evidence:"})," ",null===(s=e.evidence)||void 0===s?void 0:s.join(", ")]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm",children:"Level:"}),(0,l.jsxs)("select",{id:"level-".concat(t),className:"ml-2 border rounded px-2 py-1",defaultValue:(null==a?void 0:a.level)||"3",disabled:n,children:[(0,l.jsx)("option",{value:"1",children:"1"}),(0,l.jsx)("option",{value:"2",children:"2"}),(0,l.jsx)("option",{value:"3",children:"3"}),(0,l.jsx)("option",{value:"4",children:"4"}),(0,l.jsx)("option",{value:"5",children:"5"})]})]}),(0,l.jsx)("button",{onClick:()=>{let s=document.getElementById("level-".concat(t));P(o,e.id,parseInt(s.value))},disabled:n,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-400",children:n?"Saving...":"Save"}),i&&(0,l.jsx)("span",{className:"text-sm text-green-600",children:"✓ Saved"})]}),(0,l.jsxs)("div",{className:"border-t pt-3 space-y-2",children:[(0,l.jsx)("div",{className:"text-sm font-medium",children:"Upload Evidence"}),(0,l.jsx)(p.Z,{onUploadComplete:e=>{var s;return s=e.blob_path,void A(e=>({...e,[t]:[...e[t]||[],s]}))}}),C[t]&&C[t].length>0&&(0,l.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,l.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Linked Evidence:"}),C[t].map((e,s)=>(0,l.jsxs)("div",{className:"text-sm text-blue-600 truncate",children:["• ",e.split("/").pop()]},s))]})]})]},e.id)})]})]})}},58813:function(e,s,t){"use strict";t.d(s,{AE:function(){return i},AZ:function(){return r},Be:function(){return a},ee:function(){return n}});let l=t(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";async function a(e,s){let t=await fetch("".concat(l,"/assessments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,preset_id:s})});if(!t.ok)throw Error("Failed to create assessment");return t.json()}async function n(e,s){if(!(await fetch("".concat(l,"/assessments/").concat(e,"/answers"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw Error("Failed to save answer")}async function i(e){let s=await fetch("".concat(l,"/assessments/").concat(e,"/scores"));if(!s.ok)throw Error("Failed to get scores");return s.json()}async function r(e){let s=await fetch("".concat(l,"/assessments/").concat(e));if(!s.ok)throw Error("Failed to get assessment");return s.json()}}},function(e){e.O(0,[418,1,971,117,744],function(){return e(e.s=91976)}),_N_E=e.O()}]);