(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[22],{13774:function(e,s,a){Promise.resolve().then(a.bind(a,13427))},13427:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var t=a(57437),l=a(2265),d=a(11265),r=a(16023),i=a(22466),n=a(79267);function c(){var e;let[s,a]=(0,l.useState)("dashboard"),[c,o]=(0,l.useState)(null),[x,m]=(0,l.useState)(null),[g,h]=(0,l.useState)(!0),[u,b]=(0,l.useState)(""),[p,j]=(0,l.useState)(!1),[y,N]=(0,l.useState)(""),f=(0,d.QL)();(0,l.useEffect)(()=>{f.isAuthenticated&&(0,r.GJ)()&&v()},[f.isAuthenticated]);let v=async()=>{h(!0),b("");try{let[e,s]=await Promise.all([(0,i.kF)(),(0,i.Is)()]);o(e),m(s)}catch(e){b(e.message)}finally{h(!1)}},_=async(e,s)=>{if(x){m({...x,[e]:s}),j(!0),N("");try{let a=await (0,i.jQ)({[e]:s});m(a),N("Policy updated successfully"),setTimeout(()=>N(""),3e3)}catch(e){N("Error: ".concat(e.message))}finally{j(!1)}}},w=e=>{switch(e){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return f.isLoading?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"text-center",children:"Loading..."})}):(0,r.GJ)()?g?(0,t.jsx)("div",{className:"p-6 space-y-6",children:(0,t.jsx)("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-32 bg-gray-200 rounded-lg"},e))})}):(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"GDPR Administration"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Global GDPR compliance management and monitoring"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("a",{href:"/admin/ops",className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border",children:"Admin Operations"}),(0,t.jsx)("button",{onClick:v,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border",children:"Refresh"}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["User: ",null===(e=f.user)||void 0===e?void 0:e.name," • Mode: ","aad"===f.mode.mode?"Azure AD":"Demo"]})]})]}),u&&(0,t.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:u})}),(0,t.jsx)("div",{className:"border-b border-gray-200",children:(0,t.jsx)("nav",{className:"flex space-x-8",children:[{id:"dashboard",label:"Overview"},{id:"jobs",label:"Background Jobs"},{id:"ttl-policy",label:"TTL Policy"},{id:"audit-logs",label:"Global Audit Logs"}].map(e=>(0,t.jsx)("button",{onClick:()=>a(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(s===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"dashboard"===s&&c&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Total Engagements"}),(0,t.jsx)("div",{className:"text-2xl font-semibold",children:c.total_engagements})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"With Data"}),(0,t.jsx)("div",{className:"text-2xl font-semibold",children:c.engagements_with_data})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Pending Exports"}),(0,t.jsx)("div",{className:"text-2xl font-semibold",children:c.pending_export_requests})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Pending Purges"}),(0,t.jsx)("div",{className:"text-2xl font-semibold",children:c.pending_purge_requests})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Failed Jobs (24h)"}),(0,t.jsx)("div",{className:"text-2xl font-semibold text-red-600",children:c.failed_jobs_last_24h})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Total Data Size"}),(0,t.jsx)("div",{className:"text-lg font-semibold",children:(0,i.sS)(c.total_data_size_bytes)})]})]}),c.compliance_alerts.length>0&&(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Compliance Alerts"}),(0,t.jsx)("div",{className:"space-y-3",children:c.compliance_alerts.map(e=>(0,t.jsx)("div",{className:"p-3 border rounded ".concat(w(e.severity)),children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium",children:e.message}),(0,t.jsxs)("div",{className:"text-sm opacity-75 mt-1",children:["Engagement: ",e.engagement_id," • ",new Date(e.created_at).toLocaleString()]})]}),(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium bg-white bg-opacity-50",children:e.severity})]})},e.id))})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Data Retention Overview"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Oldest Data Date"}),(0,t.jsx)("div",{className:"font-medium",children:new Date(c.oldest_data_date).toLocaleDateString()})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Days Since Oldest"}),(0,t.jsxs)("div",{className:"font-medium",children:[Math.floor((Date.now()-new Date(c.oldest_data_date).getTime())/864e5)," days"]})]})]})]})]}),"jobs"===s&&c&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Recent Background Jobs"}),0===c.recent_jobs.length?(0,t.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No recent jobs found."}):(0,t.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Job ID"}),(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Type"}),(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Status"}),(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Engagement"}),(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Created"}),(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Progress"}),(0,t.jsx)("th",{className:"text-left py-3 px-4",children:"Current Step"})]})}),(0,t.jsx)("tbody",{children:c.recent_jobs.map(e=>(0,t.jsxs)("tr",{className:"border-t",children:[(0,t.jsxs)("td",{className:"py-3 px-4 font-mono text-xs",children:[e.job_id.substring(0,8),"..."]}),(0,t.jsx)("td",{className:"py-3 px-4 capitalize",children:e.job_type}),(0,t.jsx)("td",{className:"py-3 px-4",children:(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((0,i.E0)(e.status)),children:e.status})}),(0,t.jsxs)("td",{className:"py-3 px-4 font-mono text-xs",children:[e.engagement_id.substring(0,8),"..."]}),(0,t.jsx)("td",{className:"py-3 px-4",children:new Date(e.created_at).toLocaleDateString()}),(0,t.jsx)("td",{className:"py-3 px-4",children:void 0!==e.progress_percentage?"".concat(e.progress_percentage,"%"):"-"}),(0,t.jsx)("td",{className:"py-3 px-4 text-xs",children:e.current_step||"-"})]},e.job_id))})]})})]}),"ttl-policy"===s&&x&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Data Retention (TTL) Policy"}),y&&(0,t.jsx)("div",{className:"text-sm px-3 py-1 rounded ".concat(y.startsWith("Error")?"bg-red-100 text-red-600":"bg-green-100 text-green-600"),children:y})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium mb-4",children:"Retention Periods (Days)"}),(0,t.jsx)("div",{className:"space-y-4",children:[{key:"engagement_data_retention_days",label:"Engagement Data"},{key:"assessment_data_retention_days",label:"Assessment Data"},{key:"document_retention_days",label:"Document Data"},{key:"audit_log_retention_days",label:"Audit Logs"}].map(e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.label}),(0,t.jsx)("input",{type:"number",min:"1",max:"3650",value:x[e.key],onChange:s=>_(e.key,parseInt(s.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p})]},e.key))})]}),(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium mb-4",children:"Auto-Purge Settings"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:x.auto_purge_enabled,onChange:e=>_("auto_purge_enabled",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:p}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Enable Auto-Purge"})]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically purge data when retention period expires"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notification Before Purge (Days)"}),(0,t.jsx)("input",{type:"number",min:"0",max:"90",value:x.notification_before_purge_days,onChange:e=>_("notification_before_purge_days",parseInt(e.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p||!x.auto_purge_enabled}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Notify users this many days before auto-purge"})]})]})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-medium text-blue-800 mb-2",children:"Policy Information"}),(0,t.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,t.jsx)("li",{children:"• Retention periods are enforced globally across all engagements"}),(0,t.jsx)("li",{children:"• Changes take effect immediately for new data"}),(0,t.jsx)("li",{children:"• Existing data follows the retention period from its creation date"}),(0,t.jsx)("li",{children:"• Auto-purge runs daily and cannot be reversed"}),(0,t.jsx)("li",{children:"• Users will receive notifications before auto-purge if enabled"})]})]})]}),"audit-logs"===s&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-medium",children:"Global Audit Logs"}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Showing GDPR-related activities across all engagements"})]}),(0,t.jsx)(n.Z,{engagementId:"",isAdminView:!0,defaultPageSize:50,className:"max-w-7xl"})]})]}):(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"text-red-600",children:"Access denied. Admin privileges required."})})}}},function(e){e.O(0,[331,971,117,744],function(){return e(e.s=13774)}),_N_E=e.O()}]);