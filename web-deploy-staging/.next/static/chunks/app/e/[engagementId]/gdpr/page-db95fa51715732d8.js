(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[763],{26063:function(e,s,t){Promise.resolve().then(t.bind(t,70500))},70500:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return u}});var a=t(57437),r=t(2265),n=t(99376),l=t(11265),d=t(16023),i=t(22466);function c(e){let{engagementId:s,className:t="",onExportClick:n,onPurgeClick:l,onViewAuditLogs:d}=e,[c,o]=(0,r.useState)(null),[m,x]=(0,r.useState)([]),[u,g]=(0,r.useState)(!0),[h,p]=(0,r.useState)("");(0,r.useEffect)(()=>{j()},[s]);let j=async()=>{g(!0),p("");try{let[e,t]=await Promise.all([(0,i.Cs)(s),(0,i.M_)(s)]);o(e),x(t.slice(0,10))}catch(e){p(e.message)}finally{g(!1)}};if(u)return(0,a.jsx)("div",{className:"space-y-6 ".concat(t),children:(0,a.jsx)("div",{className:"animate-pulse space-y-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded-lg"},e))})});if(h)return(0,a.jsx)("div",{className:"space-y-6 ".concat(t),children:(0,a.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-red-600",children:h}),(0,a.jsx)("button",{onClick:j,className:"mt-2 text-sm text-red-600 underline hover:text-red-800",children:"Retry"})]})});if(!c)return null;let b=(()=>{if(!(null==c?void 0:c.data_retention_policy.next_purge_date))return null;let e=new Date(c.data_retention_policy.next_purge_date),s=new Date;return Math.ceil((e.getTime()-s.getTime())/864e5)})();return(0,a.jsxs)("div",{className:"space-y-6 ".concat(t),children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("button",{onClick:n,className:"p-4 text-left border rounded-lg hover:bg-blue-50 hover:border-blue-200 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Export Data"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Download your data"})]})]})}),(0,a.jsx)("button",{onClick:l,className:"p-4 text-left border rounded-lg hover:bg-red-50 hover:border-red-200 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Purge Data"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Permanently delete data"})]})]})}),(0,a.jsx)("button",{onClick:d,className:"p-4 text-left border rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-100 rounded",children:(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:"Audit Logs"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"View activity history"})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Data Summary"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Total Data Points"}),(0,a.jsx)("span",{className:"font-medium",children:c.data_summary.total_data_points.toLocaleString()})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Estimated Size"}),(0,a.jsx)("span",{className:"font-medium",children:(0,i.sS)(c.data_summary.estimated_size_bytes)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Oldest Data"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(c.data_summary.oldest_data_date).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Latest Data"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(c.data_summary.latest_data_date).toLocaleDateString()})]})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Data Retention"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Retention Period"}),(0,a.jsxs)("span",{className:"font-medium",children:[c.data_retention_policy.retention_days," days"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Auto Purge"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(c.data_retention_policy.auto_purge_enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:c.data_retention_policy.auto_purge_enabled?"Enabled":"Disabled"})]}),null!==b&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Next Auto Purge"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(b<7?"bg-red-100 text-red-800":b<30?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:b>0?"".concat(b," days"):"Overdue"})]})]})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Consent Status"}),(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Current Status:"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((e=>{switch(e){case"given":return"bg-green-100 text-green-800";case"withdrawn":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}})(c.consent_status.current_status)),children:c.consent_status.current_status.charAt(0).toUpperCase()+c.consent_status.current_status.slice(1)})]}),c.consent_status.given_at&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Given: ",new Date(c.consent_status.given_at).toLocaleString()]}),c.consent_status.withdrawn_at&&(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:["Withdrawn: ",new Date(c.consent_status.withdrawn_at).toLocaleString()]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Export Activity"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Total Exports"}),(0,a.jsx)("span",{className:"font-medium",children:c.export_history.total_exports})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pending Exports"}),(0,a.jsx)("span",{className:"font-medium",children:c.export_history.pending_exports})]}),c.export_history.last_export_date&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Last Export"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(c.export_history.last_export_date).toLocaleDateString()})]})]})]}),(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Purge Activity"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Total Purges"}),(0,a.jsx)("span",{className:"font-medium",children:c.purge_history.total_purges})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Pending Purges"}),(0,a.jsx)("span",{className:"font-medium",children:c.purge_history.pending_purges})]}),c.purge_history.last_purge_date&&(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Last Purge"}),(0,a.jsx)("span",{className:"font-medium",children:new Date(c.purge_history.last_purge_date).toLocaleDateString()})]})]})]})]}),m.length>0&&(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Recent GDPR Activities"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Type"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Created"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Completed"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Progress"})]})}),(0,a.jsx)("tbody",{children:m.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-2",children:(0,a.jsx)("span",{className:"capitalize",children:e.job_type})}),(0,a.jsx)("td",{className:"py-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((0,i.E0)(e.status)),children:e.status})}),(0,a.jsx)("td",{className:"py-2",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"py-2",children:e.completed_at?new Date(e.completed_at).toLocaleDateString():"-"}),(0,a.jsx)("td",{className:"py-2",children:void 0!==e.progress_percentage?"".concat(e.progress_percentage,"%"):"-"})]},e.job_id))})]})})]})]})}function o(e){let{engagementId:s,isOpen:t,onClose:n,onSuccess:l,onDownloadComplete:d,className:c=""}=e,[o,m]=(0,r.useState)({format:"json",includeAssessments:!0,includeDocuments:!0,includeFindings:!0,includeRecommendations:!0,includeRunlogs:!1,includeAuditLogs:!1}),[x,u]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[p,j]=(0,r.useState)(""),[b,f]=(0,r.useState)(null),[y,N]=(0,r.useState)(0);(0,r.useEffect)(()=>()=>{null==b||b.stop()},[b]),(0,r.useEffect)(()=>{t||(u(null),j(""),N(0),null==b||b.stop(),f(null))},[t,b]);let v=(e,s)=>{m(t=>({...t,[e]:s}))},w=async e=>{e.preventDefault(),h(!0),j("");try{let e={engagement_id:s,export_format:o.format,include_assessments:o.includeAssessments,include_documents:o.includeDocuments,include_findings:o.includeFindings,include_recommendations:o.includeRecommendations,include_runlogs:o.includeRunlogs,include_audit_logs:o.includeAuditLogs},t=await (0,i.hF)(e);u(t);let a=new i.zc(t.request_id,{onUpdate:e=>{e.result&&u(e.result)},onComplete:e=>{e.result&&u(e.result),null==l||l()},onError:e=>{j(e.message),f(null)}});a.start(),f(a)}catch(e){j(e.message)}finally{h(!1)}},_=async()=>{if((null==x?void 0:x.download_url)&&x.request_id)try{N(0);let e=await (0,i.Yj)(x.request_id),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="gdpr-export-".concat(s,"-").concat(Date.now(),".").concat(o.format),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a),N(100),null==d||d(x)}catch(e){j(e.message)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto ".concat(c),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Export GDPR Data"}),(0,a.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),x?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Export Status"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((0,i.E0)(x.status)),children:x.status.charAt(0).toUpperCase()+x.status.slice(1)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Request ID:"}),(0,a.jsx)("div",{className:"font-mono text-xs break-all",children:x.request_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Created:"}),(0,a.jsx)("div",{children:new Date(x.created_at).toLocaleString()})]}),x.completed_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Completed:"}),(0,a.jsx)("div",{children:new Date(x.completed_at).toLocaleString()})]}),x.file_size&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"File Size:"}),(0,a.jsx)("div",{children:(0,i.sS)(x.file_size)})]}),x.expires_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Expires:"}),(0,a.jsx)("div",{children:new Date(x.expires_at).toLocaleString()})]})]}),x.error_message&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:x.error_message})})]}),"completed"===x.status&&x.download_url&&(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-green-50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-green-800",children:"Export Ready"})]}),(0,a.jsxs)("p",{className:"text-sm text-green-700 mb-4",children:["Your data export is ready for download. The file will expire on"," ",x.expires_at?new Date(x.expires_at).toLocaleDateString():"a future date","."]}),(0,a.jsx)("button",{onClick:_,className:"w-full px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500",children:"Download Export File"}),y>0&&y<100&&(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(y,"%")}})}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Downloading... ",y,"%"]})]})]}),("pending"===x.status||"processing"===x.status)&&(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-blue-50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsxs)("svg",{className:"w-5 h-5 text-blue-600 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-800",children:"pending"===x.status?"Export Queued":"Processing Export"})]}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"pending"===x.status?"Your export request is queued and will begin processing shortly.":"Your data is being exported. This may take a few minutes depending on the amount of data."})]}),p&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:p})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Close"}),"completed"!==x.status&&(0,a.jsx)("button",{onClick:()=>{u(null),j(""),null==b||b.stop(),f(null)},className:"px-4 py-2 text-sm font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded-md hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"New Export"})]})]}):(0,a.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Export Format"}),(0,a.jsxs)("select",{value:o.format,onChange:e=>v("format",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"json",children:"JSON - Machine readable format"}),(0,a.jsx)("option",{value:"csv",children:"CSV - Spreadsheet format"}),(0,a.jsx)("option",{value:"pdf",children:"PDF - Human readable document"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Data to Include"}),(0,a.jsx)("div",{className:"space-y-3",children:[{key:"includeAssessments",label:"Assessment Data",description:"Assessment responses and scores"},{key:"includeDocuments",label:"Documents",description:"Uploaded files and attachments"},{key:"includeFindings",label:"Findings",description:"Security findings and analysis"},{key:"includeRecommendations",label:"Recommendations",description:"Generated recommendations"},{key:"includeRunlogs",label:"Run Logs",description:"System execution logs"},{key:"includeAuditLogs",label:"Audit Logs",description:"User activity and access logs"}].map(e=>(0,a.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:o[e.key],onChange:s=>v(e.key,s.target.checked),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.label}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]},e.key))})]}),p&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:p})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Requesting...":"Request Export"})]})]})]})})}):null}function m(e){let{engagementId:s,isOpen:t,onClose:n,onSuccess:l,onPurgeComplete:d,className:c=""}=e,[o,m]=(0,r.useState)("select"),[x,u]=(0,r.useState)({purgeAssessments:!1,purgeDocuments:!1,purgeFindings:!1,purgeRecommendations:!1,purgeRunlogs:!1,purgeAuditLogs:!1,confirmationText:""}),[g]=(0,r.useState)(()=>(0,i.sk)()),[h,p]=(0,r.useState)(null),[j,b]=(0,r.useState)(!1),[f,y]=(0,r.useState)(""),[N,v]=(0,r.useState)(null);(0,r.useEffect)(()=>()=>{null==N||N.stop()},[N]),(0,r.useEffect)(()=>{t||(m("select"),u({purgeAssessments:!1,purgeDocuments:!1,purgeFindings:!1,purgeRecommendations:!1,purgeRunlogs:!1,purgeAuditLogs:!1,confirmationText:""}),p(null),y(""),null==N||N.stop(),v(null))},[t,N]);let w=(e,s)=>{u(t=>({...t,[e]:s}))},_=()=>{let e=[];return x.purgeAssessments&&e.push("Assessments"),x.purgeDocuments&&e.push("Documents"),x.purgeFindings&&e.push("Findings"),x.purgeRecommendations&&e.push("Recommendations"),x.purgeRunlogs&&e.push("Run Logs"),x.purgeAuditLogs&&e.push("Audit Logs"),e},k=()=>_().length>0,D=()=>(0,i.XB)(x.confirmationText,g),C=async()=>{if(!D()){y("Confirmation text does not match. Please type the exact confirmation code.");return}b(!0),y("");try{let e={engagement_id:s,purge_assessments:x.purgeAssessments,purge_documents:x.purgeDocuments,purge_findings:x.purgeFindings,purge_recommendations:x.purgeRecommendations,purge_runlogs:x.purgeRunlogs,purge_audit_logs:x.purgeAuditLogs,confirmation_token:g},t=await (0,i.AV)(e);p(t),m("status");let a=new i.zc(t.request_id,{onUpdate:e=>{e.result&&p(e.result)},onComplete:e=>{e.result&&(p(e.result),null==d||d(e.result)),null==l||l()},onError:e=>{y(e.message),v(null)}});a.start(),v(a)}catch(e){y(e.message)}finally{b(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto ".concat(c),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-red-600",children:"Purge GDPR Data"}),(0,a.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("svg",{className:"w-6 h-6 text-red-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 13.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Warning: Irreversible Action"}),(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:"Data purging permanently deletes selected data and cannot be undone. Please ensure you have exported any data you need before proceeding."})]})]})}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("div",{className:"flex items-center space-x-4",children:["Select Data","Confirm Purge","Purge Status"].map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(s<("select"===o?1:"confirm"===o?2:3)?"bg-red-600 text-white":s===("select"===o?0:"confirm"===o?1:2)?"bg-red-100 text-red-600 border-2 border-red-600":"bg-gray-100 text-gray-400"),children:s+1}),(0,a.jsx)("span",{className:"ml-2 text-sm ".concat(s<=("select"===o?0:"confirm"===o?1:2)?"text-gray-900":"text-gray-400"),children:e}),s<2&&(0,a.jsx)("div",{className:"ml-4 w-8 h-px ".concat(s<("select"===o?0:"confirm"===o?1:2)?"bg-red-600":"bg-gray-200")})]},e))})}),"select"===o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Data Types to Purge"}),(0,a.jsx)("div",{className:"space-y-3",children:[{key:"purgeAssessments",label:"Assessment Data",description:"Assessment responses and scores",risk:"high"},{key:"purgeDocuments",label:"Documents",description:"Uploaded files and attachments",risk:"high"},{key:"purgeFindings",label:"Findings",description:"Security findings and analysis",risk:"medium"},{key:"purgeRecommendations",label:"Recommendations",description:"Generated recommendations",risk:"medium"},{key:"purgeRunlogs",label:"Run Logs",description:"System execution logs",risk:"low"},{key:"purgeAuditLogs",label:"Audit Logs",description:"User activity and access logs",risk:"low"}].map(e=>(0,a.jsxs)("label",{className:"flex items-start space-x-3 cursor-pointer p-3 border rounded-lg hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"checkbox",checked:x[e.key],onChange:s=>w(e.key,s.target.checked),className:"mt-1 h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.label}),(0,a.jsxs)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("high"===e.risk?"bg-red-100 text-red-800":"medium"===e.risk?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[e.risk," risk"]})]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.description})]})]},e.key))})]}),f&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:f})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{"select"===o&&k()&&m("confirm")},disabled:!k(),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:"Continue to Confirmation"})]})]}),"confirm"===o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-red-50",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-red-800 mb-3",children:"Confirm Data Purge"}),(0,a.jsx)("p",{className:"text-sm text-red-700 mb-4",children:"You are about to permanently delete the following data types:"}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1",children:_().map(e=>(0,a.jsx)("li",{className:"text-sm text-red-700",children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type the following confirmation code to proceed:"}),(0,a.jsx)("div",{className:"mb-3 p-3 bg-gray-100 border rounded-md",children:(0,a.jsx)("code",{className:"text-sm font-mono",children:g})}),(0,a.jsx)("input",{type:"text",value:x.confirmationText,onChange:e=>w("confirmationText",e.target.value),placeholder:"Enter confirmation code",className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500"}),x.confirmationText&&!D()&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"Confirmation code does not match"})]}),f&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:f})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{onClick:()=>{"confirm"===o&&m("select")},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Back"}),(0,a.jsx)("button",{onClick:C,disabled:!D()||j,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Purging Data...":"Purge Data"})]})]}),"status"===o&&h&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Purge Status"}),(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat((0,i.E0)(h.status)),children:h.status.charAt(0).toUpperCase()+h.status.slice(1)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Request ID:"}),(0,a.jsx)("div",{className:"font-mono text-xs break-all",children:h.request_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Started:"}),(0,a.jsx)("div",{children:new Date(h.created_at).toLocaleString()})]}),h.completed_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Completed:"}),(0,a.jsx)("div",{children:new Date(h.completed_at).toLocaleString()})]})]}),h.error_message&&(0,a.jsx)("div",{className:"mt-3 p-2 bg-red-50 border border-red-200 rounded",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:h.error_message})})]}),"completed"===h.status&&h.items_purged&&(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-green-50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-green-800",children:"Purge Completed"})]}),(0,a.jsx)("p",{className:"text-sm text-green-700 mb-4",children:"The following data has been permanently deleted:"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:Object.entries(h.items_purged).map(e=>{let[s,t]=e;return t>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-gray-600 capitalize",children:[s.replace("_"," "),":"]}),(0,a.jsxs)("span",{className:"ml-2 font-medium",children:[t," items"]})]},s)})})]}),("pending"===h.status||"processing"===h.status)&&(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-blue-50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsxs)("svg",{className:"w-5 h-5 text-blue-600 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("h3",{className:"text-lg font-medium text-blue-800",children:"pending"===h.status?"Purge Queued":"Purging Data"})]}),(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"pending"===h.status?"Your purge request is queued and will begin processing shortly.":"Data is being permanently deleted. This process cannot be stopped once started."})]}),f&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:f})}),(0,a.jsx)("div",{className:"flex justify-end space-x-3 pt-4",children:(0,a.jsx)("button",{onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Close"})})]})]})})}):null}var x=t(79267);function u(){var e;let{engagementId:s}=(0,n.useParams)(),[t,i]=(0,r.useState)("overview"),[u,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),j=(0,l.QL)();return j.isLoading?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading..."})}):s?(0,d.GJ)()?(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"GDPR Data Management"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Manage data exports, purging, and compliance for engagement ",s]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["User: ",null===(e=j.user)||void 0===e?void 0:e.name," • Mode: ","aad"===j.mode.mode?"Azure AD":"Demo"]})})]}),(0,a.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("svg",{className:"w-6 h-6 text-blue-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-blue-800",children:"GDPR Compliance"}),(0,a.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:"This interface allows you to export or permanently delete personal data in compliance with GDPR Article 15 (Right of Access) and Article 17 (Right to Erasure). All actions are logged for audit purposes."})]})]})}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"flex space-x-8",children:[{id:"overview",label:"GDPR Overview"},{id:"audit-logs",label:"Audit Logs"}].map(e=>(0,a.jsx)("button",{onClick:()=>i(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(t===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"overview"===t&&(0,a.jsx)(c,{engagementId:s,onExportClick:()=>g(!0),onPurgeClick:()=>p(!0),onViewAuditLogs:()=>i("audit-logs"),className:"max-w-6xl"}),"audit-logs"===t&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-medium",children:"Audit Logs"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Showing GDPR-related activities for this engagement"})]}),(0,a.jsx)(x.Z,{engagementId:s,className:"max-w-6xl"})]}),(0,a.jsx)(o,{engagementId:s,isOpen:u,onClose:()=>g(!1),onSuccess:()=>{console.log("Export request successful")},onDownloadComplete:e=>{console.log("Download completed:",e)}}),(0,a.jsx)(m,{engagementId:s,isOpen:h,onClose:()=>p(!1),onSuccess:()=>{console.log("Purge request successful")},onPurgeComplete:e=>{console.log("Purge completed:",e)}})]}):(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-red-600",children:"Access denied. GDPR data management requires Lead or Admin privileges."})}):(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-red-600",children:"No engagement selected."})})}}},function(e){e.O(0,[331,971,117,744],function(){return e(e.s=26063)}),_N_E=e.O()}]);