(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{38646:function(e,t,a){Promise.resolve().then(a.bind(a,7510))},7510:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var n=a(57437),s=a(2265),r=a(99376),i=a(29116);let o=new Map;async function c(){let e="csf:functions",t=function(e){let t=o.get(e);return t?Date.now()-t.timestamp>3e5?(o.delete(e),null):t.data:null}(e);if(t)return t;try{let t=(await (0,i.SC)("/api/v1/csf/functions",{timeout:1e4})).functions;return o.set(e,{data:t,timestamp:Date.now()}),t}catch(e){throw console.error("Error loading CSF functions:",e),Error(e instanceof Error?e.message:"Failed to load CSF taxonomy")}}var l=a(11265),d=a(60413),u=a(4062);let m=e=>{let{index:t,style:a,data:s}=e,r=s[t];return(0,n.jsx)("div",{style:a,className:"px-4 py-2 border-b border-gray-100 hover:bg-blue-50 cursor-pointer",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("span",{className:"text-sm mt-1",children:"\uD83D\uDCC4"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:r.filename}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Uploaded ",new Date(r.uploaded_at).toLocaleDateString()]}),r.linked_items.length>0&&(0,n.jsx)("div",{className:"flex gap-1 mt-1",children:r.linked_items.map((e,t)=>(0,n.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 rounded",children:e.item_type},t))})]})]})})};function h(e){let{subcategory:t,isOpen:a,onClose:i,onScoreChange:o,onRationaleChange:c,onEvidenceSelect:l,correlationId:h}=e,{engagementId:g}=(0,r.useParams)(),[f,x]=(0,s.useState)(0),[p,b]=(0,s.useState)(""),[y,j]=(0,s.useState)([]),[v,N]=(0,s.useState)(!1),[w,S]=(0,s.useState)(null),[E,C]=(0,s.useState)("assessment"),k=(0,s.useRef)(null),D=(0,s.useRef)(null),A=(0,s.useRef)(null),T=(0,s.useRef)(null),P=(0,s.useCallback)(async()=>{if(g&&a){N(!0),S(null);try{console.log("[".concat(h,"] Loading evidence for engagement: ").concat(g));let e=await (0,u.q8)(g,1,100);j(e.data),console.log("[".concat(h,"] Loaded ").concat(e.data.length," evidence items"))}catch(t){let e=t instanceof Error?t.message:"Failed to load evidence";console.error("[".concat(h,"] Evidence loading error:"),t),S(e)}finally{N(!1)}}},[g,a,h]);(0,s.useEffect)(()=>{P()},[P]),(0,s.useEffect)(()=>{t&&(console.log("[".concat(h,"] Opening drawer for subcategory: ").concat(t.id)),x(0),b(""),C("assessment"))},[t,h]),(0,s.useEffect)(()=>{a&&D.current&&D.current.focus()},[a]),(0,s.useEffect)(()=>{let e=e=>{if(a)switch(e.key){case"Escape":e.preventDefault(),i();break;case"Tab":e.shiftKey;break;case"1":case"2":case"3":case"4":case"5":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),_(parseInt(e.key)));break;case"ArrowUp":case"ArrowDown":"evidence"===E&&y.length>0&&e.preventDefault()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[a,E,y.length,i]);let _=e=>{console.log("[".concat(h,"] Score changed to: ").concat(e," for subcategory: ").concat(null==t?void 0:t.id)),x(e),null==o||o(e)},L=e=>{b(e),null==c||c(e)},R=(0,s.useMemo)(()=>y,[y]);return a&&t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-end",role:"dialog","aria-modal":"true","aria-labelledby":"drawer-title",onClick:e=>{e.target===e.currentTarget&&i()},children:(0,n.jsxs)("div",{ref:k,className:"w-full max-w-2xl h-full bg-white shadow-xl flex flex-col",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("div",{className:"border-b border-gray-200 p-6",children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h2",{id:"drawer-title",className:"text-xl font-semibold text-gray-900",children:t.id}),(0,n.jsx)("h3",{className:"text-lg text-gray-700 mt-1",children:t.title}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:t.description})]}),(0,n.jsx)("button",{onClick:i,className:"ml-4 p-2 hover:bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close drawer",children:(0,n.jsx)("span",{className:"text-xl",children:"\xd7"})})]})}),(0,n.jsx)("div",{className:"border-b border-gray-200",children:(0,n.jsxs)("nav",{className:"flex",role:"tablist",children:[(0,n.jsx)("button",{role:"tab","aria-selected":"assessment"===E,"aria-controls":"assessment-panel",className:"px-6 py-3 text-sm font-medium border-b-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat("assessment"===E?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),onClick:()=>C("assessment"),children:"Assessment"}),(0,n.jsxs)("button",{role:"tab","aria-selected":"evidence"===E,"aria-controls":"evidence-panel",className:"px-6 py-3 text-sm font-medium border-b-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat("evidence"===E?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"),onClick:()=>C("evidence"),children:["Evidence (",R.length,")"]})]})}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["assessment"===E&&(0,n.jsxs)("div",{id:"assessment-panel",role:"tabpanel",className:"p-6 space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"score-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"Implementation Score (1-5)"}),(0,n.jsx)("div",{className:"flex gap-2 mb-3",children:[1,2,3,4,5].map(e=>(0,n.jsx)("button",{onClick:()=>_(e),className:"px-4 py-2 text-sm rounded border focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(f===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"),"aria-pressed":f===e,children:e},e))}),(0,n.jsx)("input",{ref:D,id:"score-input",type:"range",min:"0",max:"5",step:"1",value:f,onChange:e=>_(parseInt(e.target.value)),className:"w-full","aria-describedby":"score-help"}),(0,n.jsx)("div",{id:"score-help",className:"text-xs text-gray-500 mt-1",children:"Use Ctrl/Cmd + 1-5 for quick scoring"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"rationale-textarea",className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Rationale"}),(0,n.jsx)("textarea",{ref:A,id:"rationale-textarea",value:p,onChange:e=>L(e.target.value),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Explain the reasoning behind your assessment score...","aria-describedby":"rationale-help"}),(0,n.jsx)("div",{id:"rationale-help",className:"text-xs text-gray-500 mt-1",children:"Provide detailed justification for the score assigned"})]})]}),"evidence"===E&&(0,n.jsx)("div",{id:"evidence-panel",role:"tabpanel",children:v?(0,n.jsx)("div",{className:"flex items-center justify-center py-8",role:"status","aria-live":"polite",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),(0,n.jsx)("span",{className:"text-gray-600",children:"Loading evidence..."})]})}):w?(0,n.jsx)("div",{className:"p-4",role:"alert","aria-live":"assertive",children:(0,n.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,n.jsx)("span",{role:"img","aria-label":"Error",children:"⚠️"}),(0,n.jsx)("span",{className:"font-medium",children:"Failed to load evidence"})]}),(0,n.jsx)("p",{className:"text-red-600 text-sm mt-1",children:w}),(0,n.jsx)("button",{onClick:P,className:"mt-2 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Retry"})]})}):0===R.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",role:"status",children:[(0,n.jsx)("div",{className:"text-4xl mb-4",role:"img","aria-label":"Empty folder",children:"\uD83D\uDCC2"}),(0,n.jsx)("div",{className:"text-gray-600 mb-2",children:"No evidence files found"}),(0,n.jsx)("div",{className:"text-sm text-gray-500",children:"Upload files to link them to this subcategory"})]}):(0,n.jsx)("div",{className:"h-96",ref:T,role:"listbox","aria-label":"Evidence files",children:(0,n.jsx)(d.t7,{height:384,width:"100%",itemCount:R.length,itemSize:80,itemData:R,children:m})})})]})]})}):null}function g(e){let{functions:t,onSubcategorySelect:a,selectedSubcategory:r}=e,[i,o]=(0,s.useState)(new Set),c=e=>{o(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})};return(0,n.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg",children:[(0,n.jsxs)("button",{onClick:()=>c(e.id),className:"w-full px-4 py-3 text-left bg-gray-50 hover:bg-gray-100 rounded-t-lg font-medium flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-semibold",children:e.id})," - ",e.title]}),(0,n.jsx)("span",{className:"text-gray-500",children:i.has(e.id)?"−":"+"})]}),i.has(e.id)&&(0,n.jsxs)("div",{className:"p-4 space-y-3",children:[(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),(0,n.jsx)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:e.categories.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,n.jsxs)("div",{className:"font-medium text-sm mb-2",children:[e.id," - ",e.title]}),(0,n.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.description}),(0,n.jsx)("div",{className:"space-y-1",children:e.subcategories.map(e=>(0,n.jsxs)("button",{onClick:()=>a(e),className:"w-full text-left px-2 py-1 rounded text-xs hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null==r?void 0:r.id)===e.id?"bg-blue-100 text-blue-700 font-medium":"text-gray-700"),"aria-label":"Select subcategory ".concat(e.id,": ").concat(e.title),children:[e.id," - ",e.title]},e.id))})]},e.id))})]})]},e.id))})}function f(e){let{subcategory:t}=e;return(0,n.jsxs)("div",{className:"bg-white border rounded-lg p-6 space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg",children:t.id}),(0,n.jsx)("h4",{className:"text-gray-600 mb-2",children:t.title}),(0,n.jsx)("p",{className:"text-sm text-gray-700",children:t.description})]}),(0,n.jsxs)("div",{className:"border-t pt-4",children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Assessment Score"}),(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[(0,n.jsx)("div",{children:"Score: Not Assessed"}),(0,n.jsx)("div",{className:"text-xs mt-1",children:"Scoring functionality coming soon"})]})]}),(0,n.jsxs)("div",{className:"border-t pt-4",children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Rationale"}),(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[(0,n.jsx)("div",{children:"No rationale provided"}),(0,n.jsx)("div",{className:"text-xs mt-1",children:"Rationale input coming soon"})]})]}),(0,n.jsxs)("div",{className:"border-t pt-4",children:[(0,n.jsx)("h4",{className:"font-medium mb-2",children:"Evidence"}),(0,n.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[(0,n.jsx)("div",{children:"No evidence uploaded"}),(0,n.jsx)("div",{className:"text-xs mt-1",children:"Evidence tray coming soon"})]})]})]})}function x(){let{engagementId:e}=(0,r.useParams)(),[t,a]=(0,s.useState)([]),[i,o]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),[m,x]=(0,s.useState)(null),[p,b]=(0,s.useState)(!1),[y]=(0,s.useState)(()=>"csf-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),j=(0,l.QL)();(0,s.useEffect)(()=>{v()},[]);let v=async()=>{try{o(!0),console.log("[".concat(y,"] Loading CSF data for engagement: ").concat(e));let t=await c();a(t),console.log("[".concat(y,"] Loaded ").concat(t.length," CSF functions")),t.length}catch(e){console.error("[".concat(y,"] Error loading CSF data:"),e),u(e instanceof Error?e.message:"Failed to load CSF data")}finally{o(!1)}},N=(0,s.useMemo)(()=>t.length?{functions:t.length,categories:t.reduce((e,t)=>e+t.categories.length,0),subcategories:t.reduce((e,t)=>e+t.categories.reduce((e,t)=>e+t.subcategories.length,0),0)}:{functions:0,categories:0,subcategories:0},[t]);return j.isLoading?(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)("div",{className:"text-center",children:"Loading..."})}):i?(0,n.jsx)("div",{className:"p-6",children:(0,n.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,n.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,n.jsx)("div",{className:"h-32 bg-gray-200 rounded"}),(0,n.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})}):d?(0,n.jsx)("div",{className:"p-6",children:(0,n.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,n.jsx)("h3",{className:"font-medium text-red-800",children:"Error Loading Assessment"}),(0,n.jsx)("p",{className:"text-red-600 text-sm mt-1",children:d}),(0,n.jsx)("button",{onClick:v,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Retry"})]})}):(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"CSF 2.0 Assessment Grid"}),(0,n.jsxs)("p",{className:"text-gray-600 text-sm mt-1",children:["Engagement: ",e]}),(0,n.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500 mt-2",children:[(0,n.jsxs)("span",{children:[N.functions," Functions"]}),(0,n.jsxs)("span",{children:[N.categories," Categories"]}),(0,n.jsxs)("span",{children:[N.subcategories," Subcategories"]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,n.jsx)("div",{className:"lg:col-span-2",children:(0,n.jsx)(g,{functions:t,onSubcategorySelect:e=>{console.log("[".concat(y,"] Subcategory selected: ").concat(e.id)),x(e),b(!0)},selectedSubcategory:m})}),(0,n.jsx)("div",{className:"lg:col-span-1",children:m?(0,n.jsx)(f,{subcategory:m}):(0,n.jsxs)("div",{className:"bg-white border rounded-lg p-6 text-center text-gray-500",children:[(0,n.jsx)("h3",{className:"font-medium mb-2",children:"Select a Subcategory"}),(0,n.jsx)("p",{className:"text-sm",children:"Click on any subcategory from the grid to view details and assessment options."})]})})]}),(0,n.jsx)(h,{subcategory:m,isOpen:p,onClose:()=>{console.log("[".concat(y,"] Drawer closed")),b(!1)},onScoreChange:e=>{console.log("[".concat(y,"] Score changed: ").concat(e," for ").concat(null==m?void 0:m.id))},onRationaleChange:e=>{console.log("[".concat(y,"] Rationale changed for ").concat(null==m?void 0:m.id))},onEvidenceSelect:e=>{console.log("[".concat(y,"] Evidence selected: ").concat(e.filename))},correlationId:y})]})})}},11265:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return o},QL:function(){return l},aC:function(){return c}});var n=a(57437),s=a(2265),r=a(99376);let i=(0,s.createContext)(null);function o(e){let{children:t}=e,[a,o]=(0,s.useState)(null),[c,l]=(0,s.useState)({mode:"demo",enabled:!0}),[d,u]=(0,s.useState)(!0),[m,h]=(0,s.useState)();async function g(){try{u(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),h(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{u(!1)}}return(0,r.useRouter)(),(0,s.useEffect)(()=>{g()},[]),(0,n.jsx)(i.Provider,{value:{user:a,mode:c,isAuthenticated:!!a,isLoading:d,error:m},children:t})}function c(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,r.useRouter)();return(0,s.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},29116:function(e,t,a){"use strict";a.d(t,{$V:function(){return l},SC:function(){return i},Sg:function(){return c},tQ:function(){return o}});var n=a(16023);let s=a(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){let e=(0,n.OD)(),t=(0,n.K3)(),a={};return e&&(a["X-User-Email"]=e),t&&(a["X-Engagement-ID"]=t),a}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r(),n=new AbortController,i=setTimeout(()=>n.abort(),t.timeout||3e4);try{let r=await fetch("".concat(s).concat(e),{...t,signal:n.signal,headers:{...a,...t.headers}});if(clearTimeout(i),!r.ok){let e=await r.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(r.status))}return r.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,a=setTimeout(()=>t.abort(),3e4);try{let n=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(a),!n.ok)throw Error("Preset ".concat(e," not found"));return n.json()}catch(t){if(clearTimeout(a),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=s;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,a){"use strict";a.d(t,{GJ:function(){return c},K3:function(){return r},OD:function(){return s},Pk:function(){return o},d8:function(){return i}});var n=a(40257);function s(){return localStorage.getItem("email")||""}function r(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function o(e){return s()||(await e.push("/signin"),"")}function c(){let e=s();return(n.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},4062:function(e,t,a){"use strict";a.d(t,{$r:function(){return l},EK:function(){return c},Hi:function(){return m},Hj:function(){return i},LB:function(){return x},LP:function(){return y},LT:function(){return d},W2:function(){return p},Zg:function(){return s},fG:function(){return f},fj:function(){return u},kR:function(){return o},q8:function(){return h},sS:function(){return b},tc:function(){return g},te:function(){return r}});var n=a(29116);async function s(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function r(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function i(e,t){let a=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(a.status));return a.json()}async function o(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function c(e){let[t,a]=await Promise.all([(0,n.SC)("/engagements/".concat(e,"/docs")),r(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:a.find(t=>t.document_id===e.id)}))}async function l(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:a})});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function d(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function u(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||"SAS generation failed: ".concat(t.status));return t.json()}async function m(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||"Upload completion failed: ".concat(t.status));return t.json()}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,n=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:a.toString()}),s=await fetch("/api/proxy/evidence?".concat(n));if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Failed to list evidence"}))).detail||"Failed to list evidence: ".concat(s.status));let r=await s.json(),i=parseInt(s.headers.get("X-Total-Count")||"0"),o=parseInt(s.headers.get("X-Page")||"1"),c=parseInt(s.headers.get("X-Page-Size")||"50");return{data:r,total:i,page:o,page_size:c,total_pages:parseInt(s.headers.get("X-Total-Pages")||"1"),has_next:"true"===s.headers.get("X-Has-Next"),has_previous:"true"===s.headers.get("X-Has-Previous")}}async function g(e,t){let a=await fetch("/api/proxy/evidence/".concat(e,"/links"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Evidence linking failed"}))).detail||"Evidence linking failed: ".concat(a.status));return a.json()}async function f(e,t){let a=await fetch("/api/proxy/evidence/".concat(e,"/links/").concat(t),{method:"DELETE"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||"Evidence unlinking failed: ".concat(a.status));return a.json()}async function x(e,t){let a=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!a.ok)throw Error("Azure upload failed: ".concat(a.statusText))}async function p(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function b(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function y(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}}},function(e){e.O(0,[890,971,117,744],function(){return e(e.s=38646)}),_N_E=e.O()}]);