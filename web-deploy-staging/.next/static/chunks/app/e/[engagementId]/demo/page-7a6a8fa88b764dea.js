(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[205,121],{68515:function(e,t,n){Promise.resolve().then(n.bind(n,27379))},27379:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var a=n(57437),s=n(2265),r=n(99376),o=n(68601),i=n(16023),c=n(27121),l=n(34838),u=n(29116),d=n(40257);function m(){var e;let t=(0,r.useParams)(),n=(0,r.useRouter)(),m=t.engagementId,[f,h]=(0,s.useState)(""),[g,x]=(0,s.useState)("Sample workshop notes:\n- Admins without MFA\n- No M365 DLP\n- No incident runbooks"),[y,p]=(0,s.useState)([]),[b,v]=(0,s.useState)([]),[w,j]=(0,s.useState)(!1),[N,E]=(0,s.useState)(""),[k,S]=(0,s.useState)([]),[T,C]=(0,s.useState)("");async function P(){if(m)try{S(await (0,l.CZ)(m))}catch(e){C(e.message)}}async function A(){j(!0),E("");try{let e=await (0,o.Be)("Demo Assessment");h(e.id),E("Created assessment ".concat(e.id))}catch(e){E(e.message)}finally{j(!1)}}async function D(){if(!f)return E("Create assessment first");j(!0),E("");try{var e;let t=await (0,o.$O)(f,g);p(t.findings||[]),E("Analyze ok: ".concat((null===(e=t.findings)||void 0===e?void 0:e.length)||0," findings"))}catch(e){E(e.message)}finally{j(!1)}}async function _(){if(!f)return E("Create assessment first");j(!0),E("");try{var e;let t=await (0,o.GV)(f);v(t.recommendations||[]),E("Recommend ok: ".concat((null===(e=t.recommendations)||void 0===e?void 0:e.length)||0," items"))}catch(e){E(e.message)}finally{j(!1)}}async function O(e){let t=Array.from(e.target.files||[]);if(t.length&&m){j(!0);try{await (0,l.$6)(m,t),await P(),C("Uploaded ".concat(t.length," file(s)"))}catch(e){C(e.message)}finally{j(!1),e.currentTarget.value=""}}}async function L(e){j(!0);try{let t=await (0,l.Xj)(m,e);C((null==t?void 0:t.note)?"Analyzed (note: ".concat(t.note,")"):"Analyzed")}catch(e){C(e.message)}finally{j(!1)}}async function R(e){if(confirm("Delete document?")){j(!0);try{await (0,l.oe)(m,e),await P()}catch(e){C(e.message)}finally{j(!1)}}}return(0,s.useEffect)(()=>{(async()=>{await (0,i.Pk)(n)&&m&&((0,i.d8)(m),P())})()},[m,n]),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:"AI Maturity Assessment"}),(0,a.jsx)(c.default,{})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Demo Orchestration"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-black text-white disabled:opacity-50",onClick:A,disabled:w,children:"Create Assessment"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-black text-white disabled:opacity-50",onClick:D,disabled:w,children:"Run Analyze"}),(0,a.jsx)("button",{className:"px-3 py-2 rounded bg-black text-white disabled:opacity-50",onClick:_,disabled:w,children:"Run Recommend"})]}),N&&(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-4",children:N}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Workshop / Doc Content"}),(0,a.jsx)("textarea",{value:g,onChange:e=>x(e.target.value),className:"w-full border rounded p-2 h-40"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-medium mb-3",children:"Findings"}),(0,a.jsx)("ul",{className:"list-disc pl-6 space-y-2",children:y.map((e,t)=>{var n;return(0,a.jsxs)("li",{children:[(0,a.jsxs)("strong",{children:["[",e.severity||"medium","] ",e.area||"General",":"]})," ",e.title||"Untitled finding"]},null!==(n=e.id)&&void 0!==n?n:"finding-".concat(t))})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-medium mb-3",children:"Recommendations"}),(0,a.jsx)("ol",{className:"list-decimal pl-6 space-y-2",children:b.map((e,t)=>{var n,s;return(0,a.jsxs)("li",{children:[e.title||"Untitled recommendation",(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-2",children:["(",e.priority||"P2",", ",e.effort||"M",", ",null!==(n=e.timeline_weeks)&&void 0!==n?n:"?","w)"]})]},null!==(s=e.id)&&void 0!==s?s:"result-".concat(t))})})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 rounded-xl border p-4 space-y-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Documents"}),(0,a.jsx)("input",{type:"file",multiple:!0,onChange:O,disabled:w}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Max ",null!==(e=d.env.NEXT_PUBLIC_MAX_UPLOAD_MB)&&void 0!==e?e:"10"," MB each. PDF, DOCX, TXT recommended."]}),(0,a.jsxs)("ul",{className:"divide-y",children:[k.map(e=>(0,a.jsxs)("li",{className:"py-2 flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.filename}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[(e.size/1024).toFixed(1)," KB \xb7 ",new Date(e.uploaded_at).toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 shrink-0",children:[(0,a.jsx)("button",{className:"underline",onClick:async()=>{let t=(0,l.GR)(m,e.id),n=await fetch(t,{headers:(0,u.$V)()});if(n.ok){let t=await n.blob(),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=e.filename,a.click()}},disabled:w,children:"Download"}),(0,a.jsx)("button",{className:"px-2 py-1 border rounded",onClick:()=>L(e.id),disabled:w,children:"Analyze"}),(0,a.jsx)("button",{className:"px-2 py-1 border rounded",onClick:()=>R(e.id),disabled:w,children:"Delete"})]})]},e.id)),!k.length&&(0,a.jsx)("li",{className:"text-sm text-gray-500",children:"No documents yet."})]}),T&&(0,a.jsx)("div",{className:"text-sm text-blue-700",children:T})]})]})]})}},27121:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var a=n(57437),s=n(2265),r=n(99376),o=n(16023),i=n(68601);function c(){let[e,t]=(0,s.useState)([]),[n,c]=(0,s.useState)(""),[l,u]=(0,s.useState)(!1),[d,m]=(0,s.useState)(!1),[f,h]=(0,s.useState)(null),g=(0,r.useRouter)(),x=(0,r.usePathname)();(0,s.useEffect)(()=>{let e=(0,o.OD)(),t=(0,o.K3)();e&&(y(),c(t))},[]);let y=async()=>{m(!0),h(null);try{let e=(0,o.OD)();if(!e){h("No email found");return}let n=await fetch("".concat(i.Sg,"/engagements"),{headers:{"X-User-Email":e,"X-Engagement-ID":(0,o.K3)()||"bootstrap"}});if(n.ok){let e=await n.json();t(e)}else try{let e=await n.json(),t=e.message||e.error||e.detail;h(t?"Failed to load engagements: ".concat(t):"Failed to load engagements (".concat(n.status," ").concat(n.statusText,")"))}catch(e){try{let e=await n.text();h(e?"Failed to load engagements: ".concat(e):"Failed to load engagements (".concat(n.status," ").concat(n.statusText,")"))}catch(e){h("Failed to load engagements (".concat(n.status," ").concat(n.statusText,")"))}}}catch(e){console.error("Failed to load engagements",e),h("Failed to load engagements")}finally{m(!1)}},p=e=>{if((0,o.d8)(e),c(e),u(!1),"/demo-orchestration"===x)g.push("/e/".concat(e,"/demo"));else if(x.startsWith("/e/")&&x.includes("/demo")){let t=x.replace(/\/e\/[^/]+\//,"/e/".concat(e,"/"));g.push(t)}},b=e.find(e=>e.id===n);return(0,o.OD)()&&0!==e.length?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>u(!l),className:"flex items-center gap-2 px-3 py-2 text-sm border rounded hover:bg-gray-50 disabled:opacity-50",disabled:d,children:[(0,a.jsx)("span",{className:"font-medium",children:d?"Loading...":b?b.name:"Select Engagement"}),(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&(0,a.jsxs)("div",{className:"absolute right-0 mt-1 w-64 bg-white border rounded-md shadow-lg z-50",children:[f&&(0,a.jsxs)("div",{className:"px-4 py-2 text-sm text-red-600 bg-red-50 border-b",children:[f,(0,a.jsx)("button",{onClick:()=>{h(null),y()},className:"ml-2 text-xs underline",children:"Retry"})]}),(0,a.jsx)("div",{className:"py-1",children:e.map(e=>(0,a.jsxs)("button",{onClick:()=>p(e.id),className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 ".concat(e.id===n?"bg-gray-50 font-medium":""),children:[(0,a.jsx)("div",{children:e.name}),e.client_code&&(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["Client: ",e.client_code]})]},e.id))}),(0,a.jsx)("div",{className:"border-t",children:(0,a.jsx)("button",{onClick:()=>{u(!1),g.push("/engagements")},className:"w-full text-left px-4 py-2 text-sm text-indigo-600 hover:bg-gray-100",children:"Manage Engagements"})})]})]}):null}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return o},Sg:function(){return c},tQ:function(){return i}});var a=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){let e=(0,a.OD)(),t=(0,a.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r(),a=new AbortController,o=setTimeout(()=>a.abort(),t.timeout||3e4);try{let r=await fetch("".concat(s).concat(e),{...t,signal:a.signal,headers:{...n,...t.headers}});if(clearTimeout(o),!r.ok){let e=await r.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(r.status))}return r.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function i(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let a=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!a.ok)throw Error("Preset ".concat(e," not found"));return a.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=s;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return c},K3:function(){return r},OD:function(){return s},Pk:function(){return i},d8:function(){return o}});var a=n(40257);function s(){return localStorage.getItem("email")||""}function r(){return localStorage.getItem("engagementId")||""}function o(e){localStorage.setItem("engagementId",e)}async function i(e){return s()||(await e.push("/signin"),"")}function c(){let e=s();return(a.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},34838:function(e,t,n){"use strict";n.d(t,{$6:function(){return r},CZ:function(){return s},GR:function(){return o},Xj:function(){return c},oe:function(){return i}});var a=n(29116);async function s(e){let t=await fetch("".concat(a.Sg,"/engagements/").concat(e,"/docs"),{headers:(0,a.$V)()});if(!t.ok)throw Error("listDocs ".concat(t.status));return t.json()}async function r(e,t){let n=new FormData;t.forEach(e=>n.append("files",e));let s={method:"POST",headers:(0,a.$V)(!0),body:n},r=await fetch("".concat(a.Sg,"/engagements/").concat(e,"/docs"),s);if(!r.ok){let e="uploadDocs failed with status ".concat(r.status);try{let t=await r.text();t&&(e+=": ".concat(t))}catch(t){e+=" (unable to read error details)"}throw Error(e)}return r.json()}function o(e,t){return"".concat(a.Sg,"/engagements/").concat(e,"/docs/").concat(t)}async function i(e,t){let n=await fetch("".concat(a.Sg,"/engagements/").concat(e,"/docs/").concat(t),{method:"DELETE",headers:(0,a.$V)()});if(!n.ok)throw Error("deleteDoc ".concat(n.status));return n.json()}async function c(e,t){let n=await fetch("".concat(a.Sg,"/orchestrations/analyze-doc"),{method:"POST",headers:(0,a.$V)(),body:JSON.stringify({doc_id:t})});if(!n.ok)throw Error("analyzeDoc ".concat(n.status));return n.json()}},68601:function(e,t,n){"use strict";n.d(t,{$O:function(){return i},Be:function(){return o},GV:function(){return c},Sg:function(){return s}});var a=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){return{"X-User-Email":(0,a.OD)()||"","X-Engagement-ID":(0,a.K3)()||""}}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"NIST-CSF",n=e.trim();if(!n)throw Error("createAssessment: name must be a non-empty string");let a=await fetch("".concat(s,"/domain-assessments"),{method:"POST",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify({name:n,framework:t})});if(!a.ok)throw Error("createAssessment failed: ".concat(a.status));return a.json()}async function i(e,t){let n=await fetch("".concat(s,"/orchestrations/analyze"),{method:"POST",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify({assessment_id:e,content:t})});if(!n.ok)throw Error("analyze failed: ".concat(n.status));return await n.json()}async function c(e){let t=await fetch("".concat(s,"/orchestrations/recommend"),{method:"POST",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify({assessment_id:e})});if(!t.ok)throw Error("recommend failed: ".concat(t.status));return await t.json()}},99376:function(e,t,n){"use strict";var a=n(35475);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},40257:function(e,t,n){"use strict";var a,s;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,a,s=e.exports={};function r(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c=[],l=!1,u=-1;function d(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&m())}function m(){if(!l){var e=i(d);l=!0;for(var t=c.length;t;){for(a=c,c=[];++u<t;)a&&a[u].run();u=-1,t=c.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||l||i(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=h,s.addListener=h,s.once=h,s.off=h,s.removeListener=h,s.removeAllListeners=h,s.emit=h,s.prependListener=h,s.prependOnceListener=h,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}},o=!0;try{t[e](r,r.exports,a),o=!1}finally{o&&delete n[e]}return r.exports}a.ab="//";var s=a(229);e.exports=s}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=68515)}),_N_E=e.O()}]);