"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1],{65001:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(57437),r=a(2265),i=a(99376),o=a(4062);let s=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/csv","image/png","image/jpeg","image/gif","application/zip","application/x-zip-compressed"];function c(e){var t;let{onUploadComplete:a,className:c=""}=e,{engagementId:l}=(0,i.useParams)(),[u,d]=(0,r.useState)({status:"idle",progress:0}),[p,f]=(0,r.useState)(null),g=(0,r.useRef)(null),h=(0,r.useCallback)(()=>{d({status:"idle",progress:0}),f(null),g.current&&(g.current.value="")},[]),m=(0,r.useCallback)(e=>e.size>26214400?"File too large. Maximum size: ".concat((0,o.sS)(26214400)):s.includes(e.type)?null:"Unsupported file type: ".concat(e.type,". Allowed types: PDF, DOCX, XLSX, PPTX, TXT, CSV, PNG, JPG, GIF, ZIP"),[]),y=(0,r.useCallback)(e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;let n=m(a);if(n){d({status:"error",progress:0,error:n});return}f(a),d({status:"idle",progress:0})},[m]),x=(0,r.useCallback)(async()=>{if(p&&l)try{d({status:"generating_sas",progress:10});let e=await (0,o.fj)({engagement_id:l,filename:p.name,mime_type:p.type,size_bytes:p.size});d({status:"uploading",progress:30}),await (0,o.LB)(e.upload_url,p),d({status:"uploading",progress:70});let t=await (0,o.W2)(p);d({status:"completing",progress:90});let n=await (0,o.Hi)({engagement_id:l,blob_path:e.blob_path,filename:p.name,mime_type:p.type,size_bytes:p.size,client_checksum:t}),r={id:n.evidence_id,engagement_id:l,blob_path:e.blob_path,filename:p.name,checksum_sha256:n.checksum,size:n.size,mime_type:p.type,uploaded_by:"",uploaded_at:new Date().toISOString(),pii_flag:n.pii_flag,linked_items:[]};d({status:"completed",progress:100,evidence:r}),a&&a(r)}catch(e){d({status:"error",progress:0,error:e instanceof Error?e.message:"Upload failed"})}},[p,l,a]),v=()=>{switch(u.status){case"generating_sas":return"Generating upload URL...";case"uploading":return"Uploading file...";case"completing":return"Finalizing upload...";case"completed":return"Upload completed successfully!";case"error":return"Error: ".concat(u.error);default:return""}},w=["generating_sas","uploading","completing"].includes(u.status);return(0,n.jsxs)("div",{className:"space-y-4 ".concat(c),children:[(0,n.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",role:"button",tabIndex:w?-1:0,"aria-label":"File upload area",onKeyDown:e=>{if(("Enter"===e.key||" "===e.key)&&!w){var t;e.preventDefault(),null===(t=g.current)||void 0===t||t.click()}},children:[(0,n.jsx)("input",{ref:g,type:"file",onChange:y,disabled:w,className:"hidden",accept:".pdf,.docx,.xlsx,.pptx,.txt,.csv,.png,.jpg,.jpeg,.gif,.zip"}),p?(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-4xl mb-2",children:(0,o.LP)(p.type)}),(0,n.jsx)("div",{className:"text-sm font-medium mb-1",children:p.name}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 mb-4",children:[(0,o.sS)(p.size)," • ",p.type]}),"idle"===u.status&&(0,n.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,n.jsx)("button",{onClick:x,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Upload"}),(0,n.jsx)("button",{onClick:h,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCE"}),(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-4",children:"Select a file to upload as evidence"}),(0,n.jsx)("button",{onClick:()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.click()},disabled:w,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50","aria-label":"Choose file to upload",children:"Choose File"}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Max size: ",(0,o.sS)(26214400)," • Supported: PDF, DOCX, XLSX, PPTX, TXT, CSV, Images, ZIP"]})]})]}),w&&(0,n.jsxs)("div",{className:"space-y-2",role:"status","aria-live":"polite",children:[(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",role:"progressbar","aria-valuenow":u.progress,"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Upload progress",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(u.progress,"%")}})}),(0,n.jsxs)("div",{className:"text-sm text-center text-gray-600",children:[u.progress,"% - ",v()]})]}),"idle"!==u.status&&!w&&(0,n.jsxs)("div",{className:"text-sm text-center ".concat((()=>{switch(u.status){case"error":return"text-red-600";case"completed":return"text-green-600";default:return"text-blue-600"}})()),role:"error"===u.status?"alert":"status","aria-live":"error"===u.status?"assertive":"polite",children:[v(),"completed"===u.status&&(null===(t=u.evidence)||void 0===t?void 0:t.pii_flag)&&(0,n.jsx)("div",{className:"text-orange-600 mt-2",role:"alert",children:"⚠️ Potential PII detected in this file"})]}),"completed"===u.status&&(0,n.jsx)("div",{className:"flex gap-2 justify-center",children:(0,n.jsx)("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Upload Another File"})})]})}},29116:function(e,t,a){a.d(t,{$V:function(){return l},SC:function(){return o},Sg:function(){return c},tQ:function(){return s}});var n=a(16023);let r=a(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function i(){let e=(0,n.OD)(),t=(0,n.K3)(),a={};return e&&(a["X-User-Email"]=e),t&&(a["X-Engagement-ID"]=t),a}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i(),n=new AbortController,o=setTimeout(()=>n.abort(),t.timeout||3e4);try{let i=await fetch("".concat(r).concat(e),{...t,signal:n.signal,headers:{...a,...t.headers}});if(clearTimeout(o),!i.ok){let e=await i.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(i.status))}return i.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function s(e){let t=new AbortController,a=setTimeout(()=>t.abort(),3e4);try{let n=await fetch("".concat(r,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(a),!n.ok)throw Error("Preset ".concat(e," not found"));return n.json()}catch(t){if(clearTimeout(a),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=r;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,a){a.d(t,{GJ:function(){return c},K3:function(){return i},OD:function(){return r},Pk:function(){return s},d8:function(){return o}});var n=a(40257);function r(){return localStorage.getItem("email")||""}function i(){return localStorage.getItem("engagementId")||""}function o(e){localStorage.setItem("engagementId",e)}async function s(e){return r()||(await e.push("/signin"),"")}function c(){let e=r();return(n.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},4062:function(e,t,a){a.d(t,{$r:function(){return l},EK:function(){return c},Hi:function(){return p},Hj:function(){return o},LB:function(){return m},LP:function(){return v},LT:function(){return u},W2:function(){return y},Zg:function(){return r},fG:function(){return h},fj:function(){return d},kR:function(){return s},q8:function(){return f},sS:function(){return x},tc:function(){return g},te:function(){return i}});var n=a(29116);async function r(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function i(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function o(e,t){let a=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(a.status));return a.json()}async function s(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function c(e){let[t,a]=await Promise.all([(0,n.SC)("/engagements/".concat(e,"/docs")),i(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:a.find(t=>t.document_id===e.id)}))}async function l(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:a})});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function u(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function d(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||"SAS generation failed: ".concat(t.status));return t.json()}async function p(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||"Upload completion failed: ".concat(t.status));return t.json()}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,n=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:a.toString()}),r=await fetch("/api/proxy/evidence?".concat(n));if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Failed to list evidence"}))).detail||"Failed to list evidence: ".concat(r.status));let i=await r.json(),o=parseInt(r.headers.get("X-Total-Count")||"0"),s=parseInt(r.headers.get("X-Page")||"1"),c=parseInt(r.headers.get("X-Page-Size")||"50");return{data:i,total:o,page:s,page_size:c,total_pages:parseInt(r.headers.get("X-Total-Pages")||"1"),has_next:"true"===r.headers.get("X-Has-Next"),has_previous:"true"===r.headers.get("X-Has-Previous")}}async function g(e,t){let a=await fetch("/api/proxy/evidence/".concat(e,"/links"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Evidence linking failed"}))).detail||"Evidence linking failed: ".concat(a.status));return a.json()}async function h(e,t){let a=await fetch("/api/proxy/evidence/".concat(e,"/links/").concat(t),{method:"DELETE"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||"Evidence unlinking failed: ".concat(a.status));return a.json()}async function m(e,t){let a=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!a.ok)throw Error("Azure upload failed: ".concat(a.statusText))}async function y(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function x(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function v(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}}}]);