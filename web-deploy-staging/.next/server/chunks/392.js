"use strict";exports.id=392,exports.ids=[392],exports.modules={44392:(e,t,a)=>{a.d(t,{Z:()=>l});var i=a(10326),s=a(17577),r=a(35047),n=a(23820);let o=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/csv","image/png","image/jpeg","image/gif","application/zip","application/x-zip-compressed"];function l({onUploadComplete:e,className:t=""}){let{engagementId:a}=(0,r.useParams)(),[l,c]=(0,s.useState)({status:"idle",progress:0}),[d,u]=(0,s.useState)(null),p=(0,s.useRef)(null),g=(0,s.useCallback)(()=>{c({status:"idle",progress:0}),u(null),p.current&&(p.current.value="")},[]),h=(0,s.useCallback)(e=>e.size>26214400?`File too large. Maximum size: ${(0,n.sS)(26214400)}`:o.includes(e.type)?null:`Unsupported file type: ${e.type}. Allowed types: PDF, DOCX, XLSX, PPTX, TXT, CSV, PNG, JPG, GIF, ZIP`,[]),f=(0,s.useCallback)(e=>{let t=e.target.files?.[0];if(!t)return;let a=h(t);if(a){c({status:"error",progress:0,error:a});return}u(t),c({status:"idle",progress:0})},[h]),m=(0,s.useCallback)(async()=>{if(d&&a)try{c({status:"generating_sas",progress:10});let t=await (0,n.fj)({engagement_id:a,filename:d.name,mime_type:d.type,size_bytes:d.size});c({status:"uploading",progress:30}),await (0,n.LB)(t.upload_url,d),c({status:"uploading",progress:70});let i=await (0,n.W2)(d);c({status:"completing",progress:90});let s=await (0,n.Hi)({engagement_id:a,blob_path:t.blob_path,filename:d.name,mime_type:d.type,size_bytes:d.size,client_checksum:i}),r={id:s.evidence_id,engagement_id:a,blob_path:t.blob_path,filename:d.name,checksum_sha256:s.checksum,size:s.size,mime_type:d.type,uploaded_by:"",uploaded_at:new Date().toISOString(),pii_flag:s.pii_flag,linked_items:[]};c({status:"completed",progress:100,evidence:r}),e&&e(r)}catch(e){c({status:"error",progress:0,error:e instanceof Error?e.message:"Upload failed"})}},[d,a,e]),y=()=>{switch(l.status){case"generating_sas":return"Generating upload URL...";case"uploading":return"Uploading file...";case"completing":return"Finalizing upload...";case"completed":return"Upload completed successfully!";case"error":return`Error: ${l.error}`;default:return""}},x=["generating_sas","uploading","completing"].includes(l.status);return(0,i.jsxs)("div",{className:`space-y-4 ${t}`,children:[(0,i.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",role:"button",tabIndex:x?-1:0,"aria-label":"File upload area",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||x||(e.preventDefault(),p.current?.click())},children:[i.jsx("input",{ref:p,type:"file",onChange:f,disabled:x,className:"hidden",accept:".pdf,.docx,.xlsx,.pptx,.txt,.csv,.png,.jpg,.jpeg,.gif,.zip"}),d?(0,i.jsxs)("div",{children:[i.jsx("div",{className:"text-4xl mb-2",children:(0,n.LP)(d.type)}),i.jsx("div",{className:"text-sm font-medium mb-1",children:d.name}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mb-4",children:[(0,n.sS)(d.size)," • ",d.type]}),"idle"===l.status&&(0,i.jsxs)("div",{className:"flex gap-2 justify-center",children:[i.jsx("button",{onClick:m,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Upload"}),i.jsx("button",{onClick:g,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"})]})]}):(0,i.jsxs)("div",{children:[i.jsx("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCE"}),i.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Select a file to upload as evidence"}),i.jsx("button",{onClick:()=>p.current?.click(),disabled:x,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50","aria-label":"Choose file to upload",children:"Choose File"}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Max size: ",(0,n.sS)(26214400)," • Supported: PDF, DOCX, XLSX, PPTX, TXT, CSV, Images, ZIP"]})]})]}),x&&(0,i.jsxs)("div",{className:"space-y-2",role:"status","aria-live":"polite",children:[i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",role:"progressbar","aria-valuenow":l.progress,"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Upload progress",children:i.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${l.progress}%`}})}),(0,i.jsxs)("div",{className:"text-sm text-center text-gray-600",children:[l.progress,"% - ",y()]})]}),"idle"!==l.status&&!x&&(0,i.jsxs)("div",{className:`text-sm text-center ${(()=>{switch(l.status){case"error":return"text-red-600";case"completed":return"text-green-600";default:return"text-blue-600"}})()}`,role:"error"===l.status?"alert":"status","aria-live":"error"===l.status?"assertive":"polite",children:[y(),"completed"===l.status&&l.evidence?.pii_flag&&i.jsx("div",{className:"text-orange-600 mt-2",role:"alert",children:"⚠️ Potential PII detected in this file"})]}),"completed"===l.status&&i.jsx("div",{className:"flex gap-2 justify-center",children:i.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Upload Another File"})})]})}},6824:(e,t,a)=>{a.d(t,{$V:()=>c,SC:()=>n,Sg:()=>l,tQ:()=>o});var i=a(2991);let s=process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){let e=(0,i.OD)(),t=(0,i.K3)(),a={};return e&&(a["X-User-Email"]=e),t&&(a["X-Engagement-ID"]=t),a}async function n(e,t={}){let a=r(),i=new AbortController,n=setTimeout(()=>i.abort(),t.timeout||3e4);try{let r=await fetch(`${s}${e}`,{...t,signal:i.signal,headers:{...a,...t.headers}});if(clearTimeout(n),!r.ok){let e=await r.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||`Request failed: ${r.status}`)}return r.json()}catch(e){if(clearTimeout(n),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,a=setTimeout(()=>t.abort(),3e4);try{let i=await fetch(`${s}/presets/${e}`,{cache:"no-store",signal:t.signal});if(clearTimeout(a),!i.ok)throw Error(`Preset ${e} not found`);return i.json()}catch(t){if(clearTimeout(a),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let l=s;function c(e=!1){let t=r();return e||(t["Content-Type"]="application/json"),t}},2991:(e,t,a)=>{function i(){return""}function s(){return""}function r(e){}function n(){return(process.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes("")}a.d(t,{GJ:()=>n,K3:()=>s,OD:()=>i,d8:()=>r})},23820:(e,t,a)=>{a.d(t,{$r:()=>c,EK:()=>l,Hi:()=>p,Hj:()=>n,LB:()=>m,LP:()=>w,LT:()=>d,W2:()=>y,Zg:()=>s,fG:()=>f,fj:()=>u,kR:()=>o,q8:()=>g,sS:()=>x,tc:()=>h,te:()=>r});var i=a(6824);async function s(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||`Search failed: ${t.status}`);return t.json()}async function r(e){let t=await fetch(`/api/proxy/engagements/${e}/docs/ingestion-status`);if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||`Request failed: ${t.status}`);return t.json()}async function n(e,t){let a=await fetch(`/api/proxy/engagements/${e}/docs/${t}/ingest`,{method:"POST"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Ingestion failed"}))).detail||`Request failed: ${a.status}`);return a.json()}async function o(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||`Request failed: ${t.status}`);return t.json()}async function l(e){let[t,a]=await Promise.all([(0,i.SC)(`/engagements/${e}/docs`),r(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:a.find(t=>t.document_id===e.id)}))}async function c(e,t,a=!1){let i=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:a})});if(!i.ok)throw Error((await i.json().catch(()=>({detail:"Analysis failed"}))).detail||`Request failed: ${i.status}`);return i.json()}async function d(e){let t=await fetch(`/api/proxy/analysis/${e}/citations`);if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||`Request failed: ${t.status}`);return t.json()}async function u(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||`SAS generation failed: ${t.status}`);return t.json()}async function p(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||`Upload completion failed: ${t.status}`);return t.json()}async function g(e,t=1,a=50){let i=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:a.toString()}),s=await fetch(`/api/proxy/evidence?${i}`);if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Failed to list evidence"}))).detail||`Failed to list evidence: ${s.status}`);let r=await s.json(),n=parseInt(s.headers.get("X-Total-Count")||"0"),o=parseInt(s.headers.get("X-Page")||"1"),l=parseInt(s.headers.get("X-Page-Size")||"50");return{data:r,total:n,page:o,page_size:l,total_pages:parseInt(s.headers.get("X-Total-Pages")||"1"),has_next:"true"===s.headers.get("X-Has-Next"),has_previous:"true"===s.headers.get("X-Has-Previous")}}async function h(e,t){let a=await fetch(`/api/proxy/evidence/${e}/links`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Evidence linking failed"}))).detail||`Evidence linking failed: ${a.status}`);return a.json()}async function f(e,t){let a=await fetch(`/api/proxy/evidence/${e}/links/${t}`,{method:"DELETE"});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||`Evidence unlinking failed: ${a.status}`);return a.json()}async function m(e,t){let a=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!a.ok)throw Error(`Azure upload failed: ${a.statusText}`)}async function y(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function x(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function w(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}}};