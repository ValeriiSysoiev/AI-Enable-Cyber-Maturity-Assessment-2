(()=>{var e={};e.id=665,e.ids=[665],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},34806:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),r(8365),r(56698),r(35866);var s=r(23191),n=r(88716),a=r(37922),i=r.n(a),o=r(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["e",{children:["[engagementId]",{children:["assessment",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8365)),"/Users/svvval/Documents/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/assessment/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,56698)),"/Users/svvval/Documents/AI-Enable-Cyber-Maturity-Assessment-2/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/svvval/Documents/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/assessment/page.tsx"],u="/e/[engagementId]/assessment/page",m={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/e/[engagementId]/assessment/page",pathname:"/e/[engagementId]/assessment",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},26348:(e,t,r)=>{Promise.resolve().then(r.bind(r,24027))},24027:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var s=r(10326),n=r(17577),a=r(35047),i=r(6824);let o=new Map;async function l(){let e="csf:functions",t=function(e){let t=o.get(e);return t?Date.now()-t.timestamp>3e5?(o.delete(e),null):t.data:null}(e);if(t)return t;try{let t=(await (0,i.SC)("/api/v1/csf/functions",{timeout:1e4})).functions;return o.set(e,{data:t,timestamp:Date.now()}),t}catch(e){throw console.error("Error loading CSF functions:",e),Error(e instanceof Error?e.message:"Failed to load CSF taxonomy")}}var c=r(79682);function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(null,arguments)}function u(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var h=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function f(e,t){if(e.length!==t.length)return!1;for(var r,s,n=0;n<e.length;n++)if(!((r=e[n])===(s=t[n])||h(r)&&h(s)))return!1;return!0}let p=function(e,t){void 0===t&&(t=f);var r,s,n=[],a=!1;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return a&&r===this&&t(i,n)||(s=e.apply(this,i),a=!0,r=this,n=i),s}};var g="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function x(e){cancelAnimationFrame(e.id)}var v=-1;function y(e){if(void 0===e&&(e=!1),-1===v||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),v=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return v}var b=null;function j(e){if(void 0===e&&(e=!1),null===b||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var s=document.createElement("div"),n=s.style;n.width="100px",n.height="100px",t.appendChild(s),document.body.appendChild(t),t.scrollLeft>0?b="positive-descending":(t.scrollLeft=1,b=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t)}return b}var S=function(e,t,r,s){var n,a,i;if("column"===e?(n=s.columnMetadataMap,a=t.columnWidth,i=s.lastMeasuredColumnIndex):(n=s.rowMetadataMap,a=t.rowHeight,i=s.lastMeasuredRowIndex),r>i){var o=0;if(i>=0){var l=n[i];o=l.offset+l.size}for(var c=i+1;c<=r;c++){var d=a(c);n[c]={offset:o,size:d},o+=d}"column"===e?s.lastMeasuredColumnIndex=r:s.lastMeasuredRowIndex=r}return n[r]},w=function(e,t,r,s,n,a){for(;n<=s;){var i=n+Math.floor((s-n)/2),o=S(e,t,i,r).offset;if(o===a)return i;o<a?n=i+1:o>a&&(s=i-1)}return n>0?n-1:0},N=function(e,t){return e},C=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},_=function(e,t,r){var s=e.itemSize,n=r.itemMetadataMap,a=r.lastMeasuredIndex;if(t>a){var i=0;if(a>=0){var o=n[a];i=o.offset+o.size}for(var l=a+1;l<=t;l++){var c=s(l);n[l]={offset:i,size:c},i+=c}r.lastMeasuredIndex=t}return n[t]},I=function(e,t,r,s,n){for(;s<=r;){var a=s+Math.floor((r-s)/2),i=_(e,a,t).offset;if(i===n)return a;i<n?s=a+1:i>n&&(r=a-1)}return s>0?s-1:0},E=function(e){var t,r=e.getItemOffset,s=e.getEstimatedTotalSize,a=e.getItemSize,i=e.getOffsetForIndexAndAlignment,o=e.getStartIndexForOffset,l=e.getStopIndexForStartIndex,c=e.initInstanceProps,h=e.shouldResetStyleCacheOnItemSizeChange,f=e.validateProps;return(t=function(e){function t(t){var s;return(s=e.call(this,t)||this)._instanceProps=c(s.props,u(s)),s._outerRef=void 0,s._resetIsScrollingTimeoutId=null,s.state={instance:u(s),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof s.props.initialScrollOffset?s.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},s._callOnItemsRendered=void 0,s._callOnItemsRendered=p(function(e,t,r,n){return s.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:r,visibleStopIndex:n})}),s._callOnScroll=void 0,s._callOnScroll=p(function(e,t,r){return s.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:r})}),s._getItemStyle=void 0,s._getItemStyle=function(e){var t,n=s.props,i=n.direction,o=n.itemSize,l=n.layout,c=s._getItemStyleCache(h&&o,h&&l,h&&i);if(c.hasOwnProperty(e))t=c[e];else{var d=r(s.props,e,s._instanceProps),u=a(s.props,e,s._instanceProps),m="horizontal"===i||"horizontal"===l,f="rtl"===i,p=m?d:0;c[e]=t={position:"absolute",left:f?void 0:p,right:f?p:void 0,top:m?0:d,height:m?"100%":u,width:m?u:"100%"}}return t},s._getItemStyleCache=void 0,s._getItemStyleCache=p(function(e,t,r){return{}}),s._onScrollHorizontal=function(e){var t=e.currentTarget,r=t.clientWidth,n=t.scrollLeft,a=t.scrollWidth;s.setState(function(e){if(e.scrollOffset===n)return null;var t=s.props.direction,i=n;if("rtl"===t)switch(j()){case"negative":i=-n;break;case"positive-descending":i=a-r-n}return i=Math.max(0,Math.min(i,a-r)),{isScrolling:!0,scrollDirection:e.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!1}},s._resetIsScrollingDebounced)},s._onScrollVertical=function(e){var t=e.currentTarget,r=t.clientHeight,n=t.scrollHeight,a=t.scrollTop;s.setState(function(e){if(e.scrollOffset===a)return null;var t=Math.max(0,Math.min(a,n-r));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}},s._resetIsScrollingDebounced)},s._outerRefSetter=function(e){var t=s.props.outerRef;s._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},s._resetIsScrollingDebounced=function(){var e,t,r;null!==s._resetIsScrollingTimeoutId&&x(s._resetIsScrollingTimeoutId),s._resetIsScrollingTimeoutId=(e=s._resetIsScrolling,t=g(),r={id:requestAnimationFrame(function s(){g()-t>=150?e.call(null):r.id=requestAnimationFrame(s)})})},s._resetIsScrolling=function(){s._resetIsScrollingTimeoutId=null,s.setState({isScrolling:!1},function(){s._getItemStyleCache(-1,null)})},s}v=t,b=e,v.prototype=Object.create(b.prototype),v.prototype.constructor=v,m(v,b),t.getDerivedStateFromProps=function(e,t){return C(e,t),f(e),null};var v,b,S=t.prototype;return S.scrollTo=function(e){e=Math.max(0,e),this.setState(function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},S.scrollToItem=function(e,t){void 0===t&&(t="auto");var r=this.props,s=r.itemCount,n=r.layout,a=this.state.scrollOffset;e=Math.max(0,Math.min(e,s-1));var o=0;if(this._outerRef){var l=this._outerRef;o="vertical"===n?l.scrollWidth>l.clientWidth?y():0:l.scrollHeight>l.clientHeight?y():0}this.scrollTo(i(this.props,e,t,a,this._instanceProps,o))},S.componentDidMount=function(){var e=this.props,t=e.direction,r=e.initialScrollOffset,s=e.layout;if("number"==typeof r&&null!=this._outerRef){var n=this._outerRef;"horizontal"===t||"horizontal"===s?n.scrollLeft=r:n.scrollTop=r}this._callPropsCallbacks()},S.componentDidUpdate=function(){var e=this.props,t=e.direction,r=e.layout,s=this.state,n=s.scrollOffset;if(s.scrollUpdateWasRequested&&null!=this._outerRef){var a=this._outerRef;if("horizontal"===t||"horizontal"===r){if("rtl"===t)switch(j()){case"negative":a.scrollLeft=-n;break;case"positive-ascending":a.scrollLeft=n;break;default:var i=a.clientWidth,o=a.scrollWidth;a.scrollLeft=o-i-n}else a.scrollLeft=n}else a.scrollTop=n}this._callPropsCallbacks()},S.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&x(this._resetIsScrollingTimeoutId)},S.render=function(){var e=this.props,t=e.children,r=e.className,a=e.direction,i=e.height,o=e.innerRef,l=e.innerElementType,c=e.innerTagName,u=e.itemCount,m=e.itemData,h=e.itemKey,f=void 0===h?N:h,p=e.layout,g=e.outerElementType,x=e.outerTagName,v=e.style,y=e.useIsScrolling,b=e.width,j=this.state.isScrolling,S="horizontal"===a||"horizontal"===p,w=S?this._onScrollHorizontal:this._onScrollVertical,C=this._getRangeToRender(),_=C[0],I=C[1],E=[];if(u>0)for(var D=_;D<=I;D++)E.push((0,n.createElement)(t,{data:m,key:f(D,m),index:D,isScrolling:y?j:void 0,style:this._getItemStyle(D)}));var P=s(this.props,this._instanceProps);return(0,n.createElement)(g||x||"div",{className:r,onScroll:w,ref:this._outerRefSetter,style:d({position:"relative",height:i,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:a},v)},(0,n.createElement)(l||c||"div",{children:E,ref:o,style:{height:S?"100%":P,pointerEvents:j?"none":void 0,width:S?P:"100%"}}))},S._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],r=e[1],s=e[2],n=e[3];this._callOnItemsRendered(t,r,s,n)}if("function"==typeof this.props.onScroll){var a=this.state,i=a.scrollDirection,o=a.scrollOffset,l=a.scrollUpdateWasRequested;this._callOnScroll(i,o,l)}},S._getRangeToRender=function(){var e=this.props,t=e.itemCount,r=e.overscanCount,s=this.state,n=s.isScrolling,a=s.scrollDirection,i=s.scrollOffset;if(0===t)return[0,0,0,0];var c=o(this.props,i,this._instanceProps),d=l(this.props,c,i,this._instanceProps);return[Math.max(0,c-(n&&"backward"!==a?1:Math.max(1,r))),Math.max(0,Math.min(t-1,d+(n&&"forward"!==a?1:Math.max(1,r)))),c,d]},t}(n.PureComponent)).defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,r,s,n,a){var i=e.direction,o=e.height,l=e.itemCount,c=e.itemSize,d=e.layout,u=e.width,m="horizontal"===i||"horizontal"===d?u:o,h=Math.max(0,l*c-m),f=Math.min(h,t*c),p=Math.max(0,t*c-m+c+a);switch("smart"===r&&(r=s>=p-m&&s<=f+m?"auto":"center"),r){case"start":return f;case"end":return p;case"center":var g=Math.round(p+(f-p)/2);if(g<Math.ceil(m/2))return 0;if(g>h+Math.floor(m/2))return h;return g;default:if(s>=p&&s<=f)return s;if(s<p)return p;return f}},getStartIndexForOffset:function(e,t){return Math.max(0,Math.min(e.itemCount-1,Math.floor(t/e.itemSize)))},getStopIndexForStartIndex:function(e,t,r){var s=e.direction,n=e.height,a=e.itemCount,i=e.itemSize,o=e.layout,l=e.width;return Math.max(0,Math.min(a-1,t+Math.ceil((("horizontal"===s||"horizontal"===o?l:n)+r-t*i)/i)-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}}),D=r(23820);let P=({index:e,style:t,data:r})=>{let n=r[e];return s.jsx("div",{style:t,className:"px-4 py-2 border-b border-gray-100 hover:bg-blue-50 cursor-pointer",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"text-sm mt-1",children:"\uD83D\uDCC4"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:n.filename}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Uploaded ",new Date(n.uploaded_at).toLocaleDateString()]}),n.linked_items.length>0&&s.jsx("div",{className:"flex gap-1 mt-1",children:n.linked_items.map((e,t)=>s.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 rounded",children:e.item_type},t))})]})]})})};function O({subcategory:e,isOpen:t,onClose:r,onScoreChange:i,onRationaleChange:o,onEvidenceSelect:l,correlationId:c}){let{engagementId:d}=(0,a.useParams)(),[u,m]=(0,n.useState)(0),[h,f]=(0,n.useState)(""),[p,g]=(0,n.useState)([]),[x,v]=(0,n.useState)(!1),[y,b]=(0,n.useState)(null),[j,S]=(0,n.useState)("assessment"),w=(0,n.useRef)(null),N=(0,n.useRef)(null),C=(0,n.useRef)(null),_=(0,n.useRef)(null),I=(0,n.useCallback)(async()=>{if(d&&t){v(!0),b(null);try{console.log(`[${c}] Loading evidence for engagement: ${d}`);let e=await (0,D.q8)(d,1,100);g(e.data),console.log(`[${c}] Loaded ${e.data.length} evidence items`)}catch(t){let e=t instanceof Error?t.message:"Failed to load evidence";console.error(`[${c}] Evidence loading error:`,t),b(e)}finally{v(!1)}}},[d,t,c]),O=t=>{console.log(`[${c}] Score changed to: ${t} for subcategory: ${e?.id}`),m(t),i?.(t)},$=e=>{f(e),o?.(e)},R=(0,n.useMemo)(()=>p,[p]);return t&&e?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-end",role:"dialog","aria-modal":"true","aria-labelledby":"drawer-title",onClick:e=>{e.target===e.currentTarget&&r()},children:(0,s.jsxs)("div",{ref:w,className:"w-full max-w-2xl h-full bg-white shadow-xl flex flex-col",onClick:e=>e.stopPropagation(),children:[s.jsx("div",{className:"border-b border-gray-200 p-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("h2",{id:"drawer-title",className:"text-xl font-semibold text-gray-900",children:e.id}),s.jsx("h3",{className:"text-lg text-gray-700 mt-1",children:e.title}),s.jsx("p",{className:"text-sm text-gray-600 mt-2",children:e.description})]}),s.jsx("button",{onClick:r,className:"ml-4 p-2 hover:bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close drawer",children:s.jsx("span",{className:"text-xl",children:"\xd7"})})]})}),s.jsx("div",{className:"border-b border-gray-200",children:(0,s.jsxs)("nav",{className:"flex",role:"tablist",children:[s.jsx("button",{role:"tab","aria-selected":"assessment"===j,"aria-controls":"assessment-panel",className:`px-6 py-3 text-sm font-medium border-b-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${"assessment"===j?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>S("assessment"),children:"Assessment"}),(0,s.jsxs)("button",{role:"tab","aria-selected":"evidence"===j,"aria-controls":"evidence-panel",className:`px-6 py-3 text-sm font-medium border-b-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${"evidence"===j?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>S("evidence"),children:["Evidence (",R.length,")"]})]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["assessment"===j&&(0,s.jsxs)("div",{id:"assessment-panel",role:"tabpanel",className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"score-input",className:"block text-sm font-medium text-gray-700 mb-2",children:"Implementation Score (1-5)"}),s.jsx("div",{className:"flex gap-2 mb-3",children:[1,2,3,4,5].map(e=>s.jsx("button",{onClick:()=>O(e),className:`px-4 py-2 text-sm rounded border focus:outline-none focus:ring-2 focus:ring-blue-500 ${u===e?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,"aria-pressed":u===e,children:e},e))}),s.jsx("input",{ref:N,id:"score-input",type:"range",min:"0",max:"5",step:"1",value:u,onChange:e=>O(parseInt(e.target.value)),className:"w-full","aria-describedby":"score-help"}),s.jsx("div",{id:"score-help",className:"text-xs text-gray-500 mt-1",children:"Use Ctrl/Cmd + 1-5 for quick scoring"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"rationale-textarea",className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Rationale"}),s.jsx("textarea",{ref:C,id:"rationale-textarea",value:h,onChange:e=>$(e.target.value),rows:6,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Explain the reasoning behind your assessment score...","aria-describedby":"rationale-help"}),s.jsx("div",{id:"rationale-help",className:"text-xs text-gray-500 mt-1",children:"Provide detailed justification for the score assigned"})]})]}),"evidence"===j&&s.jsx("div",{id:"evidence-panel",role:"tabpanel",children:x?s.jsx("div",{className:"flex items-center justify-center py-8",role:"status","aria-live":"polite",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),s.jsx("span",{className:"text-gray-600",children:"Loading evidence..."})]})}):y?s.jsx("div",{className:"p-4",role:"alert","aria-live":"assertive",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[s.jsx("span",{role:"img","aria-label":"Error",children:"⚠️"}),s.jsx("span",{className:"font-medium",children:"Failed to load evidence"})]}),s.jsx("p",{className:"text-red-600 text-sm mt-1",children:y}),s.jsx("button",{onClick:I,className:"mt-2 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500",children:"Retry"})]})}):0===R.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",role:"status",children:[s.jsx("div",{className:"text-4xl mb-4",role:"img","aria-label":"Empty folder",children:"\uD83D\uDCC2"}),s.jsx("div",{className:"text-gray-600 mb-2",children:"No evidence files found"}),s.jsx("div",{className:"text-sm text-gray-500",children:"Upload files to link them to this subcategory"})]}):s.jsx("div",{className:"h-96",ref:_,role:"listbox","aria-label":"Evidence files",children:s.jsx(E,{height:384,width:"100%",itemCount:R.length,itemSize:80,itemData:R,children:P})})})]})]})}):null}function $({functions:e,onSubcategorySelect:t,selectedSubcategory:r}){let[a,i]=(0,n.useState)(new Set),o=e=>{i(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})};return s.jsx("div",{className:"space-y-4",children:e.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg",children:[(0,s.jsxs)("button",{onClick:()=>o(e.id),className:"w-full px-4 py-3 text-left bg-gray-50 hover:bg-gray-100 rounded-t-lg font-medium flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:"font-semibold",children:e.id})," - ",e.title]}),s.jsx("span",{className:"text-gray-500",children:a.has(e.id)?"−":"+"})]}),a.has(e.id)&&(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),s.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:e.categories.map(e=>(0,s.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,s.jsxs)("div",{className:"font-medium text-sm mb-2",children:[e.id," - ",e.title]}),s.jsx("p",{className:"text-xs text-gray-600 mb-2",children:e.description}),s.jsx("div",{className:"space-y-1",children:e.subcategories.map(e=>(0,s.jsxs)("button",{onClick:()=>t(e),className:`w-full text-left px-2 py-1 rounded text-xs hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 ${r?.id===e.id?"bg-blue-100 text-blue-700 font-medium":"text-gray-700"}`,"aria-label":`Select subcategory ${e.id}: ${e.title}`,children:[e.id," - ",e.title]},e.id))})]},e.id))})]})]},e.id))})}function R({subcategory:e}){return(0,s.jsxs)("div",{className:"bg-white border rounded-lg p-6 space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"font-semibold text-lg",children:e.id}),s.jsx("h4",{className:"text-gray-600 mb-2",children:e.title}),s.jsx("p",{className:"text-sm text-gray-700",children:e.description})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Assessment Score"}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[s.jsx("div",{children:"Score: Not Assessed"}),s.jsx("div",{className:"text-xs mt-1",children:"Scoring functionality coming soon"})]})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Rationale"}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[s.jsx("div",{children:"No rationale provided"}),s.jsx("div",{className:"text-xs mt-1",children:"Rationale input coming soon"})]})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[s.jsx("h4",{className:"font-medium mb-2",children:"Evidence"}),(0,s.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[s.jsx("div",{children:"No evidence uploaded"}),s.jsx("div",{className:"text-xs mt-1",children:"Evidence tray coming soon"})]})]})]})}function k(){let{engagementId:e}=(0,a.useParams)(),[t,r]=(0,n.useState)([]),[i,o]=(0,n.useState)(!0),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(null),[f,p]=(0,n.useState)(!1),[g]=(0,n.useState)(()=>`csf-${Date.now()}-${Math.random().toString(36).substr(2,9)}`),x=(0,c.QL)(),v=async()=>{try{o(!0),console.log(`[${g}] Loading CSF data for engagement: ${e}`);let t=await l();r(t),console.log(`[${g}] Loaded ${t.length} CSF functions`),t.length}catch(e){console.error(`[${g}] Error loading CSF data:`,e),u(e instanceof Error?e.message:"Failed to load CSF data")}finally{o(!1)}},y=(0,n.useMemo)(()=>t.length?{functions:t.length,categories:t.reduce((e,t)=>e+t.categories.length,0),subcategories:t.reduce((e,t)=>e+t.categories.reduce((e,t)=>e+t.subcategories.length,0),0)}:{functions:0,categories:0,subcategories:0},[t]);return x.isLoading?s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"text-center",children:"Loading..."})}):i?s.jsx("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"animate-pulse space-y-4",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),s.jsx("div",{className:"h-32 bg-gray-200 rounded"}),s.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})}):d?s.jsx("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[s.jsx("h3",{className:"font-medium text-red-800",children:"Error Loading Assessment"}),s.jsx("p",{className:"text-red-600 text-sm mt-1",children:d}),s.jsx("button",{onClick:v,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Retry"})]})}):s.jsx("div",{className:"min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"CSF 2.0 Assessment Grid"}),(0,s.jsxs)("p",{className:"text-gray-600 text-sm mt-1",children:["Engagement: ",e]}),(0,s.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500 mt-2",children:[(0,s.jsxs)("span",{children:[y.functions," Functions"]}),(0,s.jsxs)("span",{children:[y.categories," Categories"]}),(0,s.jsxs)("span",{children:[y.subcategories," Subcategories"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx($,{functions:t,onSubcategorySelect:e=>{console.log(`[${g}] Subcategory selected: ${e.id}`),h(e),p(!0)},selectedSubcategory:m})}),s.jsx("div",{className:"lg:col-span-1",children:m?s.jsx(R,{subcategory:m}):(0,s.jsxs)("div",{className:"bg-white border rounded-lg p-6 text-center text-gray-500",children:[s.jsx("h3",{className:"font-medium mb-2",children:"Select a Subcategory"}),s.jsx("p",{className:"text-sm",children:"Click on any subcategory from the grid to view details and assessment options."})]})})]}),s.jsx(O,{subcategory:m,isOpen:f,onClose:()=>{console.log(`[${g}] Drawer closed`),p(!1)},onScoreChange:e=>{console.log(`[${g}] Score changed: ${e} for ${m?.id}`)},onRationaleChange:e=>{console.log(`[${g}] Rationale changed for ${m?.id}`)},onEvidenceSelect:e=>{console.log(`[${g}] Evidence selected: ${e.filename}`)},correlationId:g})]})})}},6824:(e,t,r)=>{"use strict";r.d(t,{$V:()=>c,SC:()=>i,Sg:()=>l,tQ:()=>o});var s=r(2991);let n=process.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function a(){let e=(0,s.OD)(),t=(0,s.K3)(),r={};return e&&(r["X-User-Email"]=e),t&&(r["X-Engagement-ID"]=t),r}async function i(e,t={}){let r=a(),s=new AbortController,i=setTimeout(()=>s.abort(),t.timeout||3e4);try{let a=await fetch(`${n}${e}`,{...t,signal:s.signal,headers:{...r,...t.headers}});if(clearTimeout(i),!a.ok){let e=await a.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||`Request failed: ${a.status}`)}return a.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,r=setTimeout(()=>t.abort(),3e4);try{let s=await fetch(`${n}/presets/${e}`,{cache:"no-store",signal:t.signal});if(clearTimeout(r),!s.ok)throw Error(`Preset ${e} not found`);return s.json()}catch(t){if(clearTimeout(r),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let l=n;function c(e=!1){let t=a();return e||(t["Content-Type"]="application/json"),t}},2991:(e,t,r)=>{"use strict";function s(){return""}function n(){return""}function a(e){}function i(){return(process.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes("")}r.d(t,{GJ:()=>i,K3:()=>n,OD:()=>s,d8:()=>a})},23820:(e,t,r)=>{"use strict";r.d(t,{$r:()=>c,EK:()=>l,Hi:()=>m,Hj:()=>i,LB:()=>g,LP:()=>y,LT:()=>d,W2:()=>x,Zg:()=>n,fG:()=>p,fj:()=>u,kR:()=>o,q8:()=>h,sS:()=>v,tc:()=>f,te:()=>a});var s=r(6824);async function n(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||`Search failed: ${t.status}`);return t.json()}async function a(e){let t=await fetch(`/api/proxy/engagements/${e}/docs/ingestion-status`);if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||`Request failed: ${t.status}`);return t.json()}async function i(e,t){let r=await fetch(`/api/proxy/engagements/${e}/docs/${t}/ingest`,{method:"POST"});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Ingestion failed"}))).detail||`Request failed: ${r.status}`);return r.json()}async function o(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||`Request failed: ${t.status}`);return t.json()}async function l(e){let[t,r]=await Promise.all([(0,s.SC)(`/engagements/${e}/docs`),a(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:r.find(t=>t.document_id===e.id)}))}async function c(e,t,r=!1){let s=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:r})});if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Analysis failed"}))).detail||`Request failed: ${s.status}`);return s.json()}async function d(e){let t=await fetch(`/api/proxy/analysis/${e}/citations`);if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||`Request failed: ${t.status}`);return t.json()}async function u(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||`SAS generation failed: ${t.status}`);return t.json()}async function m(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||`Upload completion failed: ${t.status}`);return t.json()}async function h(e,t=1,r=50){let s=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:r.toString()}),n=await fetch(`/api/proxy/evidence?${s}`);if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Failed to list evidence"}))).detail||`Failed to list evidence: ${n.status}`);let a=await n.json(),i=parseInt(n.headers.get("X-Total-Count")||"0"),o=parseInt(n.headers.get("X-Page")||"1"),l=parseInt(n.headers.get("X-Page-Size")||"50");return{data:a,total:i,page:o,page_size:l,total_pages:parseInt(n.headers.get("X-Total-Pages")||"1"),has_next:"true"===n.headers.get("X-Has-Next"),has_previous:"true"===n.headers.get("X-Has-Previous")}}async function f(e,t){let r=await fetch(`/api/proxy/evidence/${e}/links`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Evidence linking failed"}))).detail||`Evidence linking failed: ${r.status}`);return r.json()}async function p(e,t){let r=await fetch(`/api/proxy/evidence/${e}/links/${t}`,{method:"DELETE"});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||`Evidence unlinking failed: ${r.status}`);return r.json()}async function g(e,t){let r=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!r.ok)throw Error(`Azure upload failed: ${r.statusText}`)}async function x(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function v(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function y(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}},8365:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`/Users/svvval/Documents/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/assessment/page.tsx#default`)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,878,34],()=>r(34806));module.exports=s})();