(()=>{var e={};e.id=616,e.ids=[616],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1462:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>c}),t(296),t(6698),t(5866);var a=t(3191),n=t(8716),r=t(7922),i=t.n(r),d=t(5231),l={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);t.d(s,l);let c=["",{children:["e",{children:["[engagementId]",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,296)),"/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/dashboard/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,6698)),"/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/dashboard/page.tsx"],m="/e/[engagementId]/dashboard/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/e/[engagementId]/dashboard/page",pathname:"/e/[engagementId]/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},4853:(e,s,t)=>{Promise.resolve().then(t.bind(t,9189))},9189:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>g});var a=t(326),n=t(7577),r=t(5047),i=t(434),d=t(6824),l=t(3820),c=t(3488),o=t(2991);function m(){let{engagementId:e}=(0,r.useParams)(),[s,t]=(0,n.useState)([]),[i,d]=(0,n.useState)(!0),[m,u]=(0,n.useState)(null),[x,p]=(0,n.useState)(!1),[g,h]=(0,n.useState)(!1),[b,y]=(0,n.useState)({});async function f(){if(e)try{d(!0);let s=await (0,l.EK)(e);t(s);let a={};s.forEach(e=>{e.ingestion_status&&(a[e.id]=e.ingestion_status)}),y(a),u(null)}catch(e){u(e instanceof Error?e.message:"Failed to load documents")}finally{d(!1)}}async function v(s){let t=s.target.files;if(t&&e)try{p(!0),await (0,c.$6)(e,Array.from(t)),await f(),s.target.value=""}catch(e){u(e instanceof Error?e.message:"Upload failed")}finally{p(!1)}}async function j(s){if(e)try{await (0,l.Hj)(e,s),y(e=>({...e,[s]:{document_id:s,status:"processing"}}))}catch(e){u(e instanceof Error?e.message:"Ingestion failed")}}async function N(){if(e)try{h(!0);let t=await (0,l.kR)({engagement_id:e}),a={};s.forEach(e=>{a[e.id]={document_id:e.id,status:"processing"}}),y(a),u(null),u(`✓ ${t.message}`),setTimeout(()=>u(m),3e3)}catch(e){u(e instanceof Error?e.message:"Bulk reindex failed")}finally{h(!1)}}async function w(s){if(e)try{await (0,c.oe)(e,s),await f()}catch(e){u(e instanceof Error?e.message:"Delete failed")}}return i?(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-2",children:"Documents"}),a.jsx("div",{className:"text-sm text-gray-500",children:"Loading documents..."})]}):(0,a.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"font-medium",children:"Documents & Evidence"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,o.GJ)()&&a.jsx("button",{onClick:N,disabled:g||0===s.length,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Reindexing...":"Reindex All"}),(0,a.jsxs)("label",{className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 cursor-pointer",children:[x?"Uploading...":"Upload Files",a.jsx("input",{type:"file",multiple:!0,onChange:v,disabled:x,className:"hidden",accept:".pdf,.docx,.xlsx,.csv,.md,.txt,.png,.jpg,.jpeg"})]})]})]}),m&&a.jsx("div",{className:`text-sm px-3 py-2 rounded ${m.startsWith("✓")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:m}),0===s.length?a.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:"No documents uploaded yet."}):a.jsx("div",{className:"space-y-2",children:s.map(s=>{let t=b[s.id]||s.ingestion_status;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-lg",children:function(e){if(!e)return"⚪";switch(e.status){case"completed":return"✅";case"processing":return"\uD83D\uDD04";case"pending":return"⏳";case"failed":return"❌";default:return"⚪"}}(t)}),a.jsx("span",{className:"font-medium text-sm truncate",children:s.filename})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,a.jsxs)("div",{children:["Size: ",(s.size/1024).toFixed(1)," KB • Uploaded: ",new Date(s.uploaded_at).toLocaleDateString()]}),(0,a.jsxs)("div",{children:["Status: ",function(e){if(!e)return"Not indexed";switch(e.status){case"completed":return`Indexed (${e.chunks_created||0} chunks)`;case"processing":return"Processing...";case"pending":return"Pending";case"failed":return`Failed: ${e.error_message||"Unknown error"}`;default:return"Unknown"}}(t)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(!t||"failed"===t.status)&&a.jsx("button",{onClick:()=>j(s.id),className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:"Ingest"}),a.jsx("a",{href:(0,c.GR)(e,s.id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-gray-50 text-gray-700 rounded hover:bg-gray-100",children:"Download"}),a.jsx("button",{onClick:()=>w(s.id),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100",children:"Delete"})]})]},s.id)})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[s.length," document",1!==s.length?"s":""," •",Object.values(b).filter(e=>"completed"===e.status).length," indexed for evidence search"]})]})}function u({className:e="",onResultSelect:s,maxResults:t=10}){let{engagementId:i}=(0,r.useParams)(),[d,o]=(0,n.useState)(""),[m,u]=(0,n.useState)([]),[x,p]=(0,n.useState)(!1),[g,h]=(0,n.useState)(null),[b,y]=(0,n.useState)(null);async function f(e){if(e.preventDefault(),d.trim()&&i)try{p(!0),h(null);let e=await (0,l.Zg)({query:d.trim(),top_k:t,score_threshold:.1,engagement_id:i});u(e.results),y(e)}catch(e){h(e instanceof Error?e.message:"Search failed"),u([]),y(null)}finally{p(!1)}}async function v(){if(!m.length)return;let e=new Blob([JSON.stringify({query:d,timestamp:new Date().toISOString(),engagement_id:i,results:m.map(e=>({content:e.content,score:e.score,document_name:e.document_name,page_number:e.page_number}))},null,2)],{type:"application/json"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=`evidence-search-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}return(0,a.jsxs)("div",{className:`space-y-4 ${e}`,children:[(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-3",children:"Evidence Search"}),(0,a.jsxs)("form",{onSubmit:f,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"Search for evidence in uploaded documents...",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:x}),a.jsx("button",{type:"submit",disabled:x||!d.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Searching...":"Search"})]}),b&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["Found ",b.total_results," results in ",b.processing_time_ms,"ms"]}),m.length>0&&a.jsx("button",{type:"button",onClick:v,className:"text-blue-600 hover:text-blue-700",children:"Export Results"})]})]}),g&&a.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:g})]}),m.length>0&&a.jsx("div",{className:"space-y-3",children:m.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{s&&s(e)},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,a.jsxs)("span",{children:["Score: ",(100*e.score).toFixed(1),"%"]}),e.page_number&&(0,a.jsxs)("span",{children:["• Page ",e.page_number]}),(0,a.jsxs)("span",{children:["• Chunk ",e.chunk_index+1]})]})]}),a.jsx("div",{className:"flex gap-1",children:a.jsx("a",{href:(0,c.GR)(i,e.document_id),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"View"})})]}),a.jsx("div",{className:"text-sm text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:function(e,s){if(!s.trim())return e;let t=s.toLowerCase().split(/\s+/),a=e;return t.forEach(e=>{if(e.length>2){let s=RegExp(`(${e})`,"gi");a=a.replace(s,'<mark class="bg-yellow-200">$1</mark>')}}),a}(e.content,d)}})]},t))}),d&&!x&&0===m.length&&b&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsxs)("div",{className:"text-sm",children:['No evidence found for "',d,'"']}),a.jsx("div",{className:"text-xs mt-1",children:"Try different keywords or check if documents are indexed"})]})]})}function x({initialContent:e="",onAnalysisComplete:s,className:t=""}){let{engagementId:i}=(0,r.useParams)(),[d,c]=(0,n.useState)(e),[o,m]=(0,n.useState)(!1),[u,x]=(0,n.useState)(!1),[p,g]=(0,n.useState)(null),[h,b]=(0,n.useState)([]),[y,f]=(0,n.useState)(null);async function v(){if(d.trim()&&i)try{x(!0),f(null),g(null),b([]);let e=await (0,l.$r)(i,d.trim(),o);if(g(e),o&&e.id)try{let s=await (0,l.LT)(e.id);b(s)}catch(e){console.warn("Failed to load citations:",e)}s&&s(e)}catch(e){f(e instanceof Error?e.message:"Analysis failed")}finally{x(!1)}}return(0,a.jsxs)("div",{className:`space-y-4 ${t}`,children:[(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-3",children:"AI Analysis"}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("textarea",{value:d,onChange:e=>c(e.target.value),placeholder:"Enter content to analyze...",className:"w-full h-32 px-3 py-2 border rounded-md text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:u}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:o,onChange:e=>m(e.target.checked),disabled:u,className:"rounded"}),a.jsx("span",{children:"Use Evidence from Documents"}),a.jsx("span",{className:"text-xs text-gray-500",children:"(Uses RAG to find relevant evidence)"})]}),a.jsx("button",{onClick:v,disabled:u||!d.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Analyzing...":"Analyze"})]})]}),y&&a.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:y})]}),p&&(0,a.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"font-medium",children:"Analysis Result"}),p.evidence_used&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-green-700 bg-green-50 px-2 py-1 rounded",children:[a.jsx("span",{children:"\uD83D\uDCDA"}),a.jsx("span",{children:"Evidence Used"})]})]}),a.jsx("div",{className:"prose prose-sm max-w-none",children:a.jsx("div",{className:"whitespace-pre-wrap text-gray-700",children:"string"==typeof p?p:p.content?p.content:p.analysis?p.analysis:JSON.stringify(p,null,2)})}),h.length>0&&(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("div",{className:"font-medium text-sm",children:"Supporting Evidence"}),a.jsx("div",{className:"space-y-2",children:h.map((e,s)=>(0,a.jsxs)("div",{className:"bg-gray-50 border rounded-lg p-3",children:[a.jsx("div",{className:"flex items-start justify-between gap-3 mb-2",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,a.jsxs)("span",{children:["Relevance: ",(100*e.relevance_score).toFixed(1),"%"]}),e.page_number&&(0,a.jsxs)("span",{children:["• Page ",e.page_number]}),(0,a.jsxs)("span",{children:["• Section ",e.chunk_index+1]})]})]})}),(0,a.jsxs)("div",{className:"text-sm text-gray-700 italic border-l-2 border-blue-200 pl-3",children:['"',e.excerpt,'"']})]},s))})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:["Analysis completed at ",new Date().toLocaleString(),p.evidence_used&&h.length>0&&` • ${h.length} evidence source${1!==h.length?"s":""} cited`]})]})]})}var p=t(9682);function g(){let{engagementId:e}=(0,r.useParams)();(0,r.useRouter)();let[s,t]=(0,n.useState)(null),[l,c]=(0,n.useState)(""),[o,g]=(0,n.useState)("overview");return(0,p.QL)().isLoading?a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"text-center",children:"Loading..."})}):e?(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-semibold",children:"Engagement Dashboard"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("a",{className:"px-3 py-1 border rounded",href:`${d.Sg}/engagements/${e}/exports/report.md`,target:"_blank",children:"Export Markdown"}),a.jsx(i.default,{className:"px-3 py-1 border rounded",href:`/e/${e}/demo`,children:"Open Demo"}),a.jsx(i.default,{className:"px-3 py-1 border rounded",href:`/e/${e}/demo#docs`,children:"Docs"})]})]}),l&&a.jsx("div",{className:"text-red-600 text-sm",children:l}),a.jsx("div",{className:"border-b border-gray-200",children:a.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",label:"Overview"},{id:"documents",label:"Documents"},{id:"evidence",label:"Evidence Search"},{id:"analysis",label:"AI Analysis"}].map(e=>a.jsx("button",{onClick:()=>g(e.id),className:`py-2 px-1 border-b-2 font-medium text-sm ${o===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.label},e.id))})}),"overview"===o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[a.jsx(h,{title:"Assessments",value:s?.counts.assessments??0}),a.jsx(h,{title:"Documents",value:s?.counts.documents??0}),a.jsx(h,{title:"Findings",value:s?.counts.findings??0}),a.jsx(h,{title:"Recommendations",value:s?.counts.recommendations??0}),a.jsx(h,{title:"Run Logs",value:s?.counts.runlogs??0})]}),(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-2",children:"Recent Activity"}),!s?.recent_activity?.length&&a.jsx("div",{className:"text-sm text-gray-500",children:"No activity yet."}),a.jsx("ul",{className:"divide-y",children:s?.recent_activity?.map((e,s)=>a.jsxs("li",{className:"py-2 text-sm flex items-center justify-between gap-3",children:[a.jsxs("div",{className:"truncate",children:[a.jsx("span",{className:"inline-block min-w-28 text-gray-500",children:e.type}),a.jsx("span",{className:"font-medium",children:e.title||e.id})]}),a.jsx("div",{className:"text-gray-500",children:e.ts?new Date(e.ts).toLocaleString():""})]},s))})]}),s?.recent_runlog_excerpt&&(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"font-medium mb-2",children:"Recent Run Log"}),a.jsx("pre",{className:"text-sm whitespace-pre-wrap",children:s.recent_runlog_excerpt})]})]}),"documents"===o&&a.jsx(m,{}),"evidence"===o&&a.jsx(u,{className:"max-w-4xl",maxResults:20}),"analysis"===o&&a.jsx(x,{className:"max-w-4xl"})]}):a.jsx("div",{className:"p-6",children:"No engagement selected."})}function h({title:e,value:s}){return(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[a.jsx("div",{className:"text-sm text-gray-500",children:e}),a.jsx("div",{className:"text-2xl font-semibold",children:s})]})}},3488:(e,s,t)=>{"use strict";t.d(s,{$6:()=>r,CZ:()=>n,GR:()=>i,Xj:()=>l,oe:()=>d});var a=t(6824);async function n(e){let s=await fetch(`${a.Sg}/engagements/${e}/docs`,{headers:(0,a.$V)()});if(!s.ok)throw Error(`listDocs ${s.status}`);return s.json()}async function r(e,s){let t=new FormData;s.forEach(e=>t.append("files",e));let n={method:"POST",headers:(0,a.$V)(!0),body:t},r=await fetch(`${a.Sg}/engagements/${e}/docs`,n);if(!r.ok){let e=`uploadDocs failed with status ${r.status}`;try{let s=await r.text();s&&(e+=`: ${s}`)}catch(s){e+=" (unable to read error details)"}throw Error(e)}return r.json()}function i(e,s){return`${a.Sg}/engagements/${e}/docs/${s}`}async function d(e,s){let t=await fetch(`${a.Sg}/engagements/${e}/docs/${s}`,{method:"DELETE",headers:(0,a.$V)()});if(!t.ok)throw Error(`deleteDoc ${t.status}`);return t.json()}async function l(e,s){let t=await fetch(`${a.Sg}/orchestrations/analyze-doc`,{method:"POST",headers:(0,a.$V)(),body:JSON.stringify({doc_id:s})});if(!t.ok)throw Error(`analyzeDoc ${t.status}`);return t.json()}},296:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>r,default:()=>d});var a=t(8570);let n=(0,a.createProxy)(String.raw`/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/dashboard/page.tsx`),{__esModule:r,$$typeof:i}=n;n.default;let d=(0,a.createProxy)(String.raw`/Users/valsysoiev/AI-Enable-Cyber-Maturity-Assessment-2/web/app/e/[engagementId]/dashboard/page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[948,878,206],()=>t(1462));module.exports=a})();