"use strict";exports.id=284,exports.ids=[284],exports.modules={41046:(e,t,s)=>{s.d(t,{Z:()=>u});var n=s(10326),a=s(17577),r=s(35047),l=s(23820);function i({enabled:e,onToggle:t,disabled:s=!1,className:r="",showStatus:l=!0,size:i="md"}){let[d,c]=(0,a.useState)(null),[o,u]=(0,a.useState)(!0);function x(){if(!d)return"Unknown";switch(d.status){case"healthy":return"Healthy";case"degraded":return"Degraded";case"offline":return"Offline";default:return"Unknown"}}let m=function(){switch(i){case"sm":return{container:"text-sm",toggle:"w-9 h-5",thumb:"w-4 h-4",thumbTranslate:"translate-x-4",label:"text-xs",status:"text-xs"};case"lg":return{container:"text-lg",toggle:"w-14 h-8",thumb:"w-7 h-7",thumbTranslate:"translate-x-6",label:"text-base",status:"text-sm"};default:return{container:"text-base",toggle:"w-11 h-6",thumb:"w-5 h-5",thumbTranslate:"translate-x-5",label:"text-sm",status:"text-xs"}}}(),g=d?.enabled&&d?.mode!=="none",h=s||o||!g;return o?(0,n.jsxs)("div",{className:`flex items-center gap-2 ${m.container} ${r}`,children:[n.jsx("div",{className:"animate-pulse",children:n.jsx("div",{className:`${m.toggle} bg-gray-200 rounded-full`})}),n.jsx("span",{className:"text-gray-500",children:"Loading RAG status..."})]}):(0,n.jsxs)("div",{className:`flex items-center gap-2 ${m.container} ${r}`,children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[n.jsx("button",{type:"button",onClick:()=>!h&&t(!e),disabled:h,className:`
            relative inline-flex ${m.toggle} rounded-full border-2 border-transparent 
            transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 
            focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed
            ${e&&g?"bg-blue-600":"bg-gray-200"}
          `,role:"switch","aria-checked":e&&g,"aria-label":"Toggle Grounded Analysis (RAG)",children:n.jsx("span",{className:`
              ${m.thumb} inline-block transform rounded-full bg-white shadow-lg 
              ring-0 transition duration-200 ease-in-out
              ${e&&g?m.thumbTranslate:"translate-x-0"}
            `})}),(0,n.jsxs)("div",{className:"flex flex-col",children:[n.jsx("label",{className:`${m.label} font-medium text-gray-900 cursor-pointer`,onClick:()=>!h&&t(!e),children:"Grounded Analysis (RAG)"}),l&&(0,n.jsxs)("div",{className:`${m.status} text-gray-500 flex items-center gap-1`,children:[n.jsx("span",{children:function(){if(!d)return"❓";switch(d.status){case"healthy":return"\uD83D\uDFE2";case"degraded":return"\uD83D\uDFE1";case"offline":return"\uD83D\uDD34";default:return"❓"}}()}),n.jsx("span",{children:x()}),d?.mode&&"none"!==d.mode&&(0,n.jsxs)("span",{className:"text-blue-600",children:["• ",d.mode]})]})]})]}),!g&&(0,n.jsxs)("div",{className:"flex items-center gap-1 text-amber-600 bg-amber-50 px-2 py-1 rounded text-xs",children:[n.jsx("span",{children:"⚠️"}),n.jsx("span",{children:"RAG Unavailable"})]}),e&&d&&(0,n.jsxs)("div",{className:"relative group",children:[n.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-600 text-xs",title:"RAG Configuration Details",children:"ℹ️"}),n.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 hidden group-hover:block z-10",children:(0,n.jsxs)("div",{className:"bg-gray-900 text-white text-xs rounded py-2 px-3 whitespace-nowrap",children:[(0,n.jsxs)("div",{children:["Mode: ",d.mode]}),(0,n.jsxs)("div",{children:["Status: ",x()]}),d.model&&(0,n.jsxs)("div",{children:["Model: ",d.model]}),d.last_check&&(0,n.jsxs)("div",{children:["Last Check: ",new Date(d.last_check).toLocaleTimeString()]}),n.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})})]})]})}var d=s(13488);function c({citation:e,engagementId:t,index:s,showScore:r=!0,isExpanded:l=!1,onToggleExpand:i}){var c,o;let[u,x]=(0,a.useState)(!1);async function m(){let s=(0,d.GR)(t,e.document_id);try{await navigator.clipboard.writeText(s)}catch(e){console.warn("Failed to copy link:",e)}}return n.jsx("div",{className:`border rounded-lg transition-all duration-200 ${l?"ring-2 ring-blue-200 bg-blue-50/30":"bg-gray-50 hover:bg-gray-100"}`,children:(0,n.jsxs)("div",{className:"p-3",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[n.jsx("div",{className:"flex-1 min-w-0",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"text-lg",children:function(e){switch(e.split(".").pop()?.toLowerCase()){case"pdf":return"\uD83D\uDCC4";case"doc":case"docx":return"\uD83D\uDCDD";case"txt":return"\uD83D\uDCC3";case"jpg":case"jpeg":case"png":case"gif":return"\uD83D\uDDBC️";default:return"\uD83D\uDCCE"}}(e.document_name)}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 flex items-center gap-2",children:[r&&(0,n.jsxs)("span",{className:`px-2 py-0.5 rounded text-xs font-medium border ${(c=e.relevance_score)>=.8?"text-green-600 bg-green-50 border-green-200":c>=.6?"text-blue-600 bg-blue-50 border-blue-200":c>=.4?"text-yellow-600 bg-yellow-50 border-yellow-200":"text-gray-600 bg-gray-50 border-gray-200"}`,children:[(o=e.relevance_score,`${(100*o).toFixed(1)}%`)," relevant"]}),e.page_number&&(0,n.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCD6 Page ",e.page_number]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDCCD Section ",e.chunk_index+1]}),(0,n.jsxs)("span",{className:"text-blue-600",children:["#",s+1]})]})]})]})}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[n.jsx("a",{href:(0,d.GR)(t,e.document_id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:"Open document",children:"\uD83D\uDCC4 View"}),n.jsx("button",{onClick:m,className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:"Copy document link",children:"\uD83D\uDD17 Copy"}),i&&n.jsx("button",{onClick:i,className:"px-2 py-1 text-xs bg-white border border-gray-300 text-gray-700 rounded hover:bg-gray-50 transition-colors",title:l?"Collapse details":"Expand details",children:l?"▲":"▼"})]})]}),n.jsx("div",{className:"relative",children:n.jsx("div",{className:"text-sm text-gray-700 italic border-l-3 border-blue-200 pl-3",children:(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-blue-400 text-lg leading-none",children:'"'}),n.jsx("span",{className:"flex-1",children:e.excerpt}),n.jsx("span",{className:"text-blue-400 text-lg leading-none",children:'"'})]})})}),l&&(0,n.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-3",children:[e.metadata&&Object.keys(e.metadata).length>0&&(0,n.jsxs)("div",{children:[n.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Document Metadata"}),n.jsx("div",{className:"text-xs space-y-1",children:Object.entries(e.metadata).map(([e,t])=>(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsxs)("span",{className:"w-20 text-gray-500 capitalize",children:[e,":"]}),n.jsx("span",{className:"text-gray-700 flex-1",children:String(t)})]},e))})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[n.jsx("div",{children:"• This excerpt was automatically extracted and ranked for relevance"}),n.jsx("div",{children:"• Citation accuracy depends on document quality and content structure"}),e.url&&(0,n.jsxs)("div",{children:["• Source URL: ",n.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:e.url})]})]})]})]})})}function o({citations:e,engagementId:t,className:s="",maxVisible:r=5,showScore:l=!0,allowExpansion:i=!0}){let[o,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(new Set),g=o?e:e.slice(0,r),h=e.length>r;async function p(){let s=new Blob([JSON.stringify({timestamp:new Date().toISOString(),engagement_id:t,total_citations:e.length,citations:e.map((e,s)=>({citation_number:s+1,document_name:e.document_name,relevance_score:e.relevance_score,page_number:e.page_number,section:e.chunk_index+1,excerpt:e.excerpt,document_url:(0,d.GR)(t,e.document_id),metadata:e.metadata}))},null,2)],{type:"application/json"}),n=URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=`citations-${t}-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}return 0===e.length?null:(0,n.jsxs)("div",{className:`space-y-3 ${s}`,children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"font-medium text-sm text-gray-900",children:"Supporting Evidence"}),(0,n.jsxs)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:[e.length," source",1!==e.length?"s":""]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[e.length>0&&n.jsx("button",{onClick:p,className:"text-xs text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-2 py-1 rounded transition-colors",children:"\uD83D\uDCCA Export"}),i&&x.size>0&&n.jsx("button",{onClick:()=>m(new Set),className:"text-xs text-gray-600 hover:text-gray-700",children:"Collapse All"})]})]}),n.jsx("div",{className:"space-y-2",children:g.map((e,s)=>n.jsx(c,{citation:e,engagementId:t,index:s,showScore:l,isExpanded:i&&x.has(s),onToggleExpand:i?()=>(function(e){let t=new Set(x);t.has(e)?t.delete(e):t.add(e),m(t)})(s):void 0},`${e.document_id}-${e.chunk_index}`))}),h&&n.jsx("div",{className:"text-center",children:n.jsx("button",{onClick:()=>u(!o),className:"text-sm text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-3 py-1 rounded transition-colors",children:o?(0,n.jsxs)(n.Fragment,{children:["Show Less (",r," of ",e.length,")"]}):(0,n.jsxs)(n.Fragment,{children:["Show All Citations (",e.length,")"]})})}),n.jsx("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-100",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("span",{children:["Average relevance: ",(e.reduce((e,t)=>e+t.relevance_score,0)/e.length*100).toFixed(1),"%"]}),(0,n.jsxs)("span",{children:["Quality: ",e.filter(e=>e.relevance_score>=.7).length,"/",e.length," high-confidence"]})]})})]})}function u({initialContent:e="",onAnalysisComplete:t,className:s=""}){let{engagementId:d}=(0,r.useParams)(),[c,u]=(0,a.useState)(e),[x,m]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)(!1),[f,y]=(0,a.useState)(null),[j,v]=(0,a.useState)([]),[N,w]=(0,a.useState)(null),{isAvailable:_}=function(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(!0);return{isAvailable:e?.enabled&&e?.mode!=="none",config:e,loading:s,status:e?.status||"offline"}}();async function D(){if(c.trim()&&d)try{let e;if(b(!0),w(null),y(null),v([]),g&&_){let t=await fetch("/api/proxy/orchestrations/rag-analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:d,content:c.trim(),use_evidence:x,use_rag:!0,analysis_type:"analyze"})});if(!t.ok)throw Error(`RAG analysis failed: ${t.status}`);e=await t.json()}else e=await (0,l.$r)(d,c.trim(),x);if(y(e),e.citations&&e.citations.length>0)v(e.citations);else if((x||g)&&e.id)try{let t=await (0,l.LT)(e.id);v(t)}catch(e){console.warn("Failed to load citations:",e)}t&&t(e)}catch(e){w(e instanceof Error?e.message:"Analysis failed")}finally{b(!1)}}function S(e){return"string"==typeof e?e:e.content?e.content:e.analysis?e.analysis:JSON.stringify(e,null,2)}async function k(){if(!f)return;let e=new Blob([JSON.stringify({timestamp:new Date().toISOString(),engagement_id:d,analysis_mode:{use_evidence:x,use_rag:g,rag_available:_},input_content:c,analysis_result:{content:S(f),confidence_score:f.confidence_score,evidence_used:f.evidence_used,rag_grounding:f.rag_grounding,grounded_insights:f.grounded_insights,processing_time_ms:f.processing_time_ms},citations:j.map((e,t)=>({citation_number:t+1,document_name:e.document_name,relevance_score:e.relevance_score,page_number:e.page_number,section:e.chunk_index+1,excerpt:e.excerpt}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`analysis-${g?"rag-":""}${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}return(0,n.jsxs)("div",{className:`space-y-4 ${s}`,children:[(0,n.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"font-medium",children:g&&_?"\uD83E\uDD16 RAG-Enhanced Analysis":x?"\uD83D\uDCDA Evidence-Based Analysis":"\uD83D\uDD0D Standard Analysis"}),n.jsx("div",{className:"flex items-center gap-2",children:f&&n.jsx("button",{onClick:k,className:"text-xs text-blue-600 hover:text-blue-700 border border-blue-200 hover:border-blue-300 px-2 py-1 rounded",children:"\uD83D\uDCCA Export"})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[n.jsx("textarea",{value:c,onChange:e=>u(e.target.value),placeholder:g&&_?"Ask a question or describe what you want to analyze...":"Enter content to analyze...",className:"w-full h-32 px-3 py-2 border rounded-md text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:p}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[n.jsx("input",{type:"checkbox",checked:x,onChange:e=>m(e.target.checked),disabled:p,className:"rounded"}),n.jsx("span",{children:"Use Evidence from Documents"}),n.jsx("span",{className:"text-xs text-gray-500",children:"(Search uploaded documents for relevant content)"})]}),n.jsx(i,{enabled:g,onToggle:h,disabled:p,size:"sm",className:"ml-6"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx("button",{onClick:D,disabled:p||!c.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed min-w-[120px]",children:p?"Analyzing...":g&&_?"Analyze with AI":"Analyze"})})]})]}),N&&n.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:N})]}),f&&(0,n.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"font-medium",children:"Analysis Result"}),f.confidence_score&&(0,n.jsxs)("span",{className:`text-xs px-2 py-0.5 rounded ${f.confidence_score>=.8?"bg-green-100 text-green-800":f.confidence_score>=.6?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[(100*f.confidence_score).toFixed(0),"% confidence"]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[f.evidence_used&&(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs text-green-700 bg-green-50 px-2 py-1 rounded",children:[n.jsx("span",{children:"\uD83D\uDCDA"}),n.jsx("span",{children:"Evidence Used"})]}),f.use_rag&&_&&(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-700 bg-blue-50 px-2 py-1 rounded",children:[n.jsx("span",{children:"\uD83E\uDD16"}),n.jsx("span",{children:"RAG Enhanced"})]})]})]}),f.rag_grounding&&(0,n.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[n.jsx("div",{className:"font-medium text-sm text-blue-900 mb-2",children:"\uD83E\uDD16 AI Grounding Summary"}),n.jsx("div",{className:"text-sm text-blue-800",children:f.rag_grounding})]}),n.jsx("div",{className:"prose prose-sm max-w-none",children:n.jsx("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",children:S(f)})}),f.grounded_insights&&f.grounded_insights.length>0&&(0,n.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[n.jsx("div",{className:"font-medium text-sm text-green-900 mb-2",children:"\uD83D\uDCA1 Key Insights from Evidence"}),n.jsx("ul",{className:"text-sm text-green-800 space-y-1",children:f.grounded_insights.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-green-600 mt-0.5",children:"•"}),n.jsx("span",{children:e})]},t))})]}),j.length>0&&n.jsx(o,{citations:j,engagementId:d,showScore:!0,allowExpansion:!0}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t space-y-1",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsxs)("span",{children:["Analysis completed at ",new Date().toLocaleString()]}),f.processing_time_ms&&(0,n.jsxs)("span",{children:["Processing time: ",f.processing_time_ms,"ms"]})]}),(f.evidence_used||f.use_rag)&&(0,n.jsxs)("div",{className:"flex justify-between",children:[j.length>0&&(0,n.jsxs)("span",{children:["Evidence sources: ",j.length]}),f.evidence_quality_score&&(0,n.jsxs)("span",{children:["Evidence quality: ",(100*f.evidence_quality_score).toFixed(1),"%"]})]}),f.recommendations_count&&(0,n.jsxs)("div",{children:["Recommendations generated: ",f.recommendations_count]})]})]})]})}},31827:(e,t,s)=>{s.d(t,{Z:()=>c});var n=s(10326),a=s(17577),r=s(35047),l=s(23820),i=s(13488),d=s(2991);function c(){let{engagementId:e}=(0,r.useParams)(),[t,s]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),[u,x]=(0,a.useState)(null),[m,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(!1),[b,f]=(0,a.useState)({});async function y(){if(e)try{o(!0);let t=await (0,l.EK)(e);s(t);let n={};t.forEach(e=>{e.ingestion_status&&(n[e.id]=e.ingestion_status)}),f(n),x(null)}catch(e){x(e instanceof Error?e.message:"Failed to load documents")}finally{o(!1)}}async function j(t){let s=t.target.files;if(s&&e)try{g(!0),await (0,i.$6)(e,Array.from(s)),await y(),t.target.value=""}catch(e){x(e instanceof Error?e.message:"Upload failed")}finally{g(!1)}}async function v(t){if(e)try{await (0,l.Hj)(e,t),f(e=>({...e,[t]:{document_id:t,status:"processing"}}))}catch(e){x(e instanceof Error?e.message:"Ingestion failed")}}async function N(){if(e)try{p(!0);let s=await (0,l.kR)({engagement_id:e}),n={};t.forEach(e=>{n[e.id]={document_id:e.id,status:"processing"}}),f(n),x(null),x(`✓ ${s.message}`),setTimeout(()=>x(u),3e3)}catch(e){x(e instanceof Error?e.message:"Bulk reindex failed")}finally{p(!1)}}async function w(t){if(e)try{await (0,i.oe)(e,t),await y()}catch(e){x(e instanceof Error?e.message:"Delete failed")}}return c?(0,n.jsxs)("div",{className:"rounded-xl border p-4",children:[n.jsx("div",{className:"font-medium mb-2",children:"Documents"}),n.jsx("div",{className:"text-sm text-gray-500",children:"Loading documents..."})]}):(0,n.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"font-medium",children:"Documents & Evidence"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,d.GJ)()&&n.jsx("button",{onClick:N,disabled:h||0===t.length,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Reindexing...":"Reindex All"}),(0,n.jsxs)("label",{className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 cursor-pointer",children:[m?"Uploading...":"Upload Files",n.jsx("input",{type:"file",multiple:!0,onChange:j,disabled:m,className:"hidden",accept:".pdf,.docx,.xlsx,.csv,.md,.txt,.png,.jpg,.jpeg"})]})]})]}),u&&n.jsx("div",{className:`text-sm px-3 py-2 rounded ${u.startsWith("✓")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:u}),0===t.length?n.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:"No documents uploaded yet."}):n.jsx("div",{className:"space-y-2",children:t.map(t=>{let s=b[t.id]||t.ingestion_status;return(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("span",{className:"text-lg",children:function(e){if(!e)return"⚪";switch(e.status){case"completed":return"✅";case"processing":return"\uD83D\uDD04";case"pending":return"⏳";case"failed":return"❌";default:return"⚪"}}(s)}),n.jsx("span",{className:"font-medium text-sm truncate",children:t.filename})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,n.jsxs)("div",{children:["Size: ",(t.size/1024).toFixed(1)," KB • Uploaded: ",new Date(t.uploaded_at).toLocaleDateString()]}),(0,n.jsxs)("div",{children:["Status: ",function(e){if(!e)return"Not indexed";switch(e.status){case"completed":return`Indexed (${e.chunks_created||0} chunks)`;case"processing":return"Processing...";case"pending":return"Pending";case"failed":return`Failed: ${e.error_message||"Unknown error"}`;default:return"Unknown"}}(s)]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(!s||"failed"===s.status)&&n.jsx("button",{onClick:()=>v(t.id),className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:"Ingest"}),n.jsx("a",{href:(0,i.GR)(e,t.id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-gray-50 text-gray-700 rounded hover:bg-gray-100",children:"Download"}),n.jsx("button",{onClick:()=>w(t.id),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100",children:"Delete"})]})]},t.id)})}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[t.length," document",1!==t.length?"s":""," •",Object.values(b).filter(e=>"completed"===e.status).length," indexed for evidence search"]})]})}},34783:(e,t,s)=>{s.d(t,{Z:()=>d});var n=s(10326),a=s(17577),r=s(35047),l=s(23820),i=s(13488);function d({className:e="",onResultSelect:t,maxResults:s=10}){let{engagementId:d}=(0,r.useParams)(),[c,o]=(0,a.useState)(""),[u,x]=(0,a.useState)([]),[m,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[b,f]=(0,a.useState)(null);async function y(e){if(e.preventDefault(),c.trim()&&d)try{g(!0),p(null);let e=await (0,l.Zg)({query:c.trim(),top_k:s,score_threshold:.1,engagement_id:d});x(e.results),f(e)}catch(e){p(e instanceof Error?e.message:"Search failed"),x([]),f(null)}finally{g(!1)}}async function j(){if(!u.length)return;let e=new Blob([JSON.stringify({query:c,timestamp:new Date().toISOString(),engagement_id:d,results:u.map(e=>({content:e.content,score:e.score,document_name:e.document_name,page_number:e.page_number}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=`evidence-search-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}return(0,n.jsxs)("div",{className:`space-y-4 ${e}`,children:[(0,n.jsxs)("div",{className:"rounded-xl border p-4",children:[n.jsx("div",{className:"font-medium mb-3",children:"Evidence Search"}),(0,n.jsxs)("form",{onSubmit:y,className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex gap-2",children:[n.jsx("input",{type:"text",value:c,onChange:e=>o(e.target.value),placeholder:"Search for evidence in uploaded documents...",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:m}),n.jsx("button",{type:"submit",disabled:m||!c.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Searching...":"Search"})]}),b&&(0,n.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,n.jsxs)("span",{children:["Found ",b.total_results," results in ",b.processing_time_ms,"ms"]}),u.length>0&&n.jsx("button",{type:"button",onClick:j,className:"text-blue-600 hover:text-blue-700",children:"Export Results"})]})]}),h&&n.jsx("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:h})]}),u.length>0&&n.jsx("div",{className:"space-y-3",children:u.map((e,s)=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{t&&t(e)},children:[(0,n.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[n.jsx("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,n.jsxs)("span",{children:["Score: ",(100*e.score).toFixed(1),"%"]}),e.page_number&&(0,n.jsxs)("span",{children:["• Page ",e.page_number]}),(0,n.jsxs)("span",{children:["• Chunk ",e.chunk_index+1]})]})]}),n.jsx("div",{className:"flex gap-1",children:n.jsx("a",{href:(0,i.GR)(d,e.document_id),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"View"})})]}),n.jsx("div",{className:"text-sm text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:function(e,t){if(!t.trim())return e;let s=t.toLowerCase().split(/\s+/),n=e;return s.forEach(e=>{if(e.length>2){let t=RegExp(`(${e})`,"gi");n=n.replace(t,'<mark class="bg-yellow-200">$1</mark>')}}),n}(e.content,c)}})]},s))}),c&&!m&&0===u.length&&b&&(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsxs)("div",{className:"text-sm",children:['No evidence found for "',c,'"']}),n.jsx("div",{className:"text-xs mt-1",children:"Try different keywords or check if documents are indexed"})]})]})}},13488:(e,t,s)=>{s.d(t,{$6:()=>r,CZ:()=>a,GR:()=>l,Xj:()=>d,oe:()=>i});var n=s(6824);async function a(e){let t=await fetch(`${n.Sg}/engagements/${e}/docs`,{headers:(0,n.$V)()});if(!t.ok)throw Error(`listDocs ${t.status}`);return t.json()}async function r(e,t){let s=new FormData;t.forEach(e=>s.append("files",e));let a={method:"POST",headers:(0,n.$V)(!0),body:s},r=await fetch(`${n.Sg}/engagements/${e}/docs`,a);if(!r.ok){let e=`uploadDocs failed with status ${r.status}`;try{let t=await r.text();t&&(e+=`: ${t}`)}catch(t){e+=" (unable to read error details)"}throw Error(e)}return r.json()}function l(e,t){return`${n.Sg}/engagements/${e}/docs/${t}`}async function i(e,t){let s=await fetch(`${n.Sg}/engagements/${e}/docs/${t}`,{method:"DELETE",headers:(0,n.$V)()});if(!s.ok)throw Error(`deleteDoc ${s.status}`);return s.json()}async function d(e,t){let s=await fetch(`${n.Sg}/orchestrations/analyze-doc`,{method:"POST",headers:(0,n.$V)(),body:JSON.stringify({doc_id:t})});if(!s.ok)throw Error(`analyzeDoc ${s.status}`);return s.json()}}};