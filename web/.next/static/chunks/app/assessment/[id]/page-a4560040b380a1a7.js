(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[776],{4207:function(e,t,s){Promise.resolve().then(s.bind(s,9678))},9678:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var n=s(57437),a=s(2265),l=s(16463),i=s(96264),r=s(67283),c=s(35231),o=s(96300),d=s(1766),u=s(22824),m=s(72321),h=s(55349);function p(e){let{scores:t}=e,s=t.map(e=>({pillar:e.pillar_name,score:e.score||0,fullMark:5}));return(0,n.jsx)("div",{className:"w-full h-[400px]",children:(0,n.jsx)(c.h,{width:"100%",height:"100%",children:(0,n.jsxs)(o.H,{data:s,children:[(0,n.jsx)(d.n,{stroke:"#e5e7eb"}),(0,n.jsx)(u.I,{dataKey:"pillar",tick:{fontSize:12},className:"text-gray-600"}),(0,n.jsx)(m.S,{angle:90,domain:[0,5],tickCount:6,tick:{fontSize:10}}),(0,n.jsx)(h.F,{name:"Current Score",dataKey:"score",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.4,strokeWidth:2})]})})})}var x=s(20357);function f(e){let{onUploadComplete:t}=e,[s,l]=(0,a.useState)(!1),[i,r]=(0,a.useState)(null),[c,o]=(0,a.useState)(null),d=(0,a.useRef)(null);async function u(e){var s;let n=null===(s=e.target.files)||void 0===s?void 0:s[0];if(n){l(!0),r(null),o(null);try{let e=new Date().toISOString().replace(/[:.]/g,"-"),s="evidence/".concat(e,"-").concat(n.name),a=await fetch("".concat(x.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000","/uploads/sas"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({blob_name:s,permissions:"cw"})});if(501===a.status){r("Evidence uploads not configured on server");return}if(!a.ok){let e=await a.json();throw Error(e.detail||"Failed to get upload URL")}let{sasUrl:l}=await a.json(),i=await fetch(l,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":n.type||"application/octet-stream"},body:n});if(!i.ok)throw Error("Upload failed: ".concat(i.statusText));let c=l.split("?")[0];o(c),t&&t(c)}catch(e){r(e instanceof Error?e.message:"Upload failed")}finally{l(!1),d.current&&(d.current.value="")}}}return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("input",{ref:d,type:"file",onChange:u,disabled:s,className:"text-sm file:mr-2 file:py-1 file:px-3 file:rounded file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 disabled:opacity-50",accept:".pdf,.docx,.xlsx,.csv,.md,.png,.jpg,.txt"}),s&&(0,n.jsx)("span",{className:"text-sm text-gray-600",children:"Uploading..."})]}),i&&(0,n.jsxs)("div",{className:"text-sm text-red-600",children:["Error: ",i]}),c&&(0,n.jsxs)("div",{className:"text-sm text-green-600",children:["✓ Uploaded: ",c.split("/").pop()]})]})}function j(){let e=(0,l.useParams)().id,[t,s]=(0,a.useState)(null),[c,o]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!0),[x,j]=(0,a.useState)(null),[v,g]=(0,a.useState)(null),[b,y]=(0,a.useState)({}),[N,w]=(0,a.useState)(null),[_,S]=(0,a.useState)(!1),[E,k]=(0,a.useState)(!1),[C,A]=(0,a.useState)({});async function T(){try{var t,n;let a=await (0,r.AZ)(e);o(a);let l=await (0,i.tQ)(a.preset_id);s(l),u(null!==(n=null===(t=l.pillars[0])||void 0===t?void 0:t.id)&&void 0!==n?n:null)}catch(e){j(e instanceof Error?e.message:"Failed to load data")}finally{h(!1)}}async function I(t,s,n,a){let l="".concat(t,"-").concat(s);g(l),y({...b,[l]:!1});try{await (0,r.ee)(e,{pillar_id:t,question_id:s,level:n,notes:a}),y({...b,[l]:!0}),setTimeout(()=>{y(e=>({...e,[l]:!1}))},2e3);let i=await (0,r.AZ)(e);o(i)}catch(e){j(e instanceof Error?e.message:"Failed to save answer")}finally{g(null)}}async function P(){S(!0);try{let t=await (0,r.AE)(e);w(t),k(!0)}catch(e){j(e instanceof Error?e.message:"Failed to compute scores")}finally{S(!1)}}if((0,a.useEffect)(()=>{T()},[e]),m)return(0,n.jsx)("main",{className:"p-8",children:"Loading…"});if(x)return(0,n.jsx)("main",{className:"p-8",children:(0,n.jsxs)("div",{className:"p-4 bg-red-50 text-red-700 rounded",children:["Error: ",x]})});if(!t||!c)return(0,n.jsx)("main",{className:"p-8",children:"No data loaded"});let L=d?t.questions[d]:[],U=c.answers.reduce((e,t)=>(e["".concat(t.pillar_id,"-").concat(t.question_id)]=t,e),{});return(0,n.jsxs)("div",{className:"grid grid-cols-12 min-h-screen",children:[(0,n.jsxs)("aside",{className:"col-span-3 bg-gray-100 p-4 space-y-2",children:[(0,n.jsxs)("h2",{className:"font-semibold mb-2",children:["Assessment: ",c.name]}),(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["ID: ",e.slice(0,8),"..."]}),(0,n.jsx)("h3",{className:"font-semibold",children:"Pillars"}),t.pillars.map(e=>(0,n.jsx)("button",{onClick:()=>u(e.id),className:"block w-full text-left px-3 py-2 rounded ".concat(d===e.id?"bg-white":"hover:bg-white"),children:e.name},e.id))]}),(0,n.jsxs)("main",{className:"col-span-9 p-6 space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold",children:t.name}),(0,n.jsx)("button",{onClick:P,disabled:_,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",children:_?"Computing...":"Compute Scores"})]}),E&&N&&(0,n.jsxs)("div",{className:"bg-white border rounded p-6 space-y-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Assessment Scores"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-medium mb-2",children:"Pillar Scores"}),(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("th",{className:"text-left py-2",children:"Pillar"}),(0,n.jsx)("th",{className:"text-center py-2",children:"Score"}),(0,n.jsx)("th",{className:"text-center py-2",children:"Weight"}),(0,n.jsx)("th",{className:"text-center py-2",children:"Questions"})]})}),(0,n.jsx)("tbody",{children:N.pillar_scores.map(e=>{let s=t.pillars.find(t=>t.id===e.pillar_id);return(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("td",{className:"py-2",children:(null==s?void 0:s.name)||e.pillar_id}),(0,n.jsx)("td",{className:"text-center py-2",children:null!==e.score?e.score.toFixed(1):"N/A"}),(0,n.jsxs)("td",{className:"text-center py-2",children:[(100*e.weight).toFixed(0),"%"]}),(0,n.jsxs)("td",{className:"text-center py-2",children:[e.questions_answered," / ",e.total_questions]})]},e.pillar_id)})})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-medium mb-2",children:"Radar Visualization"}),(0,n.jsx)(p,{scores:N.pillar_scores.map(e=>{let s=t.pillars.find(t=>t.id===e.pillar_id);return{pillar_id:e.pillar_id,pillar_name:(null==s?void 0:s.name)||e.pillar_id,score:e.score}})})]}),(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded",children:[(0,n.jsx)("h3",{className:"font-medium",children:"Overall Score"}),(0,n.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[null!==N.overall_score?N.overall_score.toFixed(2):"N/A"," / 5.0"]}),N.gates_applied.length>0&&(0,n.jsx)("div",{className:"mt-2 text-sm text-orange-600",children:N.gates_applied.map((e,t)=>(0,n.jsxs)("div",{children:["⚠️ ",e]},t))})]})]}),null==L?void 0:L.map(e=>{var t;let s="".concat(d,"-").concat(e.id),a=U[s],l=v===s,i=b[s];return(0,n.jsxs)("div",{className:"bg-white border rounded p-4 space-y-3",children:[(0,n.jsx)("div",{className:"font-medium",children:e.text}),e.level_hints&&(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:[e.level_hints["3"]&&(0,n.jsxs)("span",{children:["L3: ",e.level_hints["3"]]}),e.level_hints["3"]&&e.level_hints["4"]&&(0,n.jsx)("span",{className:"mx-2",children:"•"}),e.level_hints["4"]&&(0,n.jsxs)("span",{children:["L4: ",e.level_hints["4"]]})]}),(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:"Evidence:"})," ",null===(t=e.evidence)||void 0===t?void 0:t.join(", ")]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"text-sm",children:"Level:"}),(0,n.jsxs)("select",{id:"level-".concat(s),className:"ml-2 border rounded px-2 py-1",defaultValue:(null==a?void 0:a.level)||"3",disabled:l,children:[(0,n.jsx)("option",{value:"1",children:"1"}),(0,n.jsx)("option",{value:"2",children:"2"}),(0,n.jsx)("option",{value:"3",children:"3"}),(0,n.jsx)("option",{value:"4",children:"4"}),(0,n.jsx)("option",{value:"5",children:"5"})]})]}),(0,n.jsx)("button",{onClick:()=>{let t=document.getElementById("level-".concat(s));I(d,e.id,parseInt(t.value))},disabled:l,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-400",children:l?"Saving...":"Save"}),i&&(0,n.jsx)("span",{className:"text-sm text-green-600",children:"✓ Saved"})]}),(0,n.jsxs)("div",{className:"border-t pt-3 space-y-2",children:[(0,n.jsx)("div",{className:"text-sm font-medium",children:"Upload Evidence"}),(0,n.jsx)(f,{onUploadComplete:e=>{A(t=>({...t,[s]:[...t[s]||[],e]}))}}),C[s]&&C[s].length>0&&(0,n.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Linked Evidence:"}),C[s].map((e,t)=>(0,n.jsxs)("div",{className:"text-sm text-blue-600 truncate",children:["• ",e.split("/").pop()]},t))]})]})]},e.id)})]})]})}},96264:function(e,t,s){"use strict";s.d(t,{$V:function(){return o},SC:function(){return i},Sg:function(){return c},tQ:function(){return r}});var n=s(15216);let a=s(20357).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function l(){let e=(0,n.OD)(),t=(0,n.K3)(),s={};return e&&(s["X-User-Email"]=e),t&&(s["X-Engagement-ID"]=t),s}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=l(),n=new AbortController,i=setTimeout(()=>n.abort(),t.timeout||3e4);try{let l=await fetch("".concat(a).concat(e),{...t,signal:n.signal,headers:{...s,...t.headers}});if(clearTimeout(i),!l.ok){let e=await l.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(l.status))}return l.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function r(e){let t=new AbortController,s=setTimeout(()=>t.abort(),3e4);try{let n=await fetch("".concat(a,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(s),!n.ok)throw Error("Preset ".concat(e," not found"));return n.json()}catch(t){if(clearTimeout(s),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=a;function o(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=l();return e||(t["Content-Type"]="application/json"),t}},67283:function(e,t,s){"use strict";s.d(t,{AE:function(){return i},AZ:function(){return r},Be:function(){return a},ee:function(){return l}});let n=s(20357).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";async function a(e,t){let s=await fetch("".concat(n,"/assessments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,preset_id:t})});if(!s.ok)throw Error("Failed to create assessment");return s.json()}async function l(e,t){if(!(await fetch("".concat(n,"/assessments/").concat(e,"/answers"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw Error("Failed to save answer")}async function i(e){let t=await fetch("".concat(n,"/assessments/").concat(e,"/scores"));if(!t.ok)throw Error("Failed to get scores");return t.json()}async function r(e){let t=await fetch("".concat(n,"/assessments/").concat(e));if(!t.ok)throw Error("Failed to get assessment");return t.json()}},15216:function(e,t,s){"use strict";s.d(t,{GJ:function(){return c},K3:function(){return l},OD:function(){return a},Pk:function(){return r},d8:function(){return i}});var n=s(20357);function a(){return localStorage.getItem("email")||""}function l(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function r(e){return a()||(await e.push("/signin"),"")}function c(){let e=a();return(n.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}}},function(e){e.O(0,[958,971,23,744],function(){return e(e.s=4207)}),_N_E=e.O()}]);