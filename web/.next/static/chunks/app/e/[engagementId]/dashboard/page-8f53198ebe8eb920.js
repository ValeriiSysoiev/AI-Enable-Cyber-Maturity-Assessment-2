(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{51740:function(e,t,n){Promise.resolve().then(n.bind(n,93769))},93769:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var s=n(57437),a=n(2265),r=n(16463),i=n(87138),c=n(96264);async function o(e){try{let t;let n=await fetch("".concat(c.Sg,"/engagements/").concat(e,"/summary"),{headers:(0,c.$V)()});if(!n.ok){let t="";try{t=await n.text()}catch(e){t="Unable to read response body"}throw Error("getSummary failed for engagement ".concat(e,": HTTP ").concat(n.status," ").concat(n.statusText,". Response: ").concat(t))}try{t=await n.json()}catch(t){throw Error("getSummary failed to parse JSON for engagement ".concat(e,": ").concat(t))}if(!t||"object"!=typeof t)throw Error("getSummary received invalid response for engagement ".concat(e,": not an object"));if("string"!=typeof t.engagement_id)throw Error("getSummary received invalid response for engagement ".concat(e,": missing or invalid engagement_id"));if(!t.counts||"object"!=typeof t.counts)throw Error("getSummary received invalid response for engagement ".concat(e,": missing or invalid counts object"));if(!Array.isArray(t.recent_activity))throw Error("getSummary received invalid response for engagement ".concat(e,": recent_activity is not an array"));return t}catch(t){if(t instanceof Error)throw t;throw Error("getSummary unexpected error for engagement ".concat(e,": ").concat(t))}}var l=n(27911),d=n(82766),u=n(15216);function m(){let{engagementId:e}=(0,r.useParams)(),[t,n]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[o,m]=(0,a.useState)(null),[f,h]=(0,a.useState)(!1),[x,g]=(0,a.useState)(!1),[p,y]=(0,a.useState)({});async function v(){if(e)try{c(!0);let t=await (0,l.EK)(e);n(t);let s={};t.forEach(e=>{e.ingestion_status&&(s[e.id]=e.ingestion_status)}),y(s),m(null)}catch(e){m(e instanceof Error?e.message:"Failed to load documents")}finally{c(!1)}}async function b(){if(e&&0!==t.length)try{let t=await (0,l.te)(e),n={};t.forEach(e=>{n[e.document_id]=e}),y(n)}catch(e){console.warn("Failed to poll ingestion statuses:",e)}}async function j(t){let n=t.target.files;if(n&&e)try{h(!0),await (0,d.$6)(e,Array.from(n)),await v(),t.target.value=""}catch(e){m(e instanceof Error?e.message:"Upload failed")}finally{h(!1)}}async function w(t){if(e)try{await (0,l.Hj)(e,t),y(e=>({...e,[t]:{document_id:t,status:"processing"}}))}catch(e){m(e instanceof Error?e.message:"Ingestion failed")}}async function N(){if(e)try{g(!0);let n=await (0,l.kR)({engagement_id:e}),s={};t.forEach(e=>{s[e.id]={document_id:e.id,status:"processing"}}),y(s),m(null),m("✓ ".concat(n.message)),setTimeout(()=>m(o),3e3)}catch(e){m(e instanceof Error?e.message:"Bulk reindex failed")}finally{g(!1)}}async function S(t){if(e)try{await (0,d.oe)(e,t),await v()}catch(e){m(e instanceof Error?e.message:"Delete failed")}}return((0,a.useEffect)(()=>{if(!e)return;v();let t=setInterval(b,5e3);return()=>clearInterval(t)},[e]),i)?(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"font-medium mb-2",children:"Documents"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Loading documents..."})]}):(0,s.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"font-medium",children:"Documents & Evidence"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,u.GJ)()&&(0,s.jsx)("button",{onClick:N,disabled:x||0===t.length,className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Reindexing...":"Reindex All"}),(0,s.jsxs)("label",{className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 cursor-pointer",children:[f?"Uploading...":"Upload Files",(0,s.jsx)("input",{type:"file",multiple:!0,onChange:j,disabled:f,className:"hidden",accept:".pdf,.docx,.xlsx,.csv,.md,.txt,.png,.jpg,.jpeg"})]})]})]}),o&&(0,s.jsx)("div",{className:"text-sm px-3 py-2 rounded ".concat(o.startsWith("✓")?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:o}),0===t.length?(0,s.jsx)("div",{className:"text-sm text-gray-500 text-center py-4",children:"No documents uploaded yet."}):(0,s.jsx)("div",{className:"space-y-2",children:t.map(t=>{let n=p[t.id]||t.ingestion_status;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-lg",children:function(e){if(!e)return"⚪";switch(e.status){case"completed":return"✅";case"processing":return"\uD83D\uDD04";case"pending":return"⏳";case"failed":return"❌";default:return"⚪"}}(n)}),(0,s.jsx)("span",{className:"font-medium text-sm truncate",children:t.filename})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[(0,s.jsxs)("div",{children:["Size: ",(t.size/1024).toFixed(1)," KB • Uploaded: ",new Date(t.uploaded_at).toLocaleDateString()]}),(0,s.jsxs)("div",{children:["Status: ",function(e){if(!e)return"Not indexed";switch(e.status){case"completed":return"Indexed (".concat(e.chunks_created||0," chunks)");case"processing":return"Processing...";case"pending":return"Pending";case"failed":return"Failed: ".concat(e.error_message||"Unknown error");default:return"Unknown"}}(n)]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(!n||"failed"===n.status)&&(0,s.jsx)("button",{onClick:()=>w(t.id),className:"px-2 py-1 text-xs bg-blue-50 text-blue-700 rounded hover:bg-blue-100",children:"Ingest"}),(0,s.jsx)("a",{href:(0,d.GR)(e,t.id),target:"_blank",rel:"noopener noreferrer",className:"px-2 py-1 text-xs bg-gray-50 text-gray-700 rounded hover:bg-gray-100",children:"Download"}),(0,s.jsx)("button",{onClick:()=>S(t.id),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded hover:bg-red-100",children:"Delete"})]})]},t.id)})}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:[t.length," document",1!==t.length?"s":""," •",Object.values(p).filter(e=>"completed"===e.status).length," indexed for evidence search"]})]})}function f(e){let{className:t="",onResultSelect:n,maxResults:i=10}=e,{engagementId:c}=(0,r.useParams)(),[o,u]=(0,a.useState)(""),[m,f]=(0,a.useState)([]),[h,x]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null),[y,v]=(0,a.useState)(null);async function b(e){if(e.preventDefault(),o.trim()&&c)try{x(!0),p(null);let e=await (0,l.Zg)({query:o.trim(),top_k:i,score_threshold:.1,engagement_id:c});f(e.results),v(e)}catch(e){p(e instanceof Error?e.message:"Search failed"),f([]),v(null)}finally{x(!1)}}async function j(){if(!m.length)return;let e=new Blob([JSON.stringify({query:o,timestamp:new Date().toISOString(),engagement_id:c,results:m.map(e=>({content:e.content,score:e.score,document_name:e.document_name,page_number:e.page_number}))},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="evidence-search-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}return(0,s.jsxs)("div",{className:"space-y-4 ".concat(t),children:[(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"font-medium mb-3",children:"Evidence Search"}),(0,s.jsxs)("form",{onSubmit:b,className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>u(e.target.value),placeholder:"Search for evidence in uploaded documents...",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:h}),(0,s.jsx)("button",{type:"submit",disabled:h||!o.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Searching...":"Search"})]}),y&&(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:["Found ",y.total_results," results in ",y.processing_time_ms,"ms"]}),m.length>0&&(0,s.jsx)("button",{type:"button",onClick:j,className:"text-blue-600 hover:text-blue-700",children:"Export Results"})]})]}),g&&(0,s.jsx)("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:g})]}),m.length>0&&(0,s.jsx)("div",{className:"space-y-3",children:m.map((e,t)=>(0,s.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{n&&n(e)},children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,s.jsxs)("span",{children:["Score: ",(100*e.score).toFixed(1),"%"]}),e.page_number&&(0,s.jsxs)("span",{children:["• Page ",e.page_number]}),(0,s.jsxs)("span",{children:["• Chunk ",e.chunk_index+1]})]})]}),(0,s.jsx)("div",{className:"flex gap-1",children:(0,s.jsx)("a",{href:(0,d.GR)(c,e.document_id),target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200",children:"View"})})]}),(0,s.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed",dangerouslySetInnerHTML:{__html:function(e,t){if(!t.trim())return e;let n=t.toLowerCase().split(/\s+/),s=e;return n.forEach(e=>{if(e.length>2){let t=RegExp("(".concat(e,")"),"gi");s=s.replace(t,'<mark class="bg-yellow-200">$1</mark>')}}),s}(e.content,o)}})]},t))}),o&&!h&&0===m.length&&y&&(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,s.jsxs)("div",{className:"text-sm",children:['No evidence found for "',o,'"']}),(0,s.jsx)("div",{className:"text-xs mt-1",children:"Try different keywords or check if documents are indexed"})]})]})}function h(e){let{initialContent:t="",onAnalysisComplete:n,className:i=""}=e,{engagementId:c}=(0,r.useParams)(),[o,d]=(0,a.useState)(t),[u,m]=(0,a.useState)(!1),[f,h]=(0,a.useState)(!1),[x,g]=(0,a.useState)(null),[p,y]=(0,a.useState)([]),[v,b]=(0,a.useState)(null);async function j(){if(o.trim()&&c)try{h(!0),b(null),g(null),y([]);let e=await (0,l.$r)(c,o.trim(),u);if(g(e),u&&e.id)try{let t=await (0,l.LT)(e.id);y(t)}catch(e){console.warn("Failed to load citations:",e)}n&&n(e)}catch(e){b(e instanceof Error?e.message:"Analysis failed")}finally{h(!1)}}return(0,s.jsxs)("div",{className:"space-y-4 ".concat(i),children:[(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"font-medium mb-3",children:"AI Analysis"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("textarea",{value:o,onChange:e=>d(e.target.value),placeholder:"Enter content to analyze...",className:"w-full h-32 px-3 py-2 border rounded-md text-sm resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:f}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)("input",{type:"checkbox",checked:u,onChange:e=>m(e.target.checked),disabled:f,className:"rounded"}),(0,s.jsx)("span",{children:"Use Evidence from Documents"}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:"(Uses RAG to find relevant evidence)"})]}),(0,s.jsx)("button",{onClick:j,disabled:f||!o.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"Analyzing...":"Analyze"})]})]}),v&&(0,s.jsx)("div",{className:"mt-3 text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:v})]}),x&&(0,s.jsxs)("div",{className:"rounded-xl border p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"font-medium",children:"Analysis Result"}),x.evidence_used&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-green-700 bg-green-50 px-2 py-1 rounded",children:[(0,s.jsx)("span",{children:"\uD83D\uDCDA"}),(0,s.jsx)("span",{children:"Evidence Used"})]})]}),(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,s.jsx)("div",{className:"whitespace-pre-wrap text-gray-700",children:"string"==typeof x?x:x.content?x.content:x.analysis?x.analysis:JSON.stringify(x,null,2)})}),p.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"font-medium text-sm",children:"Supporting Evidence"}),(0,s.jsx)("div",{className:"space-y-2",children:p.map((e,t)=>(0,s.jsxs)("div",{className:"bg-gray-50 border rounded-lg p-3",children:[(0,s.jsx)("div",{className:"flex items-start justify-between gap-3 mb-2",children:(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"font-medium text-sm text-blue-700 truncate",children:e.document_name}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 space-x-2",children:[(0,s.jsxs)("span",{children:["Relevance: ",(100*e.relevance_score).toFixed(1),"%"]}),e.page_number&&(0,s.jsxs)("span",{children:["• Page ",e.page_number]}),(0,s.jsxs)("span",{children:["• Section ",e.chunk_index+1]})]})]})}),(0,s.jsxs)("div",{className:"text-sm text-gray-700 italic border-l-2 border-blue-200 pl-3",children:['"',e.excerpt,'"']})]},t))})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 pt-2 border-t",children:["Analysis completed at ",new Date().toLocaleString(),x.evidence_used&&p.length>0&&" • ".concat(p.length," evidence source").concat(1!==p.length?"s":""," cited")]})]})]})}var x=n(57163);function g(){var e,t,n,l,d,u,g;let{engagementId:y}=(0,r.useParams)();(0,r.useRouter)();let[v,b]=(0,a.useState)(null),[j,w]=(0,a.useState)(""),[N,S]=(0,a.useState)("overview"),E=(0,x.QL)();return((0,a.useEffect)(()=>{y&&(async()=>{try{let e=await o(y);b(e)}catch(t){var e;w(null!==(e=t.message)&&void 0!==e?e:"Failed to load")}})()},[y]),E.isLoading)?(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("div",{className:"text-center",children:"Loading..."})}):y?(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Engagement Dashboard"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("a",{className:"px-3 py-1 border rounded",href:"".concat(c.Sg,"/engagements/").concat(y,"/exports/report.md"),target:"_blank",children:"Export Markdown"}),(0,s.jsx)(i.default,{className:"px-3 py-1 border rounded",href:"/e/".concat(y,"/demo"),children:"Open Demo"}),(0,s.jsx)(i.default,{className:"px-3 py-1 border rounded",href:"/e/".concat(y,"/demo#docs"),children:"Docs"})]})]}),j&&(0,s.jsx)("div",{className:"text-red-600 text-sm",children:j}),(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsx)("nav",{className:"flex space-x-8",children:[{id:"overview",label:"Overview"},{id:"documents",label:"Documents"},{id:"evidence",label:"Evidence Search"},{id:"analysis",label:"AI Analysis"}].map(e=>(0,s.jsx)("button",{onClick:()=>S(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(N===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"overview"===N&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[(0,s.jsx)(p,{title:"Assessments",value:null!==(n=null==v?void 0:v.counts.assessments)&&void 0!==n?n:0}),(0,s.jsx)(p,{title:"Documents",value:null!==(l=null==v?void 0:v.counts.documents)&&void 0!==l?l:0}),(0,s.jsx)(p,{title:"Findings",value:null!==(d=null==v?void 0:v.counts.findings)&&void 0!==d?d:0}),(0,s.jsx)(p,{title:"Recommendations",value:null!==(u=null==v?void 0:v.counts.recommendations)&&void 0!==u?u:0}),(0,s.jsx)(p,{title:"Run Logs",value:null!==(g=null==v?void 0:v.counts.runlogs)&&void 0!==g?g:0})]}),(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"font-medium mb-2",children:"Recent Activity"}),!(null==v?void 0:null===(e=v.recent_activity)||void 0===e?void 0:e.length)&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"No activity yet."}),(0,s.jsx)("ul",{className:"divide-y",children:null==v?void 0:null===(t=v.recent_activity)||void 0===t?void 0:t.map((e,t)=>(0,s.jsxs)("li",{className:"py-2 text-sm flex items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"truncate",children:[(0,s.jsx)("span",{className:"inline-block min-w-28 text-gray-500",children:e.type}),(0,s.jsx)("span",{className:"font-medium",children:e.title||e.id})]}),(0,s.jsx)("div",{className:"text-gray-500",children:e.ts?new Date(e.ts).toLocaleString():""})]},t))})]}),(null==v?void 0:v.recent_runlog_excerpt)&&(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"font-medium mb-2",children:"Recent Run Log"}),(0,s.jsx)("pre",{className:"text-sm whitespace-pre-wrap",children:v.recent_runlog_excerpt})]})]}),"documents"===N&&(0,s.jsx)(m,{}),"evidence"===N&&(0,s.jsx)(f,{className:"max-w-4xl",maxResults:20}),"analysis"===N&&(0,s.jsx)(h,{className:"max-w-4xl"})]}):(0,s.jsx)("div",{className:"p-6",children:"No engagement selected."})}function p(e){let{title:t,value:n}=e;return(0,s.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,s.jsx)("div",{className:"text-sm text-gray-500",children:t}),(0,s.jsx)("div",{className:"text-2xl font-semibold",children:n})]})}},57163:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return c},QL:function(){return l},aC:function(){return o}});var s=n(57437),a=n(2265),r=n(16463);let i=(0,a.createContext)(null);function c(e){let{children:t}=e,[n,c]=(0,a.useState)(null),[o,l]=(0,a.useState)({mode:"demo",enabled:!0}),[d,u]=(0,a.useState)(!0),[m,f]=(0,a.useState)();async function h(){try{u(!0),f(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&c({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&c({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),f(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&c({id:e,email:e,name:e.split("@")[0]})}finally{u(!1)}}return(0,r.useRouter)(),(0,a.useEffect)(()=>{h()},[]),(0,s.jsx)(i.Provider,{value:{user:n,mode:o,isAuthenticated:!!n,isLoading:d,error:m},children:t})}function o(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=o(),t=(0,r.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},96264:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return i},Sg:function(){return o},tQ:function(){return c}});var s=n(15216);let a=n(20357).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function r(){let e=(0,s.OD)(),t=(0,s.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r(),s=new AbortController,i=setTimeout(()=>s.abort(),t.timeout||3e4);try{let r=await fetch("".concat(a).concat(e),{...t,signal:s.signal,headers:{...n,...t.headers}});if(clearTimeout(i),!r.ok){let e=await r.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(r.status))}return r.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function c(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let s=await fetch("".concat(a,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!s.ok)throw Error("Preset ".concat(e," not found"));return s.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let o=a;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=r();return e||(t["Content-Type"]="application/json"),t}},15216:function(e,t,n){"use strict";n.d(t,{GJ:function(){return o},K3:function(){return r},OD:function(){return a},Pk:function(){return c},d8:function(){return i}});var s=n(20357);function a(){return localStorage.getItem("email")||""}function r(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function c(e){return a()||(await e.push("/signin"),"")}function o(){let e=a();return(s.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},82766:function(e,t,n){"use strict";n.d(t,{$6:function(){return r},CZ:function(){return a},GR:function(){return i},Xj:function(){return o},oe:function(){return c}});var s=n(96264);async function a(e){let t=await fetch("".concat(s.Sg,"/engagements/").concat(e,"/docs"),{headers:(0,s.$V)()});if(!t.ok)throw Error("listDocs ".concat(t.status));return t.json()}async function r(e,t){let n=new FormData;t.forEach(e=>n.append("files",e));let a={method:"POST",headers:(0,s.$V)(!0),body:n},r=await fetch("".concat(s.Sg,"/engagements/").concat(e,"/docs"),a);if(!r.ok){let e="uploadDocs failed with status ".concat(r.status);try{let t=await r.text();t&&(e+=": ".concat(t))}catch(t){e+=" (unable to read error details)"}throw Error(e)}return r.json()}function i(e,t){return"".concat(s.Sg,"/engagements/").concat(e,"/docs/").concat(t)}async function c(e,t){let n=await fetch("".concat(s.Sg,"/engagements/").concat(e,"/docs/").concat(t),{method:"DELETE",headers:(0,s.$V)()});if(!n.ok)throw Error("deleteDoc ".concat(n.status));return n.json()}async function o(e,t){let n=await fetch("".concat(s.Sg,"/orchestrations/analyze-doc"),{method:"POST",headers:(0,s.$V)(),body:JSON.stringify({doc_id:t})});if(!n.ok)throw Error("analyzeDoc ".concat(n.status));return n.json()}},27911:function(e,t,n){"use strict";n.d(t,{$r:function(){return l},EK:function(){return o},Hj:function(){return i},LT:function(){return d},Zg:function(){return a},kR:function(){return c},te:function(){return r}});var s=n(96264);async function a(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function r(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function i(e,t){let n=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function c(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function o(e){let[t,n]=await Promise.all([(0,s.SC)("/engagements/".concat(e,"/docs")),r(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:n.find(t=>t.document_id===e.id)}))}async function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:n})});if(!s.ok)throw Error((await s.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(s.status));return s.json()}async function d(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}},20357:function(e,t,n){"use strict";var s,a;e.exports=(null==(s=n.g.process)?void 0:s.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(88081)},88081:function(e){!function(){var t={229:function(e){var t,n,s,a=e.exports={};function r(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var o=[],l=!1,d=-1;function u(){l&&s&&(l=!1,s.length?o=s.concat(o):d=-1,o.length&&m())}function m(){if(!l){var e=c(u);l=!0;for(var t=o.length;t;){for(s=o,o=[];++d<t;)s&&s[d].run();d=-1,t=o.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new f(e,t)),1!==o.length||l||c(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function s(e){var a=n[e];if(void 0!==a)return a.exports;var r=n[e]={exports:{}},i=!0;try{t[e](r,r.exports,s),i=!1}finally{i&&delete n[e]}return r.exports}s.ab="//";var a=s(229);e.exports=a}()}},function(e){e.O(0,[291,971,23,744],function(){return e(e.s=51740)}),_N_E=e.O()}]);