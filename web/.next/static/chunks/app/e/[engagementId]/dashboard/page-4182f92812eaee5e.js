(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[616],{51740:function(e,t,n){Promise.resolve().then(n.bind(n,29580))},29580:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var a=n(57437),s=n(2265),r=n(99376),i=n(27648),o=n(29116);async function l(e){try{let t;let n=await fetch("".concat(o.Sg,"/engagements/").concat(e,"/summary"),{headers:(0,o.$V)()});if(!n.ok){let t="";try{t=await n.text()}catch(e){t="Unable to read response body"}throw Error("getSummary failed for engagement ".concat(e,": HTTP ").concat(n.status," ").concat(n.statusText,". Response: ").concat(t))}try{t=await n.json()}catch(t){throw Error("getSummary failed to parse JSON for engagement ".concat(e,": ").concat(t))}if(!t||"object"!=typeof t)throw Error("getSummary received invalid response for engagement ".concat(e,": not an object"));if("string"!=typeof t.engagement_id)throw Error("getSummary received invalid response for engagement ".concat(e,": missing or invalid engagement_id"));if(!t.counts||"object"!=typeof t.counts)throw Error("getSummary received invalid response for engagement ".concat(e,": missing or invalid counts object"));if(!Array.isArray(t.recent_activity))throw Error("getSummary received invalid response for engagement ".concat(e,": recent_activity is not an array"));return t}catch(t){if(t instanceof Error)throw t;throw Error("getSummary unexpected error for engagement ".concat(e,": ").concat(t))}}var c=n(44621),d=n(39344),u=n(74772),m=n(11265),x=n(16023);function v(){var e,t,n,v,g,f,p;let{engagementId:y}=(0,r.useParams)();(0,r.useRouter)();let[b,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(""),[S,E]=(0,s.useState)("overview"),_=(0,m.QL)();return((0,s.useEffect)(()=>{y&&(async()=>{try{let e=await l(y);j(e)}catch(t){var e;w(null!==(e=t.message)&&void 0!==e?e:"Failed to load")}})()},[y]),_.isLoading)?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading..."})}):y?(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Engagement Dashboard"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("a",{className:"px-3 py-1 border rounded",href:"".concat(o.Sg,"/engagements/").concat(y,"/exports/report.md"),target:"_blank",children:"Export Markdown"}),(0,a.jsx)(i.default,{className:"px-3 py-1 border rounded",href:"/e/".concat(y,"/demo"),children:"Open Demo"}),(0,a.jsx)(i.default,{className:"px-3 py-1 border rounded",href:"/e/".concat(y,"/demo#docs"),children:"Docs"}),(0,x.GJ)()&&(0,a.jsx)(i.default,{className:"px-3 py-1 border rounded bg-blue-50 text-blue-700 hover:bg-blue-100",href:"/e/".concat(y,"/gdpr"),children:"GDPR"})]})]}),N&&(0,a.jsx)("div",{className:"text-red-600 text-sm",children:N}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"flex space-x-8",children:[{id:"overview",label:"Overview"},{id:"documents",label:"Documents"},{id:"evidence",label:"Evidence Search"},{id:"analysis",label:"AI Analysis"}].map(e=>(0,a.jsx)("button",{onClick:()=>E(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(S===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"overview"===S&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[(0,a.jsx)(h,{title:"Assessments",value:null!==(n=null==b?void 0:b.counts.assessments)&&void 0!==n?n:0}),(0,a.jsx)(h,{title:"Documents",value:null!==(v=null==b?void 0:b.counts.documents)&&void 0!==v?v:0}),(0,a.jsx)(h,{title:"Findings",value:null!==(g=null==b?void 0:b.counts.findings)&&void 0!==g?g:0}),(0,a.jsx)(h,{title:"Recommendations",value:null!==(f=null==b?void 0:b.counts.recommendations)&&void 0!==f?f:0}),(0,a.jsx)(h,{title:"Run Logs",value:null!==(p=null==b?void 0:b.counts.runlogs)&&void 0!==p?p:0})]}),(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsx)("div",{className:"font-medium mb-2",children:"Recent Activity"}),!(null==b?void 0:null===(e=b.recent_activity)||void 0===e?void 0:e.length)&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"No activity yet."}),(0,a.jsx)("ul",{className:"divide-y",children:null==b?void 0:null===(t=b.recent_activity)||void 0===t?void 0:t.map((e,t)=>(0,a.jsxs)("li",{className:"py-2 text-sm flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"truncate",children:[(0,a.jsx)("span",{className:"inline-block min-w-28 text-gray-500",children:e.type}),(0,a.jsx)("span",{className:"font-medium",children:e.title||e.id})]}),(0,a.jsx)("div",{className:"text-gray-500",children:e.ts?new Date(e.ts).toLocaleString():""})]},t))})]}),(null==b?void 0:b.recent_runlog_excerpt)&&(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsx)("div",{className:"font-medium mb-2",children:"Recent Run Log"}),(0,a.jsx)("pre",{className:"text-sm whitespace-pre-wrap",children:b.recent_runlog_excerpt})]})]}),"documents"===S&&(0,a.jsx)(c.Z,{}),"evidence"===S&&(0,a.jsx)(d.Z,{className:"max-w-4xl",maxResults:20}),"analysis"===S&&(0,a.jsx)(u.Z,{className:"max-w-4xl"})]}):(0,a.jsx)("div",{className:"p-6",children:"No engagement selected."})}function h(e){let{title:t,value:n}=e;return(0,a.jsxs)("div",{className:"rounded-xl border p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:t}),(0,a.jsx)("div",{className:"text-2xl font-semibold",children:n})]})}},11265:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return o},QL:function(){return c},aC:function(){return l}});var a=n(57437),s=n(2265),r=n(99376);let i=(0,s.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,s.useState)(null),[l,c]=(0,s.useState)({mode:"demo",enabled:!0}),[d,u]=(0,s.useState)(!0),[m,x]=(0,s.useState)();async function v(){try{u(!0),x(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(c(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),x(t instanceof Error?t.message:"Authentication failed"),c({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{u(!1)}}return(0,r.useRouter)(),(0,s.useEffect)(()=>{v()},[]),(0,a.jsx)(i.Provider,{value:{user:n,mode:l,isAuthenticated:!!n,isLoading:d,error:m},children:t})}function l(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let e=l(),t=(0,r.useRouter)();return(0,s.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}}},function(e){e.O(0,[448,275,971,117,744],function(){return e(e.s=51740)}),_N_E=e.O()}]);