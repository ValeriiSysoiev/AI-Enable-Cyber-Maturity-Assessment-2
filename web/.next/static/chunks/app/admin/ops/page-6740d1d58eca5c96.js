(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{38655:function(e,t,n){Promise.resolve().then(n.bind(n,77443))},77443:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(57437),a=n(2265),s=n(96264),i=n(27911),o=n(15216);function c(e){let{className:t=""}=e,[n,s]=(0,a.useState)(!1),[c,l]=(0,a.useState)(null),[d,u]=(0,a.useState)(null),[m,f]=(0,a.useState)("");if(!(0,o.GJ)())return null;async function h(){if(!m.trim()){u("Please enter an engagement ID");return}try{s(!0),u(null),l(null);let e=await (0,i.kR)({engagement_id:m.trim(),force:!0});l(e)}catch(e){u(e instanceof Error?e.message:"Bulk reindex failed")}finally{s(!1)}}async function x(){try{s(!0),u(null),l(null);let e=await (0,i.kR)({engagement_id:"*",force:!0});l(e)}catch(e){u(e instanceof Error?e.message:"Global reindex failed")}finally{s(!1)}}return(0,r.jsxs)("div",{className:"rounded-xl border p-4 space-y-4 ".concat(t),children:[(0,r.jsx)("div",{className:"font-medium text-lg",children:"Evidence Administration"}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Admin-only tools for managing evidence search indexes"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"font-medium",children:"Reindex Engagement"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:m,onChange:e=>f(e.target.value),placeholder:"Enter engagement ID",className:"flex-1 px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:n}),(0,r.jsx)("button",{onClick:h,disabled:n||!m.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Reindexing...":"Reindex"})]})]}),(0,r.jsxs)("div",{className:"space-y-3 pt-4 border-t",children:[(0,r.jsx)("div",{className:"font-medium",children:"Global Operations"}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)("button",{onClick:x,disabled:n,className:"px-4 py-2 bg-orange-600 text-white rounded-md text-sm hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Reindexing...":"Reindex All Engagements"})}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"⚠️ This will reindex all documents across all engagements. Use with caution."})]}),d&&(0,r.jsxs)("div",{className:"text-sm text-red-600 bg-red-50 border border-red-200 rounded px-3 py-2",children:["Error: ",d]}),c&&(0,r.jsxs)("div",{className:"text-sm text-green-600 bg-green-50 border border-green-200 rounded px-3 py-2",children:[(0,r.jsxs)("div",{className:"font-medium",children:["✓ ",c.message]}),(0,r.jsxs)("div",{className:"text-xs mt-1",children:["Documents queued: ",c.documents_queued,c.estimated_completion_time&&(0,r.jsxs)(r.Fragment,{children:[" • Estimated completion: ",c.estimated_completion_time]})]})]}),(0,r.jsxs)("div",{className:"pt-4 border-t text-xs text-gray-500 space-y-1",children:[(0,r.jsx)("div",{children:"• Documents are processed in the background"}),(0,r.jsx)("div",{children:"• Check individual engagement dashboards for ingestion status"}),(0,r.jsx)("div",{children:"• Large document sets may take several minutes to process"})]})]})}var l=n(57163);function d(){var e;let[t,n]=(0,a.useState)("presets"),[i,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(""),f=(0,l.QL)();async function h(){try{let e=await fetch("".concat(s.Sg,"/presets"),{headers:(0,s.$V)()});if(!e.ok){m("Failed to load presets: ".concat(e.status));return}d(await e.json())}catch(e){m("Error loading presets: ".concat(e))}}async function x(e){e.preventDefault();let t=new FormData(e.currentTarget);try{let n=await fetch("".concat(s.Sg,"/presets/upload"),{method:"POST",headers:{...(0,s.$V)()},body:t});if(!n.ok){let e=await n.text();m("Upload failed: ".concat(n.status," - ").concat(e));return}let r=await n.json();m("Uploaded: ".concat(r.name," (").concat(r.id,")")),await h(),e.currentTarget.reset()}catch(e){m("Upload error: ".concat(e))}}return((0,a.useEffect)(()=>{f.isAuthenticated&&(0,o.GJ)()&&h()},[f.isAuthenticated]),f.isLoading)?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-center",children:"Loading..."})}):(0,o.GJ)()?(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin Operations"}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["User: ",null===(e=f.user)||void 0===e?void 0:e.name," • Mode: ","aad"===f.mode.mode?"Azure AD":"Demo"]})]}),(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsx)("nav",{className:"flex space-x-8",children:[{id:"presets",label:"Presets Management"},{id:"evidence",label:"Evidence Management"}].map(e=>(0,r.jsx)("button",{onClick:()=>n(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(t===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"presets"===t&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("form",{onSubmit:x,className:"border rounded p-4 space-y-3",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Upload a preset JSON"}),(0,r.jsx)("input",{name:"file",type:"file",accept:"application/json",className:"border rounded p-2",required:!0}),(0,r.jsx)("button",{className:"px-3 py-1 border rounded bg-blue-500 text-white hover:bg-blue-600",type:"submit",children:"Upload"}),u&&(0,r.jsx)("div",{className:"text-sm",children:u})]}),(0,r.jsxs)("div",{className:"border rounded p-4",children:[(0,r.jsx)("div",{className:"font-medium mb-2",children:"Available Presets"}),(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-2",children:"Name"}),(0,r.jsx)("th",{className:"text-left py-2",children:"ID"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Version"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Counts (P/C/Q)"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Source"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:i.map(e=>(0,r.jsxs)("tr",{className:"border-t",children:[(0,r.jsx)("td",{className:"py-2",children:e.name}),(0,r.jsx)("td",{className:"py-2 font-mono text-xs",children:e.id}),(0,r.jsx)("td",{className:"py-2",children:e.version}),(0,r.jsxs)("td",{className:"py-2",children:[e.counts.pillars,"/",e.counts.capabilities,"/",e.counts.questions]}),(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("bundled"===e.source?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.source})}),(0,r.jsxs)("td",{className:"py-2 space-x-2",children:[(0,r.jsx)("a",{className:"underline text-blue-600 hover:text-blue-800",href:"".concat(s.Sg,"/presets/").concat(e.id),target:"_blank",rel:"noopener noreferrer",children:"Preview"}),(0,r.jsx)("button",{className:"underline text-gray-600 hover:text-gray-800",onClick:()=>navigator.clipboard.writeText(e.id),children:"Copy ID"})]})]},e.id))})]}),0===i.length&&(0,r.jsx)("div",{className:"text-gray-500 text-center py-4",children:"No presets available"})]})]}),"evidence"===t&&(0,r.jsx)(c,{className:"max-w-2xl"})]}):(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-red-600",children:"Access denied. Admin privileges required."})})}},57163:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return o},QL:function(){return l},aC:function(){return c}});var r=n(57437),a=n(2265),s=n(16463);let i=(0,a.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,a.useState)(null),[c,l]=(0,a.useState)({mode:"demo",enabled:!0}),[d,u]=(0,a.useState)(!0),[m,f]=(0,a.useState)();async function h(){try{u(!0),f(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),f(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{u(!1)}}return(0,s.useRouter)(),(0,a.useEffect)(()=>{h()},[]),(0,r.jsx)(i.Provider,{value:{user:n,mode:c,isAuthenticated:!!n,isLoading:d,error:m},children:t})}function c(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,s.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},96264:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return i},Sg:function(){return c},tQ:function(){return o}});var r=n(15216);let a=n(20357).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function s(){let e=(0,r.OD)(),t=(0,r.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s(),r=new AbortController,i=setTimeout(()=>r.abort(),t.timeout||3e4);try{let s=await fetch("".concat(a).concat(e),{...t,signal:r.signal,headers:{...n,...t.headers}});if(clearTimeout(i),!s.ok){let e=await s.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(s.status))}return s.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let r=await fetch("".concat(a,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!r.ok)throw Error("Preset ".concat(e," not found"));return r.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=a;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=s();return e||(t["Content-Type"]="application/json"),t}},15216:function(e,t,n){"use strict";n.d(t,{GJ:function(){return c},K3:function(){return s},OD:function(){return a},Pk:function(){return o},d8:function(){return i}});var r=n(20357);function a(){return localStorage.getItem("email")||""}function s(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function o(e){return a()||(await e.push("/signin"),"")}function c(){let e=a();return(r.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},27911:function(e,t,n){"use strict";n.d(t,{$r:function(){return l},EK:function(){return c},Hj:function(){return i},LT:function(){return d},Zg:function(){return a},kR:function(){return o},te:function(){return s}});var r=n(96264);async function a(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function s(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function i(e,t){let n=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function o(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function c(e){let[t,n]=await Promise.all([(0,r.SC)("/engagements/".concat(e,"/docs")),s(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:n.find(t=>t.document_id===e.id)}))}async function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:n})});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(r.status));return r.json()}async function d(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}},16463:function(e,t,n){"use strict";var r=n(71169);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},20357:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(88081)},88081:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var c=[],l=!1,d=-1;function u(){l&&r&&(l=!1,r.length?c=r.concat(c):d=-1,c.length&&m())}function m(){if(!l){var e=o(u);l=!0;for(var t=c.length;t;){for(r=c,c=[];++d<t;)r&&r[d].run();d=-1,t=c.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||l||o(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}},i=!0;try{t[e](s,s.exports,r),i=!1}finally{i&&delete n[e]}return s.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[971,23,744],function(){return e(e.s=38655)}),_N_E=e.O()}]);