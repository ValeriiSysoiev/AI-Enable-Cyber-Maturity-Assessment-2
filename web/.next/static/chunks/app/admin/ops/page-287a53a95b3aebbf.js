(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{38655:function(e,t,n){Promise.resolve().then(n.bind(n,99037))},99037:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(57437),a=n(2265),i=n(29116),s=n(43610),o=n(11265),c=n(16023);function l(){var e;let[t,n]=(0,a.useState)("presets"),[l,u]=(0,a.useState)([]),[d,f]=(0,a.useState)(""),h=(0,o.QL)();async function m(){try{let e=await fetch("".concat(i.Sg,"/presets"),{headers:(0,i.$V)()});if(!e.ok){f("Failed to load presets: ".concat(e.status));return}u(await e.json())}catch(e){f("Error loading presets: ".concat(e))}}async function p(e){e.preventDefault();let t=new FormData(e.currentTarget);try{let n=await fetch("".concat(i.Sg,"/presets/upload"),{method:"POST",headers:{...(0,i.$V)()},body:t});if(!n.ok){let e=await n.text();f("Upload failed: ".concat(n.status," - ").concat(e));return}let r=await n.json();f("Uploaded: ".concat(r.name," (").concat(r.id,")")),await m(),e.currentTarget.reset()}catch(e){f("Upload error: ".concat(e))}}return((0,a.useEffect)(()=>{h.isAuthenticated&&(0,c.GJ)()&&m()},[h.isAuthenticated]),h.isLoading)?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-center",children:"Loading..."})}):(0,c.GJ)()?(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin Operations"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("a",{href:"/admin/auth",className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border",children:"Auth Diagnostics"}),(0,r.jsx)("a",{href:"/admin/gdpr",className:"px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded hover:bg-blue-100 border border-blue-200",children:"GDPR Management"}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["User: ",null===(e=h.user)||void 0===e?void 0:e.name," â€¢ Mode: ","aad"===h.mode.mode?"Azure AD":"Demo"]})]})]}),(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsx)("nav",{className:"flex space-x-8",children:[{id:"presets",label:"Presets Management"},{id:"evidence",label:"Evidence Management"}].map(e=>(0,r.jsx)("button",{onClick:()=>n(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(t===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"presets"===t&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("form",{onSubmit:p,className:"border rounded p-4 space-y-3",children:[(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Upload a preset JSON"}),(0,r.jsx)("input",{name:"file",type:"file",accept:"application/json",className:"border rounded p-2",required:!0}),(0,r.jsx)("button",{className:"px-3 py-1 border rounded bg-blue-500 text-white hover:bg-blue-600",type:"submit",children:"Upload"}),d&&(0,r.jsx)("div",{className:"text-sm",children:d})]}),(0,r.jsxs)("div",{className:"border rounded p-4",children:[(0,r.jsx)("div",{className:"font-medium mb-2",children:"Available Presets"}),(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-2",children:"Name"}),(0,r.jsx)("th",{className:"text-left py-2",children:"ID"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Version"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Counts (P/C/Q)"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Source"}),(0,r.jsx)("th",{className:"text-left py-2",children:"Actions"})]})}),(0,r.jsx)("tbody",{children:l.map(e=>(0,r.jsxs)("tr",{className:"border-t",children:[(0,r.jsx)("td",{className:"py-2",children:e.name}),(0,r.jsx)("td",{className:"py-2 font-mono text-xs",children:e.id}),(0,r.jsx)("td",{className:"py-2",children:e.version}),(0,r.jsxs)("td",{className:"py-2",children:[e.counts.pillars,"/",e.counts.capabilities,"/",e.counts.questions]}),(0,r.jsx)("td",{className:"py-2",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("bundled"===e.source?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.source})}),(0,r.jsxs)("td",{className:"py-2 space-x-2",children:[(0,r.jsx)("a",{className:"underline text-blue-600 hover:text-blue-800",href:"".concat(i.Sg,"/presets/").concat(e.id),target:"_blank",rel:"noopener noreferrer",children:"Preview"}),(0,r.jsx)("button",{className:"underline text-gray-600 hover:text-gray-800",onClick:()=>navigator.clipboard.writeText(e.id),children:"Copy ID"})]})]},e.id))})]}),0===l.length&&(0,r.jsx)("div",{className:"text-gray-500 text-center py-4",children:"No presets available"})]})]}),"evidence"===t&&(0,r.jsx)(s.Z,{className:"max-w-2xl"})]}):(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-red-600",children:"Access denied. Admin privileges required."})})}},11265:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return o},QL:function(){return l},aC:function(){return c}});var r=n(57437),a=n(2265),i=n(99376);let s=(0,a.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,a.useState)(null),[c,l]=(0,a.useState)({mode:"demo",enabled:!0}),[u,d]=(0,a.useState)(!0),[f,h]=(0,a.useState)();async function m(){try{d(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),h(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{d(!1)}}return(0,i.useRouter)(),(0,a.useEffect)(()=>{m()},[]),(0,r.jsx)(s.Provider,{value:{user:n,mode:c,isAuthenticated:!!n,isLoading:u,error:f},children:t})}function c(){let e=(0,a.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,i.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return s},Sg:function(){return c},tQ:function(){return o}});var r=n(16023);let a=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function i(){let e=(0,r.OD)(),t=(0,r.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i(),r=new AbortController,s=setTimeout(()=>r.abort(),t.timeout||3e4);try{let i=await fetch("".concat(a).concat(e),{...t,signal:r.signal,headers:{...n,...t.headers}});if(clearTimeout(s),!i.ok){let e=await i.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(i.status))}return i.json()}catch(e){if(clearTimeout(s),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let r=await fetch("".concat(a,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!r.ok)throw Error("Preset ".concat(e," not found"));return r.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=a;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return c},K3:function(){return i},OD:function(){return a},Pk:function(){return o},d8:function(){return s}});var r=n(40257);function a(){return localStorage.getItem("email")||""}function i(){return localStorage.getItem("engagementId")||""}function s(e){localStorage.setItem("engagementId",e)}async function o(e){return a()||(await e.push("/signin"),"")}function c(){let e=a();return(r.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},4062:function(e,t,n){"use strict";n.d(t,{$r:function(){return l},EK:function(){return c},Hj:function(){return s},LT:function(){return u},Zg:function(){return a},kR:function(){return o},te:function(){return i}});var r=n(29116);async function a(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function i(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function s(e,t){let n=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function o(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function c(e){let[t,n]=await Promise.all([(0,r.SC)("/engagements/".concat(e,"/docs")),i(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:n.find(t=>t.document_id===e.id)}))}async function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:n})});if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(r.status));return r.json()}async function u(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}},40257:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function i(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?c=r.concat(c):u=-1,c.length&&f())}function f(){if(!l){var e=o(d);l=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||o(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}},s=!0;try{t[e](i,i.exports,r),s=!1}finally{s&&delete n[e]}return i.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[276,971,117,744],function(){return e(e.s=38655)}),_N_E=e.O()}]);