(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[331],{11265:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},QL:function(){return l},aC:function(){return c}});var n=r(57437),a=r(2265),s=r(99376);let o=(0,a.createContext)(null);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[c,l]=(0,a.useState)({mode:"demo",enabled:!0}),[u,d]=(0,a.useState)(!0),[g,m]=(0,a.useState)();async function h(){try{d(!0),m(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&i({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&i({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),m(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&i({id:e,email:e,name:e.split("@")[0]})}finally{d(!1)}}return(0,s.useRouter)(),(0,a.useEffect)(()=>{h()},[]),(0,n.jsx)(o.Provider,{value:{user:r,mode:c,isAuthenticated:!!r,isLoading:u,error:g},children:t})}function c(){let e=(0,a.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,s.useRouter)();return(0,a.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},79267:function(e,t,r){"use strict";r.d(t,{Z:function(){return o}});var n=r(57437),a=r(2265),s=r(22466);function o(e){let{engagementId:t,className:o="",isAdminView:i=!1,defaultPageSize:c=20}=e,[l,u]=(0,a.useState)([]),[d,g]=(0,a.useState)(1),[m,h]=(0,a.useState)(c),[f,p]=(0,a.useState)(0),[x,y]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),[w,j]=(0,a.useState)(!0),[N,_]=(0,a.useState)(""),[S,E]=(0,a.useState)(""),[C,P]=(0,a.useState)(""),[T,I]=(0,a.useState)(null);(0,a.useEffect)(()=>{k()},[t,d,m,S,C]);let k=async()=>{j(!0),_("");try{let e;if(i){let{getGlobalAuditLogs:t}=await Promise.resolve().then(r.bind(r,22466));e=await t(d,m,S||void 0,C||void 0)}else e=await (0,s.FA)(t,d,m,S||void 0);u(e.entries),p(e.total_count),y(e.has_next),b(e.has_prev)}catch(e){_(e.message)}finally{j(!1)}},A=e=>{g(e)},R=e=>{h(e),g(1)},L=e=>{E(e),g(1)},O=e=>{P(e),g(1)},D=e=>{I(T===e?null:e)},M=e=>{switch(e){case"data_export_requested":case"data_export_completed":return"bg-blue-100 text-blue-800";case"data_purge_requested":case"data_purge_completed":return"bg-red-100 text-red-800";case"consent_given":return"bg-green-100 text-green-800";case"consent_withdrawn":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},U=e=>e&&0!==Object.keys(e).length?Object.entries(e).map(e=>{let[t,r]=e;return(0,n.jsxs)("div",{className:"text-xs",children:[(0,n.jsxs)("span",{className:"text-gray-500",children:[t,":"]}),(0,n.jsx)("span",{className:"ml-1 font-mono",children:"object"==typeof r?JSON.stringify(r,null,2):String(r)})]},t)}):null;return w?(0,n.jsx)("div",{className:"space-y-4 ".concat(o),children:(0,n.jsx)("div",{className:"animate-pulse space-y-2",children:[1,2,3,4,5].map(e=>(0,n.jsx)("div",{className:"h-16 bg-gray-200 rounded"},e))})}):(0,n.jsxs)("div",{className:"space-y-6 ".concat(o),children:[(0,n.jsxs)("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action Type"}),(0,n.jsxs)("select",{value:S,onChange:e=>L(e.target.value),className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:"",children:"All Actions"}),["data_export_requested","data_export_completed","data_purge_requested","data_purge_completed","data_accessed","consent_given","consent_withdrawn"].map(e=>(0,n.jsx)("option",{value:e,children:(0,s.EQ)(e)},e))]})]}),i&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Engagement ID"}),(0,n.jsx)("input",{type:"text",value:C,onChange:e=>O(e.target.value),placeholder:"Filter by engagement",className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Per Page"}),(0,n.jsxs)("select",{value:m,onChange:e=>R(Number(e.target.value)),className:"border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,n.jsx)("option",{value:10,children:"10"}),(0,n.jsx)("option",{value:20,children:"20"}),(0,n.jsx)("option",{value:50,children:"50"}),(0,n.jsx)("option",{value:100,children:"100"})]})]})]}),(0,n.jsx)("button",{onClick:k,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border",children:"Refresh"})]}),N&&(0,n.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,n.jsx)("p",{className:"text-sm text-red-600",children:N})}),(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing ",l.length," of ",f.toLocaleString()," audit log entries",(S||C)&&(0,n.jsxs)("span",{className:"ml-2",children:["(filtered)",(0,n.jsx)("button",{onClick:()=>{E(""),P(""),g(1)},className:"ml-1 text-blue-600 hover:text-blue-800 underline",children:"Clear filters"})]})]}),0===l.length?(0,n.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No audit log entries found."}):(0,n.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,n.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,n.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat(M(e.action)),children:(0,s.EQ)(e.action)}),(0,n.jsx)("span",{className:"text-sm font-medium",children:e.user_email}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.timestamp).toLocaleString()})]}),i&&(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,n.jsx)("span",{className:"font-medium",children:"Engagement:"}),(0,n.jsx)("span",{className:"ml-1 font-mono text-xs",children:e.engagement_id})]}),e.ip_address&&(0,n.jsxs)("div",{className:"text-xs text-gray-500",children:["IP: ",e.ip_address]})]}),(Object.keys(e.details).length>0||e.user_agent)&&(0,n.jsx)("button",{onClick:()=>D(e.id),className:"ml-4 p-1 text-gray-400 hover:text-gray-600",children:(0,n.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(T===e.id?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),T===e.id&&(0,n.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 space-y-2",children:[e.user_agent&&(0,n.jsxs)("div",{className:"text-xs",children:[(0,n.jsx)("span",{className:"text-gray-500",children:"User Agent:"}),(0,n.jsx)("div",{className:"mt-1 font-mono text-xs break-all bg-gray-50 p-2 rounded",children:e.user_agent})]}),Object.keys(e.details).length>0&&(0,n.jsxs)("div",{className:"text-xs",children:[(0,n.jsx)("span",{className:"text-gray-500",children:"Details:"}),(0,n.jsx)("div",{className:"mt-1 bg-gray-50 p-2 rounded space-y-1",children:U(e.details)})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-400",children:["Log ID: ",e.id]})]})]},e.id))}),(x||v)&&(0,n.jsxs)("div",{className:"flex items-center justify-between border-t pt-4",children:[(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:["Page ",d," of ",Math.ceil(f/m)]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{onClick:()=>A(d-1),disabled:!v,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),(0,n.jsx)("button",{onClick:()=>A(d+1),disabled:!x,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})}},29116:function(e,t,r){"use strict";r.d(t,{$V:function(){return l},SC:function(){return o},Sg:function(){return c},tQ:function(){return i}});var n=r(16023);let a=r(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function s(){let e=(0,n.OD)(),t=(0,n.K3)(),r={};return e&&(r["X-User-Email"]=e),t&&(r["X-Engagement-ID"]=t),r}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=s(),n=new AbortController,o=setTimeout(()=>n.abort(),t.timeout||3e4);try{let s=await fetch("".concat(a).concat(e),{...t,signal:n.signal,headers:{...r,...t.headers}});if(clearTimeout(o),!s.ok){let e=await s.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(s.status))}return s.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function i(e){let t=new AbortController,r=setTimeout(()=>t.abort(),3e4);try{let n=await fetch("".concat(a,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(r),!n.ok)throw Error("Preset ".concat(e," not found"));return n.json()}catch(t){if(clearTimeout(r),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=a;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=s();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,r){"use strict";r.d(t,{GJ:function(){return c},K3:function(){return s},OD:function(){return a},Pk:function(){return i},d8:function(){return o}});var n=r(40257);function a(){return localStorage.getItem("email")||""}function s(){return localStorage.getItem("engagementId")||""}function o(e){localStorage.setItem("engagementId",e)}async function i(e){return a()||(await e.push("/signin"),"")}function c(){let e=a();return(n.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},22466:function(e,t,r){"use strict";r.d(t,{AV:function(){return o},Cs:function(){return u},E0:function(){return y},EQ:function(){return v},FA:function(){return l},Is:function(){return g},M_:function(){return c},XB:function(){return p},Yj:function(){return s},getGlobalAuditLogs:function(){return h},hF:function(){return a},jQ:function(){return m},kF:function(){return d},sS:function(){return x},sk:function(){return f},zc:function(){return w}});var n=r(29116);async function a(e){try{return await (0,n.SC)("/gdpr/export",{method:"POST",body:JSON.stringify(e)})}catch(e){throw b(e)}}async function s(e){try{let t=await fetch("/api/proxy/gdpr/export/".concat(e,"/download"),{headers:{"Content-Type":"application/octet-stream"}});if(!t.ok)throw Error("Download failed: ".concat(t.status));return await t.blob()}catch(e){throw b(e)}}async function o(e){try{return await (0,n.SC)("/gdpr/purge",{method:"POST",body:JSON.stringify(e)})}catch(e){throw b(e)}}async function i(e){try{return await (0,n.SC)("/gdpr/jobs/".concat(e))}catch(e){throw b(e)}}async function c(e,t){try{let r=new URLSearchParams;t&&r.set("type",t);let a="/gdpr/jobs?engagement_id=".concat(e).concat(r.toString()?"&"+r.toString():"");return await (0,n.SC)(a)}catch(e){throw b(e)}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=arguments.length>3?arguments[3]:void 0;try{let s=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:r.toString()});return a&&s.set("action",a),await (0,n.SC)("/gdpr/audit-logs?".concat(s.toString()))}catch(e){throw b(e)}}async function u(e){try{return await (0,n.SC)("/gdpr/compliance/".concat(e))}catch(e){throw b(e)}}async function d(){try{return await (0,n.SC)("/gdpr/admin/dashboard")}catch(e){throw b(e)}}async function g(){try{return await (0,n.SC)("/gdpr/admin/ttl-policy")}catch(e){throw b(e)}}async function m(e){try{return await (0,n.SC)("/gdpr/admin/ttl-policy",{method:"PUT",body:JSON.stringify(e)})}catch(e){throw b(e)}}async function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;try{let s=new URLSearchParams({page:e.toString(),page_size:t.toString()});return r&&s.set("action",r),a&&s.set("engagement_id",a),await (0,n.SC)("/gdpr/admin/audit-logs?".concat(s.toString()))}catch(e){throw b(e)}}function f(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function p(e,t){return e.trim().toLowerCase()===t.trim().toLowerCase()}function x(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}function y(e){switch(e){case"completed":return"bg-green-100 text-green-800";case"processing":return"bg-blue-100 text-blue-800";case"pending":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}}function v(e){switch(e){case"data_export_requested":return"Data Export Requested";case"data_export_completed":return"Data Export Completed";case"data_purge_requested":return"Data Purge Requested";case"data_purge_completed":return"Data Purge Completed";case"data_accessed":return"Data Accessed";case"consent_given":return"Consent Given";case"consent_withdrawn":return"Consent Withdrawn";default:return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}}function b(e){if(e instanceof Error){if(e.message.includes("insufficient permissions"))return{code:"INSUFFICIENT_PERMISSIONS",message:"You do not have permission to perform this GDPR operation.",details:{originalError:e.message}};if(e.message.includes("invalid engagement"))return{code:"INVALID_ENGAGEMENT",message:"The specified engagement does not exist or is not accessible.",details:{originalError:e.message}};if(e.message.includes("export limit exceeded"))return{code:"EXPORT_LIMIT_EXCEEDED",message:"You have exceeded the maximum number of export requests. Please wait before requesting another export.",details:{originalError:e.message}};if(e.message.includes("purge in progress"))return{code:"PURGE_IN_PROGRESS",message:"A data purge operation is already in progress for this engagement.",details:{originalError:e.message}};if(e.message.includes("invalid format"))return{code:"INVALID_FORMAT",message:"The requested export format is not supported.",details:{originalError:e.message}};if(e.message.includes("timeout")||e.message.includes("network"))return{code:"NETWORK_ERROR",message:"Network error occurred. Please check your connection and try again.",details:{originalError:e.message}}}return{code:"UNKNOWN_ERROR",message:"An unexpected error occurred during the GDPR operation.",details:{originalError:(null==e?void 0:e.message)||String(e)}}}class w{start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;this.stop(),this.intervalId=setInterval(async()=>{var e,t,r;try{let r=await i(this.jobId);null===(e=this.onUpdate)||void 0===e||e.call(this,r),("completed"===r.status||"failed"===r.status)&&(this.stop(),null===(t=this.onComplete)||void 0===t||t.call(this,r))}catch(e){this.stop(),null===(r=this.onError)||void 0===r||r.call(this,b(e))}},e)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}constructor(e,t){this.jobId=e,this.onUpdate=t.onUpdate,this.onComplete=t.onComplete,this.onError=t.onError}}},99376:function(e,t,r){"use strict";var n=r(35475);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},40257:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(44227)},44227:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c=[],l=!1,u=-1;function d(){l&&n&&(l=!1,n.length?c=n.concat(c):u=-1,c.length&&g())}function g(){if(!l){var e=i(d);l=!0;for(var t=c.length;t;){for(n=c,c=[];++u<t;)n&&n[u].run();u=-1,t=c.length}n=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new m(e,t)),1!==c.length||l||i(g)},m.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}},o=!0;try{t[e](s,s.exports,n),o=!1}finally{o&&delete r[e]}return s.exports}n.ab="//";var a=n(229);e.exports=a}()}}]);