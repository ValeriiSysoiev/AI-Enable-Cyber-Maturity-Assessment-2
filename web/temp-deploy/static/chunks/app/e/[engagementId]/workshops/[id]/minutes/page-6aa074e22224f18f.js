(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[872],{8735:function(e,t,n){Promise.resolve().then(n.bind(n,15176))},15176:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var r=n(57437),s=n(2265),a=n(99376),o=n(29116);class i extends Error{constructor(e){super(e),this.name="MinutesConflictError"}}async function c(e,t){try{return await (0,o.SC)("/minutes/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(e){if(e instanceof Error&&e.message.includes("409"))throw new i("Cannot modify published minutes. Create a new version instead.");throw Error("Failed to update minutes: ".concat(e))}}async function u(e){try{return await (0,o.SC)("/minutes/".concat(e,"/publish"),{method:"POST"})}catch(e){if(e instanceof Error&&e.message.includes("409"))throw new i("Minutes are already published and cannot be modified.");throw Error("Failed to publish minutes: ".concat(e))}}async function l(e){try{return await (0,o.SC)("/minutes/".concat(e,"/new-version"),{method:"POST"})}catch(e){throw Error("Failed to create new version: ".concat(e))}}async function d(e){try{return await (0,o.SC)("/minutes/".concat(e))}catch(e){throw Error("Failed to get minutes: ".concat(e))}}function h(){let e=(0,a.useParams)(),t=(0,a.useSearchParams)(),n=(0,a.useRouter)(),o=e.id,h=e.engagementId,m=t.get("id"),[f,p]=(0,s.useState)(null),[x,g]=(0,s.useState)({attendees:[],decisions:[],actions:[],questions:[]}),[b,y]=(0,s.useState)(!0),[v,w]=(0,s.useState)(!1),[j,N]=(0,s.useState)(!1),[E,T]=(0,s.useState)("");(0,s.useEffect)(()=>{m&&C()},[m]);let C=async()=>{try{y(!0);let e=await d(m);p(e),g(e.sections),T("")}catch(e){console.error("Failed to load minutes:",e),T("Failed to load minutes")}finally{y(!1)}},S=async()=>{if(f)try{w(!0),T("");let e=await c(f.id,{sections:x});p(e)}catch(e){e instanceof i?T(e.message):T("Failed to save minutes")}finally{w(!1)}},P=async()=>{if(f)try{N(!0),T("");let e=await u(f.id);p(e)}catch(e){e instanceof i?T(e.message):T("Failed to publish minutes")}finally{N(!1)}},k=async()=>{if(f)try{T("");let e=await l(f.id);n.push("/e/".concat(h,"/workshops/").concat(o,"/minutes?id=").concat(e.id))}catch(e){T("Failed to create new version")}},_=(e,t,n)=>{g(r=>({...r,[e]:r[e].map((e,r)=>r===t?n:e)}))},A=e=>{g(t=>({...t,[e]:[...t[e],""]}))},I=(e,t)=>{g(n=>({...n,[e]:n[e].filter((e,n)=>n!==t)}))},L=(e,t,n)=>{let s=(null==f?void 0:f.status)==="published";return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:e}),!s&&(0,r.jsx)("button",{onClick:()=>A(t),className:"text-blue-600 hover:text-blue-800 text-sm",children:"+ Add"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[x[t].map((e,a)=>(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:e,onChange:e=>_(t,a,e.target.value),placeholder:n,readOnly:s,className:"flex-1 px-3 py-2 border rounded-md ".concat(s?"bg-gray-50 border-gray-200 text-gray-600":"border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent")}),!s&&(0,r.jsx)("button",{onClick:()=>I(t,a),className:"text-red-600 hover:text-red-800 px-2",children:"\xd7"})]},a)),0===x[t].length&&(0,r.jsxs)("p",{className:"text-gray-500 text-sm italic",children:["No ",t," recorded"]})]})]})};if(b)return(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-6",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"h-32 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})]})});if(!f)return(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-gray-600",children:"Minutes not found"}),(0,r.jsx)("button",{onClick:()=>n.push("/e/".concat(h,"/workshops/").concat(o)),className:"mt-4 text-blue-600 hover:text-blue-800",children:"← Back to Workshop"})]})});let F="published"===f.status;return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,r.jsxs)("header",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Minutes Editor"}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[(0,r.jsx)("span",{className:"px-2 py-1 rounded-full ".concat(F?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:F?"Published":"Draft"}),f.published_at&&(0,r.jsxs)("span",{children:["Published: ",new Date(f.published_at).toLocaleString()]})]})]}),(0,r.jsx)("button",{onClick:()=>n.push("/e/".concat(h,"/workshops/").concat(o)),className:"text-blue-600 hover:text-blue-800",children:"← Back to Workshop"})]}),E&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:E}),F&&(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:"Minutes are immutable after publishing"}),f.content_hash&&(0,r.jsxs)("p",{className:"text-sm font-mono mt-1",children:["Hash: ",f.content_hash]})]}),(0,r.jsx)("button",{onClick:k,className:"bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700",children:"Create New Version"})]})}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 space-y-8",children:[L("Attendees","attendees","Enter attendee name"),L("Decisions","decisions","Enter decision made"),L("Actions","actions","Enter action item"),L("Questions","questions","Enter question or concern")]}),!F&&(0,r.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,r.jsx)("button",{onClick:S,disabled:v,className:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 disabled:bg-gray-400",children:v?"Saving...":"Save Draft"}),(0,r.jsx)("button",{onClick:P,disabled:j,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 disabled:bg-green-400",children:j?"Publishing...":"Publish Minutes"})]})]})}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return u},SC:function(){return o},Sg:function(){return c},tQ:function(){return i}});var r=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function a(){let e=(0,r.OD)(),t=(0,r.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a(),r=new AbortController,o=setTimeout(()=>r.abort(),t.timeout||3e4);try{let a=await fetch("".concat(s).concat(e),{...t,signal:r.signal,headers:{...n,...t.headers}});if(clearTimeout(o),!a.ok){let e=await a.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(a.status))}return a.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function i(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let r=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!r.ok)throw Error("Preset ".concat(e," not found"));return r.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=s;function u(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=a();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return c},K3:function(){return a},OD:function(){return s},Pk:function(){return i},d8:function(){return o}});var r=n(40257);function s(){return localStorage.getItem("email")||""}function a(){return localStorage.getItem("engagementId")||""}function o(e){localStorage.setItem("engagementId",e)}async function i(e){return s()||(await e.push("/signin"),"")}function c(){let e=s();return(r.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},40257:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c=[],u=!1,l=-1;function d(){u&&r&&(u=!1,r.length?c=r.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=i(d);u=!0;for(var t=c.length;t;){for(r=c,c=[];++l<t;)r&&r[l].run();l=-1,t=c.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new m(e,t)),1!==c.length||u||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}},o=!0;try{t[e](a,a.exports,r),o=!1}finally{o&&delete n[e]}return a.exports}r.ab="//";var s=r(229);e.exports=s}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=8735)}),_N_E=e.O()}]);