(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[297],{32930:function(e,t,n){Promise.resolve().then(n.bind(n,18129))},18129:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(57437),s=n(2265),a=n(99376),o=n(27648),i=n(91225);function l(e){let{isOpen:t,onClose:a,onSuccess:o,engagementId:i}=e,[l,c]=(0,s.useState)({title:"",attendees:[{user_id:"",email:"",role:"Member"}]}),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(""),x=async e=>{e.preventDefault(),u(!0),h("");try{let{createWorkshop:e}=await Promise.resolve().then(n.bind(n,91225));await e(i,l),o(),a(),c({title:"",attendees:[{user_id:"",email:"",role:"Member"}]})}catch(e){h(e instanceof Error?e.message:"Failed to create workshop")}finally{u(!1)}},f=e=>{c(t=>({...t,attendees:t.attendees.filter((t,n)=>n!==e)}))},g=(e,t,n)=>{c(r=>({...r,attendees:r.attendees.map((r,s)=>s===e?{...r,[t]:n}:r)}))};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"New Workshop"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Workshop Title"}),(0,r.jsx)("input",{type:"text",value:l.title,onChange:e=>c(t=>({...t,title:e.target.value})),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Attendees"}),(0,r.jsx)("button",{type:"button",onClick:()=>{c(e=>({...e,attendees:[...e.attendees,{user_id:"",email:"",role:"Member"}]}))},className:"text-sm text-blue-600 hover:text-blue-700",children:"+ Add Attendee"})]}),l.attendees.map((e,t)=>(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-3 mb-3",children:[(0,r.jsx)("div",{className:"col-span-4",children:(0,r.jsx)("input",{type:"email",placeholder:"Email",value:e.email,onChange:e=>g(t,"email",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})}),(0,r.jsx)("div",{className:"col-span-3",children:(0,r.jsx)("input",{type:"text",placeholder:"User ID",value:e.user_id,onChange:e=>g(t,"user_id",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})}),(0,r.jsx)("div",{className:"col-span-3",children:(0,r.jsxs)("select",{value:e.role,onChange:e=>g(t,"role",e.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"Member",children:"Member"}),(0,r.jsx)("option",{value:"Lead",children:"Lead"}),(0,r.jsx)("option",{value:"Observer",children:"Observer"})]})}),(0,r.jsx)("div",{className:"col-span-2",children:l.attendees.length>1&&(0,r.jsx)("button",{type:"button",onClick:()=>f(t),className:"w-full h-full text-red-600 hover:text-red-700 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},t))]}),m&&(0,r.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:m})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50",children:d?"Creating...":"Create Workshop"})]})]})]})})}):null}function c(e){let{workshop:t}=e,n=(0,i.t6)(t),s=(0,i.Ao)(t);return(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 hover:shadow-lg transition-shadow",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(o.default,{href:"/e/".concat(t.engagement_id,"/workshops/").concat(t.id),className:"block group",children:(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 group-hover:text-indigo-600",children:t.title})}),(0,r.jsxs)("div",{className:"mt-2 flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),t.attendees.length," attendees"]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),n.consented,"/",n.total," consented (",n.percentage,"%)"]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Created ",new Date(t.created_at).toLocaleDateString()]})]})]}),(0,r.jsx)("div",{className:"ml-4 flex flex-col items-end space-y-2",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(t.started?"bg-green-100 text-green-800":s?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"),children:t.started?"Started":s?"Ready":"Pending Consent"})})]}),(0,r.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,r.jsx)(o.default,{href:"/e/".concat(t.engagement_id,"/workshops/").concat(t.id),className:"text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"View Details â†’"}),(0,r.jsx)("button",{className:"px-3 py-1 text-sm font-medium rounded-md ".concat(s&&!t.started?"text-white bg-green-600 hover:bg-green-700":"text-gray-500 bg-gray-100 cursor-not-allowed"),disabled:!s||t.started,children:t.started?"Started":"Start Workshop"})]})]})}function d(){let e=(0,a.useParams)().engagementId,[t,n]=(0,s.useState)([]),[o,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(""),[h,x]=(0,s.useState)(!1),f=async()=>{try{d(!0);let t=await (0,i.SA)(e);n(t.workshops)}catch(e){m(e instanceof Error?e.message:"Failed to load workshops")}finally{d(!1)}};return((0,s.useEffect)(()=>{e&&f()},[e]),o)?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-64 mb-6"}),(0,r.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,r.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]},e))})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"bg-white shadow-sm rounded-lg px-6 py-4 mb-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Workshops"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Manage workshop consent and participation"})]}),(0,r.jsx)("button",{onClick:()=>x(!0),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:"New Workshop"})]})}),u&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-sm text-red-600",children:u})}),0===t.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,r.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No workshops"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new workshop."}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsxs)("button",{onClick:()=>x(!0),className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"New Workshop"]})})]}):(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,r.jsx)(c,{workshop:e},e.id))}),(0,r.jsx)(l,{isOpen:h,onClose:()=>x(!1),onSuccess:()=>{f(),x(!1)},engagementId:e})]})})}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return c},SC:function(){return o},Sg:function(){return l},tQ:function(){return i}});var r=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function a(){let e=(0,r.OD)(),t=(0,r.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a(),r=new AbortController,o=setTimeout(()=>r.abort(),t.timeout||3e4);try{let a=await fetch("".concat(s).concat(e),{...t,signal:r.signal,headers:{...n,...t.headers}});if(clearTimeout(o),!a.ok){let e=await a.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(a.status))}return a.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function i(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let r=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!r.ok)throw Error("Preset ".concat(e," not found"));return r.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let l=s;function c(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=a();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return l},K3:function(){return a},OD:function(){return s},Pk:function(){return i},d8:function(){return o}});var r=n(40257);function s(){return localStorage.getItem("email")||""}function a(){return localStorage.getItem("engagementId")||""}function o(e){localStorage.setItem("engagementId",e)}async function i(e){return s()||(await e.push("/signin"),"")}function l(){let e=s();return(r.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},91225:function(e,t,n){"use strict";n.d(t,{Ao:function(){return l},SA:function(){return a},aM:function(){return o},createWorkshop:function(){return s},t6:function(){return c},u7:function(){return i}});var r=n(29116);async function s(e,t){let n={engagement_id:e,title:t.title,start_ts:t.start_ts||null,attendees:t.attendees};return await (0,r.SC)("/api/v1/workshops",{method:"POST",headers:{"Content-Type":"application/json","X-Engagement-ID":e},body:JSON.stringify(n)})}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,s=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:n.toString()});return await (0,r.SC)("/api/v1/workshops?".concat(s),{headers:{"X-Engagement-ID":e}})}async function o(e,t,n){return await (0,r.SC)("/api/v1/workshops/".concat(t,"/consent"),{method:"POST",headers:{"Content-Type":"application/json","X-Engagement-ID":e},body:JSON.stringify(n)})}async function i(e,t){return await (0,r.SC)("/api/v1/workshops/".concat(t,"/start"),{method:"POST",headers:{"X-Engagement-ID":e}})}function l(e){return e.attendees.every(e=>void 0!==e.consent)}function c(e){let t=e.attendees.length,n=e.attendees.filter(e=>e.consent).length;return{total:t,consented:n,pending:t-n,percentage:t>0?Math.round(n/t*100):0}}},27648:function(e,t,n){"use strict";n.d(t,{default:function(){return s.a}});var r=n(72972),s=n.n(r)},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},40257:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var l=[],c=!1,d=-1;function u(){c&&r&&(c=!1,r.length?l=r.concat(l):d=-1,l.length&&m())}function m(){if(!c){var e=i(u);c=!0;for(var t=l.length;t;){for(r=l,l=[];++d<t;)r&&r[d].run();d=-1,t=l.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new h(e,t)),1!==l.length||c||i(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=x,s.addListener=x,s.once=x,s.off=x,s.removeListener=x,s.removeAllListeners=x,s.emit=x,s.prependListener=x,s.prependOnceListener=x,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}},o=!0;try{t[e](a,a.exports,r),o=!1}finally{o&&delete n[e]}return a.exports}r.ab="//";var s=r(229);e.exports=s}()}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=32930)}),_N_E=e.O()}]);