(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{67645:function(e,t,n){Promise.resolve().then(n.bind(n,48733))},48733:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(57437),s=n(2265),a=n(99376),i=n(29116);async function o(e,t,n){return(0,i.SC)("/chat/message",{method:"POST",headers:{"Content-Type":"application/json","X-Engagement-ID":e},body:JSON.stringify({message:t,correlation_id:n})})}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=new URLSearchParams({page:t.toString(),page_size:n.toString()});return(0,i.SC)("/chat/messages?".concat(r),{method:"GET",headers:{"X-Engagement-ID":e}})}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=arguments.length>3?arguments[3]:void 0,s=new URLSearchParams({page:t.toString(),page_size:n.toString()});return r&&s.append("status",r),(0,i.SC)("/chat/run-cards?".concat(s),{method:"GET",headers:{"X-Engagement-ID":e}})}class u{start(){this.intervalId||(this.intervalId=window.setInterval(async()=>{try{let e=await c(this.engagementId,1,20);this.callbacks.forEach(t=>t(e.run_cards))}catch(e){console.error("RunCard polling error:",e)}},this.pollIntervalMs))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}onUpdate(e){this.callbacks.push(e)}removeCallback(e){let t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)}constructor(e,t=3e3){this.engagementId=e,this.pollIntervalMs=t,this.intervalId=null,this.callbacks=[]}}var d=n(11265);function m(e){let{message:t,className:n=""}=e,s="user"===t.sender;return(0,r.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"," mb-4 ").concat(n),children:(0,r.jsxs)("div",{className:"max-w-[70%] px-4 py-2 rounded-lg ".concat(s?"bg-blue-500 text-white rounded-br-sm":"bg-gray-100 text-gray-900 rounded-bl-sm"),children:[(0,r.jsx)("div",{className:"whitespace-pre-wrap break-words",children:t.message}),(0,r.jsx)("div",{className:"text-xs mt-1 ".concat(s?"text-blue-100":"text-gray-500"),children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})}function h(e){let{runCard:t,className:n=""}=e,s={queued:"bg-yellow-50 border-yellow-200 text-yellow-800",running:"bg-blue-50 border-blue-200 text-blue-800",done:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800"};return(0,r.jsxs)("div",{className:"border rounded-lg p-4 ".concat(s[t.status]," ").concat(n),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-lg",children:{queued:"⏳",running:"⚡",done:"✅",error:"❌"}[t.status]}),(0,r.jsx)("code",{className:"font-mono text-sm bg-black/10 px-2 py-1 rounded",children:t.command})]}),(0,r.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full uppercase tracking-wide ".concat(s[t.status]),children:t.status})]}),(0,r.jsxs)("div",{className:"text-sm space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,r.jsx)("span",{children:"Created:"}),(0,r.jsx)("span",{children:new Date(t.created_at).toLocaleString()})]}),(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,r.jsx)("span",{children:"By:"}),(0,r.jsx)("span",{children:t.created_by})]})]}),Object.keys(t.inputs).length>0&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20",children:[(0,r.jsx)("div",{className:"text-xs font-medium mb-1",children:"Inputs:"}),(0,r.jsx)("div",{className:"text-xs bg-black/10 rounded p-2 font-mono",children:JSON.stringify(t.inputs,null,2)})]}),t.outputs&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20",children:[(0,r.jsx)("div",{className:"text-xs font-medium mb-1",children:"Results:"}),(0,r.jsx)("div",{className:"text-xs bg-black/10 rounded p-2 font-mono",children:JSON.stringify(t.outputs,null,2)})]}),t.citations&&t.citations.length>0&&(0,r.jsxs)("div",{className:"mt-2 pt-2 border-t border-current/20",children:[(0,r.jsx)("div",{className:"text-xs font-medium mb-1",children:"Citations:"}),(0,r.jsx)("div",{className:"text-xs space-y-1",children:t.citations.map((e,t)=>(0,r.jsx)("div",{className:"bg-black/10 rounded px-2 py-1 font-mono",children:e},t))})]})]})}function f(e){let{onSend:t,disabled:n=!1,placeholder:a="Type a message or use /command...",className:i=""}=e,[o,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(!1),[d,m]=(0,s.useState)(-1),h=(0,s.useRef)(null),f=o.startsWith("/")?[{command:"/ingest",description:"Ingest and process documents",example:"/ingest docs"},{command:"/minutes",description:"Generate meeting minutes from audio",example:"/minutes recording.mp3"},{command:"/score",description:"Calculate assessment scores",example:"/score assessment-id"}].filter(e=>e.command.startsWith(o.split(" ")[0])):[];(0,s.useEffect)(()=>{u(f.length>0&&o.startsWith("/")),m(-1)},[o,f.length]);let g=()=>{let e=o.trim();e&&!n&&(t(e),l(""),u(!1))},x=e=>{var t;l(e.example),u(!1),null===(t=h.current)||void 0===t||t.focus()},p=null!==function(e){let t=e.trim();if(!t.startsWith("/"))return null;let n=t.indexOf(" ");return -1===n?{command:t,args:""}:{command:t.substring(0,n),args:t.substring(n+1).trim()}}(o);return(0,r.jsxs)("div",{className:"relative ".concat(i),children:[c&&f.length>0&&(0,r.jsx)("div",{className:"absolute bottom-full mb-2 w-full bg-white border border-gray-200 rounded-lg shadow-lg z-10",children:f.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>x(e),className:"w-full text-left px-4 py-3 hover:bg-gray-50 first:rounded-t-lg last:rounded-b-lg ".concat(t===d?"bg-blue-50 border-r-2 border-blue-500":""),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-mono font-medium text-blue-600",children:e.command}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:e.description})]}),(0,r.jsx)("div",{className:"text-xs text-gray-400 ml-2",children:"Tab to use"})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500 font-mono mt-1",children:e.example})]},e.command))}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)("textarea",{ref:h,value:o,onChange:e=>l(e.target.value),onKeyDown:e=>{c&&f.length>0&&("ArrowDown"===e.key?(e.preventDefault(),m(e=>e<f.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),m(e=>e>0?e-1:f.length-1)):"Tab"===e.key&&(e.preventDefault(),d>=0&&(l(f[d].example),u(!1)))),"Enter"!==e.key||e.shiftKey||(e.preventDefault(),g())},disabled:n,placeholder:a,rows:1,className:"w-full px-4 py-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(p?"border-blue-300 bg-blue-50":""," ").concat(n?"opacity-50":""),style:{minHeight:"48px",maxHeight:"120px"}}),p&&(0,r.jsx)("div",{className:"absolute top-1 right-1 px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded font-medium",children:"COMMAND"})]}),(0,r.jsx)("button",{onClick:g,disabled:n||!o.trim(),className:"px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Send"})]}),o.startsWith("/")&&!c&&(0,r.jsx)("div",{className:"mt-1 text-sm text-gray-500",children:"Available commands: /ingest, /minutes, /score"})]})}function g(){let{engagementId:e}=(0,a.useParams)(),t=(0,d.QL)(),[n,i]=(0,s.useState)([]),[c,g]=(0,s.useState)([]),[x,p]=(0,s.useState)(!0),[b,v]=(0,s.useState)(!1),[y,j]=(0,s.useState)(""),w=(0,s.useRef)(null),N=(0,s.useRef)(null);(0,s.useEffect)(()=>{var e;null===(e=w.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[n]),(0,s.useEffect)(()=>{if(e&&!t.isLoading)return(async()=>{try{p(!0);let[t]=await Promise.all([l(e,1,50)]);i(t.messages.reverse()),N.current=new u(e),N.current.onUpdate(g),N.current.start()}catch(e){j(e.message||"Failed to load chat data")}finally{p(!1)}})(),()=>{N.current&&N.current.stop()}},[e,t.isLoading]);let S=async t=>{if(e&&!b)try{v(!0),j("");let n=await o(e,t);i(e=>[...e,n])}catch(e){j(e.message||"Failed to send message")}finally{v(!1)}};if(t.isLoading||x)return(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-center",children:"Loading chat..."})});if(!e)return(0,r.jsx)("div",{className:"p-6",children:"No engagement selected."});let E=c.filter(e=>["queued","running"].includes(e.status)),T=c.filter(e=>["done","error"].includes(e.status));return(0,r.jsxs)("div",{className:"flex flex-col h-screen max-h-screen",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b bg-white",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Chat Shell"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Send messages or use commands like ",(0,r.jsx)("code",{className:"bg-gray-100 px-1 rounded",children:"/ingest docs"})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex gap-6 p-6 overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto mb-4 border rounded-lg bg-gray-50 p-4",children:[y&&(0,r.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 text-red-700 rounded-lg",children:y}),0===n.length&&!y&&(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)("p",{children:"No messages yet. Start a conversation!"}),(0,r.jsxs)("p",{className:"text-sm mt-2",children:["Try: ",(0,r.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"/ingest docs"})]})]}),n.map(e=>(0,r.jsx)(m,{message:e},e.id)),(0,r.jsx)("div",{ref:w})]}),(0,r.jsx)(f,{onSend:S,disabled:b,placeholder:b?"Sending...":"Type a message or use /command..."})]}),(0,r.jsxs)("div",{className:"w-80 flex flex-col gap-4",children:[E.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Active Commands"}),(0,r.jsx)("div",{className:"space-y-2",children:E.map(e=>(0,r.jsx)(h,{runCard:e},e.id))})]}),T.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Recent Results"}),(0,r.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:T.slice(0,5).map(e=>(0,r.jsx)(h,{runCard:e},e.id))})]}),0===c.length&&(0,r.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,r.jsx)("p",{className:"text-sm",children:"No commands executed yet."})})]})]})]})}},11265:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return o},QL:function(){return c},aC:function(){return l}});var r=n(57437),s=n(2265),a=n(99376);let i=(0,s.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,s.useState)(null),[l,c]=(0,s.useState)({mode:"demo",enabled:!0}),[u,d]=(0,s.useState)(!0),[m,h]=(0,s.useState)();async function f(){try{d(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(c(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),h(t instanceof Error?t.message:"Authentication failed"),c({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{d(!1)}}return(0,a.useRouter)(),(0,s.useEffect)(()=>{f()},[]),(0,r.jsx)(i.Provider,{value:{user:n,mode:l,isAuthenticated:!!n,isLoading:u,error:m},children:t})}function l(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function c(){let e=l(),t=(0,a.useRouter)();return(0,s.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return c},SC:function(){return i},Sg:function(){return l},tQ:function(){return o}});var r=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function a(){let e=(0,r.OD)(),t=(0,r.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a(),r=new AbortController,i=setTimeout(()=>r.abort(),t.timeout||3e4);try{let a=await fetch("".concat(s).concat(e),{...t,signal:r.signal,headers:{...n,...t.headers}});if(clearTimeout(i),!a.ok){let e=await a.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(a.status))}return a.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let r=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!r.ok)throw Error("Preset ".concat(e," not found"));return r.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let l=s;function c(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=a();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return l},K3:function(){return a},OD:function(){return s},Pk:function(){return o},d8:function(){return i}});var r=n(40257);function s(){return localStorage.getItem("email")||""}function a(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function o(e){return s()||(await e.push("/signin"),"")}function l(){let e=s();return(r.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},40257:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var l=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?l=r.concat(l):u=-1,l.length&&m())}function m(){if(!c){var e=o(d);c=!0;for(var t=l.length;t;){for(r=l,l=[];++u<t;)r&&r[u].run();u=-1,t=l.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new h(e,t)),1!==l.length||c||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}},i=!0;try{t[e](a,a.exports,r),i=!1}finally{i&&delete n[e]}return a.exports}r.ab="//";var s=r(229);e.exports=s}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=67645)}),_N_E=e.O()}]);