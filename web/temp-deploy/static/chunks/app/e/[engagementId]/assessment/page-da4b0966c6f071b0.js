(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{93603:function(e,t,n){Promise.resolve().then(n.bind(n,51679))},51679:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(57437),s=n(2265),i=n(99376),a=n(29116);let o=new Map;async function c(){let e="csf:functions",t=function(e){let t=o.get(e);return t?Date.now()-t.timestamp>3e5?(o.delete(e),null):t.data:null}(e);if(t)return t;try{let t=(await (0,a.SC)("/api/v1/csf/functions",{timeout:1e4})).functions;return o.set(e,{data:t,timestamp:Date.now()}),t}catch(e){throw console.error("Error loading CSF functions:",e),Error(e instanceof Error?e.message:"Failed to load CSF taxonomy")}}var l=n(11265);function u(e){let{functions:t,onSubcategorySelect:n,selectedSubcategory:i}=e,[a,o]=(0,s.useState)(new Set),c=e=>{o(t=>{let n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})};return(0,r.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg",children:[(0,r.jsxs)("button",{onClick:()=>c(e.id),className:"w-full px-4 py-3 text-left bg-gray-50 hover:bg-gray-100 rounded-t-lg font-medium flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:e.id})," - ",e.title]}),(0,r.jsx)("span",{className:"text-gray-500",children:a.has(e.id)?"âˆ’":"+"})]}),a.has(e.id)&&(0,r.jsxs)("div",{className:"p-4 space-y-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:e.description}),(0,r.jsx)("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:e.categories.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg p-3 bg-white",children:[(0,r.jsxs)("div",{className:"font-medium text-sm mb-2",children:[e.id," - ",e.title]}),(0,r.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:e.description}),(0,r.jsx)("div",{className:"space-y-1",children:e.subcategories.map(e=>(0,r.jsxs)("button",{onClick:()=>n(e),className:"w-full text-left px-2 py-1 rounded text-xs hover:bg-blue-50 ".concat((null==i?void 0:i.id)===e.id?"bg-blue-100 text-blue-700 font-medium":"text-gray-700"),children:[e.id," - ",e.title]},e.id))})]},e.id))})]})]},e.id))})}function d(e){let{subcategory:t}=e;return(0,r.jsxs)("div",{className:"bg-white border rounded-lg p-6 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-lg",children:t.id}),(0,r.jsx)("h4",{className:"text-gray-600 mb-2",children:t.title}),(0,r.jsx)("p",{className:"text-sm text-gray-700",children:t.description})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Assessment Score"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[(0,r.jsx)("div",{children:"Score: Not Assessed"}),(0,r.jsx)("div",{className:"text-xs mt-1",children:"Scoring functionality coming soon"})]})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Rationale"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[(0,r.jsx)("div",{children:"No rationale provided"}),(0,r.jsx)("div",{className:"text-xs mt-1",children:"Rationale input coming soon"})]})]}),(0,r.jsxs)("div",{className:"border-t pt-4",children:[(0,r.jsx)("h4",{className:"font-medium mb-2",children:"Evidence"}),(0,r.jsxs)("div",{className:"bg-gray-50 p-3 rounded text-center text-gray-500",children:[(0,r.jsx)("div",{children:"No evidence uploaded"}),(0,r.jsx)("div",{className:"text-xs mt-1",children:"Evidence tray coming soon"})]})]})]})}function m(){let{engagementId:e}=(0,i.useParams)(),[t,n]=(0,s.useState)([]),[a,o]=(0,s.useState)(!0),[m,h]=(0,s.useState)(null),[f,g]=(0,s.useState)(),x=(0,l.QL)();(0,s.useEffect)(()=>{p()},[]);let p=async()=>{try{o(!0);let e=await c();n(e),e.length}catch(e){console.error("Error loading CSF data:",e),h(e instanceof Error?e.message:"Failed to load CSF data")}finally{o(!1)}},v=(0,s.useMemo)(()=>t.length?{functions:t.length,categories:t.reduce((e,t)=>e+t.categories.length,0),subcategories:t.reduce((e,t)=>e+t.categories.reduce((e,t)=>e+t.subcategories.length,0),0)}:{functions:0,categories:0,subcategories:0},[t]);return x.isLoading?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)("div",{className:"text-center",children:"Loading..."})}):a?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,r.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),(0,r.jsx)("div",{className:"h-32 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})}):m?(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium text-red-800",children:"Error Loading Assessment"}),(0,r.jsx)("p",{className:"text-red-600 text-sm mt-1",children:m}),(0,r.jsx)("button",{onClick:p,className:"mt-3 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm",children:"Retry"})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"CSF 2.0 Assessment Grid"}),(0,r.jsxs)("p",{className:"text-gray-600 text-sm mt-1",children:["Engagement: ",e]}),(0,r.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500 mt-2",children:[(0,r.jsxs)("span",{children:[v.functions," Functions"]}),(0,r.jsxs)("span",{children:[v.categories," Categories"]}),(0,r.jsxs)("span",{children:[v.subcategories," Subcategories"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)(u,{functions:t,onSubcategorySelect:g,selectedSubcategory:f})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:f?(0,r.jsx)(d,{subcategory:f}):(0,r.jsxs)("div",{className:"bg-white border rounded-lg p-6 text-center text-gray-500",children:[(0,r.jsx)("h3",{className:"font-medium mb-2",children:"Select a Subcategory"}),(0,r.jsx)("p",{className:"text-sm",children:"Click on any subcategory from the grid to view details and assessment options."})]})})]})]})})}},11265:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return o},QL:function(){return l},aC:function(){return c}});var r=n(57437),s=n(2265),i=n(99376);let a=(0,s.createContext)(null);function o(e){let{children:t}=e,[n,o]=(0,s.useState)(null),[c,l]=(0,s.useState)({mode:"demo",enabled:!0}),[u,d]=(0,s.useState)(!0),[m,h]=(0,s.useState)();async function f(){try{d(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),h(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{d(!1)}}return(0,i.useRouter)(),(0,s.useEffect)(()=>{f()},[]),(0,r.jsx)(a.Provider,{value:{user:n,mode:c,isAuthenticated:!!n,isLoading:u,error:m},children:t})}function c(){let e=(0,s.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,i.useRouter)();return(0,s.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return a},Sg:function(){return c},tQ:function(){return o}});var r=n(16023);let s=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function i(){let e=(0,r.OD)(),t=(0,r.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i(),r=new AbortController,a=setTimeout(()=>r.abort(),t.timeout||3e4);try{let i=await fetch("".concat(s).concat(e),{...t,signal:r.signal,headers:{...n,...t.headers}});if(clearTimeout(a),!i.ok){let e=await i.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(i.status))}return i.json()}catch(e){if(clearTimeout(a),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let r=await fetch("".concat(s,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!r.ok)throw Error("Preset ".concat(e," not found"));return r.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=s;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return c},K3:function(){return i},OD:function(){return s},Pk:function(){return o},d8:function(){return a}});var r=n(40257);function s(){return localStorage.getItem("email")||""}function i(){return localStorage.getItem("engagementId")||""}function a(e){localStorage.setItem("engagementId",e)}async function o(e){return s()||(await e.push("/signin"),"")}function c(){let e=s();return(r.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},40257:function(e,t,n){"use strict";var r,s;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,r,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var c=[],l=!1,u=-1;function d(){l&&r&&(l=!1,r.length?c=r.concat(c):u=-1,c.length&&m())}function m(){if(!l){var e=o(d);l=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function r(e){var s=n[e];if(void 0!==s)return s.exports;var i=n[e]={exports:{}},a=!0;try{t[e](i,i.exports,r),a=!1}finally{a&&delete n[e]}return i.exports}r.ab="//";var s=r(229);e.exports=s}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=93603)}),_N_E=e.O()}]);