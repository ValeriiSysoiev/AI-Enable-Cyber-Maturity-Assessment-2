(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[233],{43405:function(e,t,s){Promise.resolve().then(s.bind(s,77820))},77820:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var n=s(57437),r=s(11265),a=s(16023),i=s(2265),o=s(29116);function c(e){let{className:t=""}=e,[s,r]=(0,i.useState)(null),[a,c]=(0,i.useState)("idle"),[l,d]=(0,i.useState)(""),[u,m]=(0,i.useState)(""),h=async()=>{c("loading"),d("");try{let e=await (0,o.SC)("/admin/auth-diagnostics");r(e.diagnostics),m(new Date().toLocaleString()),c("success")}catch(e){d(e instanceof Error?e.message:"Failed to load auth diagnostics"),c("error")}};return((0,i.useEffect)(()=>{h()},[]),"loading"===a)?(0,n.jsx)("div",{className:"space-y-6 ".concat(t),children:(0,n.jsxs)("div",{className:"animate-pulse",children:[(0,n.jsx)("div",{className:"h-6 bg-gray-200 rounded mb-4"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,n.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,n.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})]})}):"error"===a?(0,n.jsx)("div",{className:"space-y-6 ".concat(t),children:(0,n.jsxs)("div",{className:"border rounded p-4 bg-red-50 border-red-200",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("h3",{className:"font-medium text-red-800",children:"Error Loading Diagnostics"}),(0,n.jsx)("button",{onClick:h,className:"px-3 py-1 text-sm bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"})]}),(0,n.jsx)("p",{className:"text-red-700 text-sm",children:l})]})}):s?(0,n.jsxs)("div",{className:"space-y-6 ".concat(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"Authentication Diagnostics"}),(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[u&&(0,n.jsxs)("span",{className:"text-sm text-gray-500",children:["Last updated: ",u]}),(0,n.jsx)("button",{onClick:h,disabled:"loading"===a,className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"loading"===a?"Refreshing...":"Refresh"})]})]}),(0,n.jsx)("div",{className:"border rounded p-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("h3",{className:"font-medium",children:"Authentication Mode"}),(0,n.jsx)("span",{className:"px-2 py-1 rounded text-sm font-medium ".concat("aad"===s.mode?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:"aad"===s.mode?"Azure AD":"Demo"})]})}),(0,n.jsxs)("div",{className:"border rounded p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)("h3",{className:"font-medium",children:"Configuration Status"}),(0,n.jsx)("span",{className:"px-2 py-1 rounded text-sm font-medium ".concat((e=>{switch(e){case"ok":return"text-green-600 bg-green-100";case"warning":return"text-yellow-600 bg-yellow-100";case"error":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}})(s.configuration.status)),children:s.configuration.status.toUpperCase()})]}),s.configuration.issues&&s.configuration.issues.length>0&&(0,n.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,n.jsx)("div",{className:"font-medium text-sm text-red-700",children:"Issues:"}),(0,n.jsx)("ul",{className:"list-disc list-inside space-y-1",children:s.configuration.issues.map((e,t)=>(0,n.jsx)("li",{className:"text-sm text-red-600",children:e},t))})]})]}),"aad"===s.mode&&s.tenant&&(0,n.jsxs)("div",{className:"border rounded p-4",children:[(0,n.jsx)("h3",{className:"font-medium mb-3",children:"Tenant Information"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"ID:"}),(0,n.jsx)("span",{className:"ml-2 font-mono bg-gray-100 px-2 py-1 rounded",children:s.tenant.id})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Name:"}),(0,n.jsx)("span",{className:"ml-2",children:s.tenant.name})]})]})]}),s.user&&(0,n.jsxs)("div",{className:"border rounded p-4",children:[(0,n.jsx)("h3",{className:"font-medium mb-3",children:"Current User"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Email:"}),(0,n.jsx)("span",{className:"ml-2",children:s.user.email})]}),s.user.groups&&s.user.groups.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Groups:"}),(0,n.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:s.user.groups.map((e,t)=>(0,n.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs",children:e},t))})]}),s.user.roles&&s.user.roles.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:"Roles:"}),(0,n.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:s.user.roles.map((e,t)=>(0,n.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs",children:e},t))})]})]})]}),s.groups&&s.groups.length>0&&(0,n.jsxs)("div",{className:"border rounded p-4",children:[(0,n.jsx)("h3",{className:"font-medium mb-3",children:"AAD Groups & Role Mapping"}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"border-b",children:[(0,n.jsx)("th",{className:"text-left py-2",children:"Group Name"}),(0,n.jsx)("th",{className:"text-left py-2",children:"Group ID"}),(0,n.jsx)("th",{className:"text-left py-2",children:"Mapped Role"})]})}),(0,n.jsx)("tbody",{children:s.groups.map((e,t)=>(0,n.jsxs)("tr",{className:"border-t",children:[(0,n.jsx)("td",{className:"py-2",children:e.name}),(0,n.jsx)("td",{className:"py-2 font-mono text-xs",children:e.id}),(0,n.jsx)("td",{className:"py-2",children:e.mapped_role?(0,n.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded text-xs",children:e.mapped_role}):(0,n.jsx)("span",{className:"text-gray-400 text-xs",children:"No mapping"})})]},e.id))})]})})]}),s.roles&&s.roles.length>0&&(0,n.jsxs)("div",{className:"border rounded p-4",children:[(0,n.jsx)("h3",{className:"font-medium mb-3",children:"Available Roles"}),(0,n.jsx)("div",{className:"space-y-3",children:s.roles.map((e,t)=>(0,n.jsxs)("div",{className:"border-l-4 border-blue-200 pl-3",children:[(0,n.jsx)("div",{className:"font-medium text-sm",children:e.name}),e.description&&(0,n.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:e.description}),e.permissions&&e.permissions.length>0&&(0,n.jsxs)("div",{className:"mt-2",children:[(0,n.jsx)("div",{className:"text-xs text-gray-500 mb-1",children:"Permissions:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-1",children:e.permissions.map((e,t)=>(0,n.jsx)("span",{className:"px-1 py-0.5 bg-gray-100 text-gray-700 rounded text-xs",children:e},t))})]})]},t))})]})]}):(0,n.jsx)("div",{className:"space-y-6 ".concat(t),children:(0,n.jsx)("div",{className:"text-gray-500 text-center py-8",children:"No diagnostics data available"})})}function l(){var e;let t=(0,r.QL)();return t.isLoading?(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)("div",{className:"text-center",children:"Loading..."})}):(0,a.GJ)()?(0,n.jsxs)("div",{className:"p-6 space-y-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin • Authentication"}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:["User: ",null===(e=t.user)||void 0===e?void 0:e.name," • Mode: ","aad"===t.mode.mode?"Azure AD":"Demo"]})]}),(0,n.jsx)("div",{className:"text-sm text-gray-600 border-l-4 border-blue-200 pl-4",children:"This page provides diagnostic information about the current authentication configuration, including AAD tenant details, group mappings, and role assignments."}),(0,n.jsx)(c,{})]}):(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)("div",{className:"text-red-600",children:"Access denied. Admin privileges required."})})}},11265:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return o},QL:function(){return l},aC:function(){return c}});var n=s(57437),r=s(2265),a=s(99376);let i=(0,r.createContext)(null);function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[c,l]=(0,r.useState)({mode:"demo",enabled:!0}),[d,u]=(0,r.useState)(!0),[m,h]=(0,r.useState)();async function x(){try{u(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&o({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),h(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&o({id:e,email:e,name:e.split("@")[0]})}finally{u(!1)}}return(0,a.useRouter)(),(0,r.useEffect)(()=>{x()},[]),(0,n.jsx)(i.Provider,{value:{user:s,mode:c,isAuthenticated:!!s,isLoading:d,error:m},children:t})}function c(){let e=(0,r.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,a.useRouter)();return(0,r.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},29116:function(e,t,s){"use strict";s.d(t,{$V:function(){return l},SC:function(){return i},Sg:function(){return c},tQ:function(){return o}});var n=s(16023);let r=s(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function a(){let e=(0,n.OD)(),t=(0,n.K3)(),s={};return e&&(s["X-User-Email"]=e),t&&(s["X-Engagement-ID"]=t),s}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a(),n=new AbortController,i=setTimeout(()=>n.abort(),t.timeout||3e4);try{let a=await fetch("".concat(r).concat(e),{...t,signal:n.signal,headers:{...s,...t.headers}});if(clearTimeout(i),!a.ok){let e=await a.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(a.status))}return a.json()}catch(e){if(clearTimeout(i),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function o(e){let t=new AbortController,s=setTimeout(()=>t.abort(),3e4);try{let n=await fetch("".concat(r,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(s),!n.ok)throw Error("Preset ".concat(e," not found"));return n.json()}catch(t){if(clearTimeout(s),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=r;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=a();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,s){"use strict";s.d(t,{GJ:function(){return c},K3:function(){return a},OD:function(){return r},Pk:function(){return o},d8:function(){return i}});var n=s(40257);function r(){return localStorage.getItem("email")||""}function a(){return localStorage.getItem("engagementId")||""}function i(e){localStorage.setItem("engagementId",e)}async function o(e){return r()||(await e.push("/signin"),"")}function c(){let e=r();return(n.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},99376:function(e,t,s){"use strict";var n=s(35475);s.o(n,"useParams")&&s.d(t,{useParams:function(){return n.useParams}}),s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})},40257:function(e,t,s){"use strict";var n,r;e.exports=(null==(n=s.g.process)?void 0:n.env)&&"object"==typeof(null==(r=s.g.process)?void 0:r.env)?s.g.process:s(44227)},44227:function(e){!function(){var t={229:function(e){var t,s,n,r=e.exports={};function a(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{s="function"==typeof clearTimeout?clearTimeout:i}catch(e){s=i}}();var c=[],l=!1,d=-1;function u(){l&&n&&(l=!1,n.length?c=n.concat(c):d=-1,c.length&&m())}function m(){if(!l){var e=o(u);l=!0;for(var t=c.length;t;){for(n=c,c=[];++d<t;)n&&n[d].run();d=-1,t=c.length}n=null,l=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===i||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function x(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new h(e,t)),1!==c.length||l||o(m)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=x,r.addListener=x,r.once=x,r.off=x,r.removeListener=x,r.removeAllListeners=x,r.emit=x,r.prependListener=x,r.prependOnceListener=x,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}},i=!0;try{t[e](a,a.exports,n),i=!1}finally{i&&delete s[e]}return a.exports}n.ab="//";var r=n(229);e.exports=r}()}},function(e){e.O(0,[971,117,744],function(){return e(e.s=43405)}),_N_E=e.O()}]);