(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{38655:function(e,t,n){Promise.resolve().then(n.bind(n,99037))},99037:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var a=n(57437),r=n(2265),i=n(29116),o=n(43610),s=n(11265),c=n(16023);function l(){var e;let[t,n]=(0,r.useState)("presets"),[l,u]=(0,r.useState)([]),[d,f]=(0,r.useState)(""),h=(0,s.QL)();async function p(){try{let e=await fetch("".concat(i.Sg,"/presets"),{headers:(0,i.$V)()});if(!e.ok){f("Failed to load presets: ".concat(e.status));return}u(await e.json())}catch(e){f("Error loading presets: ".concat(e))}}async function m(e){e.preventDefault();let t=new FormData(e.currentTarget);try{let n=await fetch("".concat(i.Sg,"/presets/upload"),{method:"POST",headers:{...(0,i.$V)()},body:t});if(!n.ok){let e=await n.text();f("Upload failed: ".concat(n.status," - ").concat(e));return}let a=await n.json();f("Uploaded: ".concat(a.name," (").concat(a.id,")")),await p(),e.currentTarget.reset()}catch(e){f("Upload error: ".concat(e))}}return((0,r.useEffect)(()=>{h.isAuthenticated&&(0,c.GJ)()&&p()},[h.isAuthenticated]),h.isLoading)?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"Loading..."})}):(0,c.GJ)()?(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Admin Operations"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("a",{href:"/admin/auth",className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 border",children:"Auth Diagnostics"}),(0,a.jsx)("a",{href:"/admin/gdpr",className:"px-3 py-1 text-sm bg-blue-50 text-blue-700 rounded hover:bg-blue-100 border border-blue-200",children:"GDPR Management"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["User: ",null===(e=h.user)||void 0===e?void 0:e.name," • Mode: ","aad"===h.mode.mode?"Azure AD":"Demo"]})]})]}),(0,a.jsx)("div",{className:"border-b border-gray-200",children:(0,a.jsx)("nav",{className:"flex space-x-8",children:[{id:"presets",label:"Presets Management"},{id:"evidence",label:"Evidence Management"}].map(e=>(0,a.jsx)("button",{onClick:()=>n(e.id),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(t===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.id))})}),"presets"===t&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("form",{onSubmit:m,className:"border rounded p-4 space-y-3",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Upload a preset JSON"}),(0,a.jsx)("input",{name:"file",type:"file",accept:"application/json",className:"border rounded p-2",required:!0}),(0,a.jsx)("button",{className:"px-3 py-1 border rounded bg-blue-500 text-white hover:bg-blue-600",type:"submit",children:"Upload"}),d&&(0,a.jsx)("div",{className:"text-sm",children:d})]}),(0,a.jsxs)("div",{className:"border rounded p-4",children:[(0,a.jsx)("div",{className:"font-medium mb-2",children:"Available Presets"}),(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"text-left py-2",children:"Name"}),(0,a.jsx)("th",{className:"text-left py-2",children:"ID"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Version"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Counts (P/C/Q)"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Source"}),(0,a.jsx)("th",{className:"text-left py-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:l.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"py-2",children:e.name}),(0,a.jsx)("td",{className:"py-2 font-mono text-xs",children:e.id}),(0,a.jsx)("td",{className:"py-2",children:e.version}),(0,a.jsxs)("td",{className:"py-2",children:[e.counts.pillars,"/",e.counts.capabilities,"/",e.counts.questions]}),(0,a.jsx)("td",{className:"py-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs ".concat("bundled"===e.source?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.source})}),(0,a.jsxs)("td",{className:"py-2 space-x-2",children:[(0,a.jsx)("a",{className:"underline text-blue-600 hover:text-blue-800",href:"".concat(i.Sg,"/presets/").concat(e.id),target:"_blank",rel:"noopener noreferrer",children:"Preview"}),(0,a.jsx)("button",{className:"underline text-gray-600 hover:text-gray-800",onClick:()=>navigator.clipboard.writeText(e.id),children:"Copy ID"})]})]},e.id))})]}),0===l.length&&(0,a.jsx)("div",{className:"text-gray-500 text-center py-4",children:"No presets available"})]})]}),"evidence"===t&&(0,a.jsx)(o.Z,{className:"max-w-2xl"})]}):(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-red-600",children:"Access denied. Admin privileges required."})})}},11265:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return s},QL:function(){return l},aC:function(){return c}});var a=n(57437),r=n(2265),i=n(99376);let o=(0,r.createContext)(null);function s(e){let{children:t}=e,[n,s]=(0,r.useState)(null),[c,l]=(0,r.useState)({mode:"demo",enabled:!0}),[u,d]=(0,r.useState)(!0),[f,h]=(0,r.useState)();async function p(){try{d(!0),h(void 0);let e=await fetch("/api/auth/mode");if(e.ok){let t=await e.json();if(l(t),"aad"===t.mode&&t.enabled){let e=await fetch("/api/auth/session");if(e.ok){let t=await e.json();t.user&&s({id:t.user.id,email:t.user.email,name:t.user.name,roles:t.user.roles,tenant_id:t.user.tenant_id})}}else{let e=localStorage.getItem("email");e&&s({id:e,email:e,name:e.split("@")[0]})}}}catch(t){console.error("Auth initialization failed:",t),h(t instanceof Error?t.message:"Authentication failed"),l({mode:"demo",enabled:!0});let e=localStorage.getItem("email");e&&s({id:e,email:e,name:e.split("@")[0]})}finally{d(!1)}}return(0,i.useRouter)(),(0,r.useEffect)(()=>{p()},[]),(0,a.jsx)(o.Provider,{value:{user:n,mode:c,isAuthenticated:!!n,isLoading:u,error:f},children:t})}function c(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(){let e=c(),t=(0,i.useRouter)();return(0,r.useEffect)(()=>{e.isLoading||e.isAuthenticated||("aad"===e.mode.mode?window.location.href="/api/auth/signin":t.push("/signin"))},[e.isLoading,e.isAuthenticated,e.mode.mode,t]),e}},29116:function(e,t,n){"use strict";n.d(t,{$V:function(){return l},SC:function(){return o},Sg:function(){return c},tQ:function(){return s}});var a=n(16023);let r=n(40257).env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000";function i(){let e=(0,a.OD)(),t=(0,a.K3)(),n={};return e&&(n["X-User-Email"]=e),t&&(n["X-Engagement-ID"]=t),n}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i(),a=new AbortController,o=setTimeout(()=>a.abort(),t.timeout||3e4);try{let i=await fetch("".concat(r).concat(e),{...t,signal:a.signal,headers:{...n,...t.headers}});if(clearTimeout(o),!i.ok){let e=await i.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Request failed: ".concat(i.status))}return i.json()}catch(e){if(clearTimeout(o),e instanceof Error&&"AbortError"===e.name)throw Error("Request timeout - please try again");throw e}}async function s(e){let t=new AbortController,n=setTimeout(()=>t.abort(),3e4);try{let a=await fetch("".concat(r,"/presets/").concat(e),{cache:"no-store",signal:t.signal});if(clearTimeout(n),!a.ok)throw Error("Preset ".concat(e," not found"));return a.json()}catch(t){if(clearTimeout(n),t instanceof Error&&"AbortError"===t.name)throw console.error("Preset fetch timeout:",e),Error("Request timeout - please try again");throw console.error("Error fetching preset:",t),t}}let c=r;function l(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i();return e||(t["Content-Type"]="application/json"),t}},16023:function(e,t,n){"use strict";n.d(t,{GJ:function(){return c},K3:function(){return i},OD:function(){return r},Pk:function(){return s},d8:function(){return o}});var a=n(40257);function r(){return localStorage.getItem("email")||""}function i(){return localStorage.getItem("engagementId")||""}function o(e){localStorage.setItem("engagementId",e)}async function s(e){return r()||(await e.push("/signin"),"")}function c(){let e=r();return(a.env.NEXT_PUBLIC_ADMIN_EMAILS||"").split(",").map(e=>e.trim().toLowerCase()).includes(e.toLowerCase())}},4062:function(e,t,n){"use strict";n.d(t,{$r:function(){return l},EK:function(){return c},Hi:function(){return f},Hj:function(){return o},LB:function(){return g},LP:function(){return v},LT:function(){return u},W2:function(){return x},Zg:function(){return r},fG:function(){return m},fj:function(){return d},kR:function(){return s},q8:function(){return h},sS:function(){return y},tc:function(){return p},te:function(){return i}});var a=n(29116);async function r(e){let t=await fetch("/api/proxy/evidence/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Search failed"}))).detail||"Search failed: ".concat(t.status));return t.json()}async function i(e){let t=await fetch("/api/proxy/engagements/".concat(e,"/docs/ingestion-status"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get ingestion statuses"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function o(e,t){let n=await fetch("/api/proxy/engagements/".concat(e,"/docs/").concat(t,"/ingest"),{method:"POST"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Ingestion failed"}))).detail||"Request failed: ".concat(n.status));return n.json()}async function s(e){let t=await fetch("/api/proxy/evidence/reindex",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Bulk reindex failed"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function c(e){let[t,n]=await Promise.all([(0,a.SC)("/engagements/".concat(e,"/docs")),i(e).catch(()=>[])]);return t.map(e=>({...e,ingestion_status:n.find(t=>t.document_id===e.id)}))}async function l(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=await fetch("/api/proxy/analysis/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({engagement_id:e,content:t,use_evidence:n})});if(!a.ok)throw Error((await a.json().catch(()=>({detail:"Analysis failed"}))).detail||"Request failed: ".concat(a.status));return a.json()}async function u(e){let t=await fetch("/api/proxy/analysis/".concat(e,"/citations"));if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Failed to get citations"}))).detail||"Request failed: ".concat(t.status));return t.json()}async function d(e){let t=await fetch("/api/proxy/evidence/sas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"SAS generation failed"}))).detail||"SAS generation failed: ".concat(t.status));return t.json()}async function f(e){let t=await fetch("/api/proxy/evidence/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({detail:"Upload completion failed"}))).detail||"Upload completion failed: ".concat(t.status));return t.json()}async function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=new URLSearchParams({engagement_id:e,page:t.toString(),page_size:n.toString()}),r=await fetch("/api/proxy/evidence?".concat(a));if(!r.ok)throw Error((await r.json().catch(()=>({detail:"Failed to list evidence"}))).detail||"Failed to list evidence: ".concat(r.status));let i=await r.json(),o=parseInt(r.headers.get("X-Total-Count")||"0"),s=parseInt(r.headers.get("X-Page")||"1"),c=parseInt(r.headers.get("X-Page-Size")||"50");return{data:i,total:o,page:s,page_size:c,total_pages:parseInt(r.headers.get("X-Total-Pages")||"1"),has_next:"true"===r.headers.get("X-Has-Next"),has_previous:"true"===r.headers.get("X-Has-Previous")}}async function p(e,t){let n=await fetch("/api/proxy/evidence/".concat(e,"/links"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Evidence linking failed"}))).detail||"Evidence linking failed: ".concat(n.status));return n.json()}async function m(e,t){let n=await fetch("/api/proxy/evidence/".concat(e,"/links/").concat(t),{method:"DELETE"});if(!n.ok)throw Error((await n.json().catch(()=>({detail:"Evidence unlinking failed"}))).detail||"Evidence unlinking failed: ".concat(n.status));return n.json()}async function g(e,t){let n=await fetch(e,{method:"PUT",headers:{"x-ms-blob-type":"BlockBlob","Content-Type":t.type||"application/octet-stream"},body:t});if(!n.ok)throw Error("Azure upload failed: ".concat(n.statusText))}async function x(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}function y(e){if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]}function v(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.includes("pdf")?"\uD83D\uDCC4":e.includes("word")||e.includes("document")?"\uD83D\uDCDD":e.includes("excel")||e.includes("spreadsheet")?"\uD83D\uDCCA":e.includes("powerpoint")||e.includes("presentation")?"\uD83D\uDCFD️":e.startsWith("text/")?"\uD83D\uDCC4":e.includes("zip")||e.includes("archive")?"\uD83D\uDCE6":"\uD83D\uDCC4"}},99376:function(e,t,n){"use strict";var a=n(35475);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},40257:function(e,t,n){"use strict";var a,r;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(44227)},44227:function(e){!function(){var t={229:function(e){var t,n,a,r=e.exports={};function i(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var c=[],l=!1,u=-1;function d(){l&&a&&(l=!1,a.length?c=a.concat(c):u=-1,c.length&&f())}function f(){if(!l){var e=s(d);l=!0;for(var t=c.length;t;){for(a=c,c=[];++u<t;)a&&a[u].run();u=-1,t=c.length}a=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new h(e,t)),1!==c.length||l||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}},o=!0;try{t[e](i,i.exports,a),o=!1}finally{o&&delete n[e]}return i.exports}a.ab="//";var r=a(229);e.exports=r}()}},function(e){e.O(0,[610,971,117,744],function(){return e(e.s=38655)}),_N_E=e.O()}]);